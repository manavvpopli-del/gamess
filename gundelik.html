<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Car Racing & Admin Panel</title>
    <style>
        :root { --neon-blue: #00f2ff; --neon-red: #ff0044; }
        body { margin: 0; background: #0a0a0a; color: white; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        
        /* Oyun Sahəsi */
        #game-wrapper { position: relative; border: 4px solid var(--neon-blue); box-shadow: 0 0 20px var(--neon-blue); }
        canvas { background: #111; display: block; }

        /* UI Elementləri */
        .stats { position: absolute; top: 10px; left: 10px; display: flex; gap: 15px; z-index: 5; }
        .stat-box { background: rgba(0,0,0,0.7); padding: 5px 15px; border: 1px solid var(--neon-blue); border-radius: 5px; }

        /* Admin Panel */
        #admin-sidebar { position: fixed; right: 20px; top: 20px; width: 250px; background: rgba(15, 15, 15, 0.95); border: 2px solid var(--neon-red); padding: 20px; border-radius: 10px; box-shadow: 0 0 15px var(--neon-red); z-index: 100; }
        #admin-sidebar h2 { color: var(--neon-red); margin-top: 0; text-align: center; font-size: 1.2rem; }
        .admin-btn { width: 100%; padding: 8px; margin: 5px 0; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-add { background: #27ae60; color: white; }
        .btn-unlock { background: #2980b9; color: white; }
        input { width: 100%; padding: 8px; margin-bottom: 10px; background: #222; border: 1px solid #444; color: white; box-sizing: border-box; }

        /* Market Menyu */
        .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.85); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 50; }
        .market-grid { display: flex; gap: 15px; margin-bottom: 20px; }
        .car-card { border: 1px solid #444; padding: 15px; text-align: center; background: #1a1a1a; transition: 0.3s; width: 120px; }
        .car-card.selected { border-color: var(--neon-blue); box-shadow: 0 0 10px var(--neon-blue); }
        .buy-btn { background: var(--neon-blue); border: none; padding: 5px 10px; cursor: pointer; margin-top: 10px; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="admin-sidebar">
        <h2>Admin Panel</h2>
        <p style="font-size: 12px; color: #aaa;">Oyunçu: <span id="adm-user" style="color:lawngreen">Online</span></p>
        <label>Balans Artır:</label>
        <input type="number" id="cashInput" value="5000">
        <button class="admin-btn btn-add" onclick="adminAddCash()">Balans Əlavə Et</button>
        <button class="admin-btn btn-unlock" onclick="adminUnlockAll()">Bütün Maşınları Aç</button>
        <hr style="border: 0.5px solid #333; margin: 15px 0;">
        <button class="admin-btn" style="background:#555; color:white;" onclick="resetGame()">Data-nı Sıfırla</button>
    </div>

    <div id="game-wrapper">
        <div class="stats">
            <div class="stat-box">Balans: $<span id="balance">0</span></div>
            <div class="stat-box">Xal: <span id="score">0</span></div>
        </div>

        <canvas id="gameCanvas"></canvas>

        <div id="menu" class="overlay">
            <h1 id="menu-title">Sürət Yarışı</h1>
            <button class="buy-btn" style="padding: 15px 40px; font-size: 20px;" onclick="startGame()">BAŞLA</button>
            <button class="buy-btn" style="background:#444; margin-top: 10px;" onclick="toggleMarket(true)">MARKET</button>
        </div>

        <div id="market" class="overlay hidden">
            <h2>Maşın Marketi</h2>
            <div class="market-grid" id="market-list"></div>
            <button class="buy-btn" style="background:var(--neon-red)" onclick="toggleMarket(false)">GERİ</button>
        </div>
    </div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = 450;
    canvas.height = 650;

    // DATA
    let player = JSON.parse(localStorage.getItem('proCarData')) || {
        balance: 100,
        ownedCars: [0],
        selectedCar: 0
    };

    const carModels = [
        { name: "Köhnə", color: "#e74c3c", speed: 5, price: 0 },
        { name: "Sport Blue", color: "#3498db", speed: 8, price: 1500 },
        { name: "Hyper Gold", color: "#f1c40f", speed: 12, price: 5000 }
    ];

    let gameActive = false;
    let score = 0;
    let carPos = { x: 200, y: 530 };
    let enemies = [];
    let frame = 0;

    // MAŞIN ÇİZMƏ FUNKSİYASI (Kvadrat deyil, detallı)
    function drawCar(x, y, color, isPlayer = false) {
        ctx.fillStyle = color;
        // Gövdə
        ctx.fillRect(x + 5, y + 5, 30, 60); 
        // Təkərlər
        ctx.fillStyle = "#000";
        ctx.fillRect(x, y + 10, 8, 15); ctx.fillRect(x + 32, y + 10, 8, 15);
        ctx.fillRect(x, y + 45, 8, 15); ctx.fillRect(x + 32, y + 45, 8, 15);
        // Şüşə
        ctx.fillStyle = isPlayer ? "rgba(0,242,255,0.6)" : "rgba(255,255,255,0.3)";
        ctx.fillRect(x + 10, y + 15, 20, 15);
        // Spoiler (əgər idman maşınıdırsa)
        ctx.fillStyle = color;
        ctx.fillRect(x, y + 60, 40, 5);
    }

    // Oyunçu hərəkəti
    window.addEventListener("keydown", (e) => {
        if(e.key === "ArrowLeft" && carPos.x > 20) carPos.x -= 25;
        if(e.key === "ArrowRight" && carPos.x < canvas.width - 60) carPos.x += 25;
    });

    function save() {
        localStorage.setItem('proCarData', JSON.stringify(player));
        document.getElementById("balance").innerText = player.balance;
    }

    function toggleMarket(show) {
        document.getElementById("market").classList.toggle("hidden", !show);
        if(show) renderMarket();
    }

    function renderMarket() {
        const list = document.getElementById("market-list");
        list.innerHTML = "";
        carModels.forEach((car, i) => {
            const owned = player.ownedCars.includes(i);
            list.innerHTML += `
                <div class="car-card ${player.selectedCar == i ? 'selected' : ''}">
                    <div style="color:${car.color}; font-weight:bold">${car.name}</div>
                    <div style="font-size:12px">Sürət: ${car.speed}</div>
                    ${owned ? 
                        `<button class="buy-btn" onclick="selectCar(${i})">${player.selectedCar == i ? 'SEÇİLİ' : 'SEÇ'}</button>` : 
                        `<button class="buy-btn" onclick="buyCar(${i})">$${car.price}</button>`}
                </div>`;
        });
    }

    function buyCar(i) {
        if(player.balance >= carModels[i].price) {
            player.balance -= carModels[i].price;
            player.ownedCars.push(i);
            save(); renderMarket();
        }
    }

    function selectCar(i) { player.selectedCar = i; save(); renderMarket(); }

    // ADMIN FUNKSİYALARI
    function adminAddCash() {
        player.balance += parseInt(document.getElementById("cashInput").value);
        save();
    }
    function adminUnlockAll() {
        player.ownedCars = [0, 1, 2];
        save(); renderMarket();
    }
    function resetGame() {
        localStorage.removeItem('proCarData');
        location.reload();
    }

    function startGame() {
        document.getElementById("menu").classList.add("hidden");
        gameActive = true; score = 0; enemies = []; carPos.x = 200;
        loop();
    }

    function loop() {
        if(!gameActive) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Yol xətləri
        ctx.strokeStyle = "#444"; ctx.setLineDash([20, 20]);
        ctx.beginPath(); ctx.moveTo(canvas.width/2, 0); ctx.lineTo(canvas.width/2, canvas.height); ctx.stroke();

        // Oyunçu Maşını
        drawCar(carPos.x, carPos.y, carModels[player.selectedCar].color, true);

        // Maneələr (Düşmən maşınlar)
        if(frame % 60 === 0) {
            enemies.push({ x: Math.random() * (canvas.width - 50), y: -100, color: "#95a5a6" });
        }

        enemies.forEach((en, i) => {
            en.y += 5 + (score/100);
            drawCar(en.x, en.y, en.color);

            // Toqquşma
            if(en.y > 480 && en.y < 590 && en.x < carPos.x + 35 && en.x + 35 > carPos.x) {
                gameActive = false;
                document.getElementById("menu").classList.remove("hidden");
                document.getElementById("menu-title").innerText = "OYUN BİTDİ!";
                save();
            }

            if(en.y > canvas.height) {
                enemies.splice(i, 1);
                score += 10;
                player.balance += 20;
                document.getElementById("score").innerText = score;
                document.getElementById("balance").innerText = player.balance;
            }
        });

        frame++;
        requestAnimationFrame(loop);
    }

    save(); // İlk yüklənişdə balansı göstər
</script>
</body>
</html>
