<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sevgilini NÉ™ QÉ™dÉ™r TanÄ±yÄ±rsan? â€” Online 2 Player</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: Arial, Helvetica, sans-serif;
      background: #0d001a;
      color: #e0e0ff;
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      user-select: none;
    }
    h1 { font-size: 3.2rem; margin-bottom: 1rem; color: #ff4dff; text-shadow: 0 0 15px #ff4dff; }
    #status { font-size: 1.5rem; margin: 1.5rem; color: #ffcc00; text-align: center; max-width: 90%; }
    #lobby { text-align: center; }
    input, button {
      font-size: 1.3rem;
      padding: 0.8rem 1.5rem;
      margin: 0.6rem;
      border: none;
      border-radius: 8px;
    }
    button {
      background: #ff4dff;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
    }
    button:hover { background: #ff33ff; transform: scale(1.05); }
    #copyBtn { background: #00cc88; margin-left: 10px; }
    #copyBtn:hover { background: #00ffaa; }
    #copyMessage { color: #00ff88; font-size: 1.1rem; margin-top: 8px; opacity: 0; transition: opacity 0.4s; }
    #game { display: none; width: 100%; height: 100%; flex-direction: column; justify-content: space-between; padding: 2rem; }
    #question { font-size: 2.4rem; margin-bottom: 2rem; text-align: center; line-height: 1.4; }
    .options { display: grid; grid-template-columns: 1fr 1fr; gap: 1.2rem; max-width: 900px; width: 90%; margin: 0 auto; }
    .option {
      background: #2a004d;
      padding: 1.5rem;
      border-radius: 12px;
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.25s;
      border: 3px solid transparent;
      text-align: center;
    }
    .option:hover { background: #440080; transform: translateY(-6px); }
    .option.selected { border-color: #00ff88; background: #003322; }
    #timer { font-size: 3.5rem; font-weight: bold; color: #ff4444; margin: 1rem; }
    #scores { font-size: 1.8rem; margin-top: 2rem; color: #33ff99; }
    #end { font-size: 3rem; color: #ffdd00; text-align: center; display: none; flex-direction: column; gap: 1.5rem; }
  </style>
</head>
<body>

  <h1>Sevgilini NÉ™ QÉ™dÉ™r TanÄ±yÄ±rsan?</h1>
  <div id="status">HazÄ±rlanÄ±r...</div>

  <div id="lobby">
    <button onclick="createHost()">Host ol (ID yarat)</button><br><br>
    <input id="peerIdInput" placeholder="Dostunun ID-sini yaz" style="width:320px;"/>
    <button onclick="joinGame()">QoÅŸul</button>
  </div>

  <div id="game">
    <div id="timer">15</div>
    <div id="question"></div>
    <div class="options" id="options"></div>
    <div id="scores">SÉ™nin dÃ¼zlÉ™rin: 0  â€“  Onun dÃ¼zlÉ™ri: 0</div>
  </div>

  <div id="end">
    <div>Oyun Bitdi!</div>
    <div id="result"></div>
    <button onclick="location.reload()">YenidÉ™n BaÅŸla</button>
  </div>

  <!-- PeerJS -->
  <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>

  <script>
    const status = document.getElementById('status');
    const lobby = document.getElementById('lobby');
    const gameDiv = document.getElementById('game');
    const questionEl = document.getElementById('question');
    const optionsEl = document.getElementById('options');
    const timerEl = document.getElementById('timer');
    const scoresEl = document.getElementById('scores');
    const endEl = document.getElementById('end');
    const resultEl = document.getElementById('result');

    let peer = null;
    let conn = null;
    let myRole = null;
    let myId = '';
    let currentQuestionIndex = 0;
    let timerInterval = null;
    let timeLeft = 15;
    let myScore = 0;
    let opponentScore = 0;
    let answered = false;

    const questions = [
      { q: "Sevgilinin É™n sevdiyi rÉ™ng hansÄ±dÄ±r?", options: ["QÄ±rmÄ±zÄ±", "Mavi", "YaÅŸÄ±l", "Qara"], correct: 1 },
      { q: "Onun uÅŸaqlÄ±q lÉ™qÉ™bi nÉ™ olub?", options: ["Balaca", "Åžirin", "TÃ¼lkÃ¼", "HeÃ§ biri"], correct: 2 },
      { q: "Æn Ã§ox sevdiyi yemÉ™k nÉ™dir?", options: ["Plov", "Pizza", "SuÅŸi", "DÃ¶ner"], correct: 0 },
      { q: "Onun É™n bÃ¶yÃ¼k qorxusu nÉ™dir?", options: ["HÃ¼ndÃ¼rlÃ¼k", "HÃ¶rÃ¼mÃ§É™k", "QaranlÄ±q", "DÉ™niz"], correct: 1 },
      { q: "Sevgilin hansÄ± musiqi janrÄ±nÄ± daha Ã§ox sevir?", options: ["Pop", "Rap", "Rock", "Klassik"], correct: 2 },
      // ... (qalan 15 sual eynidir, yer tutmasÄ±n deyÉ™ burda qÄ±saltdÄ±m)
      { q: "BirlikdÉ™ keÃ§irdiyiniz É™n yaxÅŸÄ± gÃ¼n hansÄ± idi?", options: ["Ä°lk gÃ¶rÃ¼ÅŸ", "SÉ™yahÉ™t", "Ev date", "HeÃ§ biri xÃ¼susi deyil"], correct: 3 }
    ];

    function goFullscreen() {
      const elem = document.documentElement;
      if (elem.requestFullscreen) elem.requestFullscreen();
      else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
      else if (elem.msRequestFullscreen) elem.msRequestFullscreen();
    }

    function createHost() {
      peer = new Peer();
      peer.on('open', id => {
        myId = id;
        myRole = 'host';

        status.innerHTML = `
          Host ID: <strong>${id}</strong><br>
          Dostuna bu ID-ni gÃ¶ndÉ™r!
        `;

        const copyBtn = document.createElement('button');
        copyBtn.id = 'copyBtn';
        copyBtn.textContent = 'ID-ni Kopyala';
        copyBtn.onclick = copyIdToClipboard;

        const copyMsg = document.createElement('div');
        copyMsg.id = 'copyMessage';
        copyMsg.textContent = 'KopyalandÄ±! ðŸš€';

        status.appendChild(copyBtn);
        status.appendChild(copyMsg);

        lobby.querySelector('button[onclick="createHost()"]').disabled = true;
      });

      peer.on('connection', connection => {
        conn = connection;
        conn.on('open', () => {
          status.innerHTML = 'ÆlaqÉ™ quruldu! Oyun baÅŸlayÄ±r...';
          goFullscreen();
          startGame();
        });
        conn.on('data', handleData);
      });
    }

    function copyIdToClipboard() {
      navigator.clipboard.writeText(myId).then(() => {
        const msg = document.getElementById('copyMessage');
        msg.style.opacity = '1';
        setTimeout(() => { msg.style.opacity = '0'; }, 2000);
      }).catch(err => {
        alert('Kopyalama alÄ±nmadÄ±, É™l ilÉ™ kopyala: ' + myId);
      });
    }

    function joinGame() {
      const hostId = document.getElementById('peerIdInput').value.trim();
      if (!hostId) return alert('ID-ni yaz!');

      peer = new Peer();
      peer.on('open', () => {
        conn = peer.connect(hostId);
        conn.on('open', () => {
          myRole = 'guest';
          status.innerHTML = 'QoÅŸuldun! Host oyunu baÅŸladacaq...';
          lobby.style.display = 'none';
        });
        conn.on('data', handleData);
      });
    }

    function handleData(data) {
      if (data.type === 'start') {
        currentQuestionIndex = 0;
        myScore = 0;
        opponentScore = 0;
        goFullscreen();
        startGame();
      }
      else if (data.type === 'answer') {
        if (data.player !== myRole) {
          opponentScore += data.correct ? 1 : 0;
          updateScores();
        }
      }
      else if (data.type === 'next') {
        currentQuestionIndex = data.index;
        answered = false;
        showQuestion();
      }
      else if (data.type === 'timeout') {
        if (data.player !== myRole) {
          status.innerHTML = "RÉ™qib vaxtÄ± Ã¶tÃ¼rdÃ¼ â†’ sÉ™n qazandÄ±n!";
        }
      }
    }

    function startGame() {
      gameDiv.style.display = 'flex';
      lobby.style.display = 'none';
      status.style.display = 'none';
      if (myRole === 'host') conn.send({ type: 'start' });
      showQuestion();
    }

    function showQuestion() {
      if (currentQuestionIndex >= questions.length) {
        endGame();
        return;
      }
      const q = questions[currentQuestionIndex];
      questionEl.textContent = `${currentQuestionIndex+1}/20 â†’ ${q.q}`;
      optionsEl.innerHTML = '';
      q.options.forEach((opt, i) => {
        const div = document.createElement('div');
        div.className = 'option';
        div.textContent = `${String.fromCharCode(65+i)}) ${opt}`;
        div.onclick = () => selectAnswer(i);
        optionsEl.appendChild(div);
      });
      timeLeft = 15;
      timerEl.textContent = timeLeft;
      answered = false;
      clearInterval(timerInterval);
      timerInterval = setInterval(updateTimer, 1000);
    }

    function updateTimer() {
      timeLeft--;
      timerEl.textContent = timeLeft;
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        timerEl.textContent = "VAXT BÄ°TDÄ°!";
        if (!answered) {
          conn.send({ type: 'timeout', player: myRole });
        }
        setTimeout(nextQuestion, 1800);
      }
    }

    function selectAnswer(index) {
      if (answered) return;
      answered = true;
      clearInterval(timerInterval);
      const q = questions[currentQuestionIndex];
      const isCorrect = index === q.correct;
      if (isCorrect) {
        myScore++;
        updateScores();
      }
      conn.send({ type: 'answer', player: myRole, correct: isCorrect });
      const opts = optionsEl.children;
      for (let i = 0; i < opts.length; i++) {
        if (i === index) opts[i].classList.add('selected');
        if (i === q.correct) opts[i].style.borderColor = '#00ff88';
      }
      setTimeout(nextQuestion, 1800);
    }

    function nextQuestion() {
      currentQuestionIndex++;
      if (myRole === 'host') {
        conn.send({ type: 'next', index: currentQuestionIndex });
      }
      showQuestion();
    }

    function updateScores() {
      scoresEl.textContent = `SÉ™nin dÃ¼zlÉ™rin: ${myScore}  â€“  Onun dÃ¼zlÉ™ri: ${opponentScore}`;
    }

    function endGame() {
      clearInterval(timerInterval);
      gameDiv.style.display = 'none';
      endEl.style.display = 'flex';
      let msg = myScore > opponentScore ? "SÉ™n qazandÄ±n! ðŸŽ‰" :
                myScore < opponentScore ? "O qazandÄ±... ðŸ˜" :
                "BÉ™rabÉ™r qaldÄ±! â¤ï¸";
      resultEl.innerHTML = `${msg}<br><br>SÉ™n: ${myScore}/20<br>O: ${opponentScore}/20`;
    }

    status.innerHTML = 'Host ol vÉ™ ya dostunun ID-sini yazaraq qoÅŸul!';
  </script>
</body>
</html>