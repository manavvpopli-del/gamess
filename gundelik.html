<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Online Sevgili Quiz</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: Arial, sans-serif;
      background: #0a0015;
      color: #e0e0ff;
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      user-select: none;
    }
    #status { font-size: 1.6rem; margin: 1.5rem; color: #ffcc00; text-align: center; max-width: 90%; }
    #lobby { text-align: center; }
    input, button {
      font-size: 1.4rem;
      padding: 0.9rem 1.8rem;
      margin: 0.7rem;
      border: none;
      border-radius: 10px;
    }
    button {
      background: #ff33cc;
      color: white;
      cursor: pointer;
      transition: 0.25s;
    }
    button:hover { background: #ff1ab3; transform: scale(1.06); }
    #copyBtn { background: #00dd99; margin-left: 12px; }
    #copyBtn:hover { background: #00ffbb; }
    #nameInput { width: 340px; }
    #game { display: none; width: 100%; height: 100%; flex-direction: column; justify-content: space-between; padding: 1.5rem; }
    #question {
      font-size: 2.4rem;
      margin: 1rem 0 1.5rem;
      text-align: center;
      line-height: 1.35;
      min-height: 100px;
    }
    #qEmoji { font-size: 5rem; margin-bottom: 0.8rem; }
    .options { display: grid; grid-template-columns: 1fr 1fr; gap: 1.3rem; max-width: 1000px; width: 92%; margin: 0 auto; }
    .option {
      background: #220066;
      padding: 1.6rem;
      border-radius: 12px;
      font-size: 1.5rem;
      cursor: pointer;
      transition: 0.3s;
      border: 4px solid transparent;
      text-align: center;
    }
    .option:hover { background: #4400aa; transform: translateY(-6px); }
    .option.selected { border-color: #ffcc00; background: #003311; }
    .option.correct { border-color: #00ff99; background: #002211; }
    #timer { font-size: 4.8rem; font-weight: bold; color: #ff3366; margin: 1rem; }
    #scores { font-size: 1.9rem; margin: 1.5rem 0; color: #33ffaa; }
    #end { 
      display: none; 
      width: 100%; 
      height: 100%; 
      flex-direction: column; 
      align-items: center; 
      padding: 2rem; 
      overflow-y: auto;
    }
    #end h2 { font-size: 3.2rem; margin-bottom: 1.5rem; color: #ffdd44; }
    #result { font-size: 2.2rem; margin-bottom: 2rem; text-align: center; }
    #answersList {
      width: 90%;
      max-width: 900px;
      background: rgba(20,0,50,0.7);
      border-radius: 12px;
      padding: 1.5rem;
      font-size: 1.4rem;
      line-height: 1.6;
      overflow-y: auto;
      max-height: 65vh;
    }
    #answersList div { 
      margin: 1rem 0; 
      padding: 1rem; 
      background: rgba(40,0,80,0.5); 
      border-radius: 10px; 
    }
    #answersList .qnum { font-weight: bold; color: #ff99ff; }
    #answersList .correct { color: #00ff99; }
    #answersList .wrong { color: #ff6666; }
  </style>
</head>
<body>

  <div id="status">HazÄ±rlanÄ±r...</div>

  <div id="lobby">
    <input id="nameInput" placeholder="Ã–z adÄ±nÄ± yaz (mÉ™cburidir)" /><br><br>
    <button onclick="createHost()">Host ol (ID yarat)</button><br><br>
    <input id="peerIdInput" placeholder="Dostunun ID-sini yaz" style="width:340px;"/>
    <button onclick="joinGame()">QoÅŸul</button>
  </div>

  <div id="game">
    <div id="timer">15</div>
    <div id="qEmoji"></div>
    <div id="question"></div>
    <div class="options" id="options"></div>
    <div id="scores">SÉ™n (<span id="myName"></span>): 0  â€“  <span id="oppName">RÉ™qib</span>: 0</div>
  </div>

  <div id="end">
    <h2>Oyun Bitdi!</h2>
    <div id="result"></div>
    <div id="answersList"></div>
    <button onclick="location.reload()" style="margin-top:2rem;">YenidÉ™n BaÅŸla</button>
  </div>

  <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>

  <script>
    const status = document.getElementById('status');
    const lobby = document.getElementById('lobby');
    const gameDiv = document.getElementById('game');
    const qEmoji = document.getElementById('qEmoji');
    const questionEl = document.getElementById('question');
    const optionsEl = document.getElementById('options');
    const timerEl = document.getElementById('timer');
    const scoresEl = document.getElementById('scores');
    const myNameSpan = document.getElementById('myName');
    const oppNameSpan = document.getElementById('oppName');
    const endDiv = document.getElementById('end');
    const resultEl = document.getElementById('result');
    const answersList = document.getElementById('answersList');

    let peer = null;
    let conn = null;
    let myRole = null;
    let myId = '';
    let myName = '';
    let opponentName = 'RÉ™qib';
    let currentQuestionIndex = -1;
    let timerInterval = null;
    let timeLeft = 15;
    let myScore = 0;
    let opponentScore = 0;
    let myAnswers = [];

    const questions = [
      { q: "Sevgilinin É™n sevdiyi 'seks' mÃ¶vqeyi hansÄ±dÄ±r?", options: ["Missionary", "Doggy", "Cowgirl", "69"], correct: 2, emoji: "ðŸ”¥ðŸ˜ˆ" },
      { q: "Onun telefon kilid ÅŸifrÉ™si nÉ™dir?", options: ["SÉ™nin adÄ±n", "1111", "DoÄŸum tarixi", "BilmirÉ™m"], correct: 0, emoji: "ðŸ”’â¤ï¸" },
      { q: "Æn Ã§ox hansÄ± yerdÉ™ seks etmÉ™k istÉ™yir?", options: ["MaÅŸÄ±nda", "MÉ™tbÉ™xdÉ™", "Kinoda", "MeÅŸÉ™dÉ™"], correct: 1, emoji: "ðŸ³ðŸš—" },
      { q: "Onun É™n sevdiyi porno janrÄ± hansÄ±dÄ±r?", options: ["Amateur", "Lesbian", "MILF", "BDSM"], correct: 3, emoji: "ðŸ†ðŸŽ¥" },
      { q: "SÉ™nin haqqÄ±nda É™n Ã§ox nÉ™yi bÉ™yÉ™nir (bÉ™dÉ™n)?", options: ["Dodaqlar", "Popo", "SinÉ™", "ÆllÉ™r"], correct: 1, emoji: "ðŸ‘ðŸ˜" },
      { q: "Onun uÅŸaqlÄ±qda É™n utandÄ±rÄ±cÄ± lÉ™qÉ™bi nÉ™ idi?", options: ["ÅžiÅŸko", "AÄŸlamaq", "TÉ™nbÉ™l", "Qorxaq"], correct: 0, emoji: "ðŸ˜³ðŸ‘¶" },
      { q: "Æn Ã§ox hansÄ± fantaziyanÄ± gizlÉ™dir?", options: ["ÃœÃ§lÃ¼k", "Rol oyunu", "AÃ§Ä±q havada", "BaÄŸlanma"], correct: 2, emoji: "ðŸŒ³ðŸ”—" },
      { q: "Onun É™n pis vÉ™rdiÅŸi nÉ™dir (seksdÉ™)?", options: ["Ã‡ox tez bitirmÉ™k", "DanÄ±ÅŸmamaq", "Ã‡ox sÉ™s Ã§Ä±xarmaq", "YorÄŸunluq"], correct: 0, emoji: "ðŸ˜…ðŸ’¦" },
      { q: "Sevgilin sÉ™ni ilk dÉ™fÉ™ nÉ™ vaxt Ã¶pmÉ™k istÉ™yib?", options: ["Ä°lk gÃ¶rÃ¼ÅŸdÉ™", "2-ci gÃ¶rÃ¼ÅŸdÉ™", "Mesajdan sonra", "HeÃ§ vaxt demÉ™yib"], correct: 1, emoji: "ðŸ’‹ðŸ“±" },
      { q: "Onun É™n sevdiyi orgazm sÉ™si hansÄ±dÄ±r?", options: ["SÉ™nin adÄ±nÄ± Ã§É™kmÉ™k", "UÄŸultu", "QÄ±ÅŸqÄ±rÄ±q", "Susmaq"], correct: 2, emoji: "ðŸ˜©ðŸ”Š" },
      { q: "Æn Ã§ox hansÄ± alt paltarÄ±nÄ± sevir sÉ™nÉ™?", options: ["String", "Lace", "HeÃ§ nÉ™ geyinmÉ™mÉ™k", "Boxer"], correct: 0, emoji: "ðŸ©²ðŸ˜" },
      { q: "Onun gizli sevdiyi seks oyuncaÄŸÄ± varmÄ±?", options: ["Vibrator", "Plugs", "Handcuffs", "Yoxdur"], correct: 3, emoji: "ðŸª¢ðŸ”¥" },
      { q: "SÉ™ninlÉ™ ilk dÉ™fÉ™ nÉ™ vaxt seks etmÉ™k istÉ™yib?", options: ["Ä°lk gÃ¶rÃ¼ÅŸdÉ™", "1 hÉ™ftÉ™ sonra", "1 ay sonra", "Evli olanda"], correct: 1, emoji: "â³â¤ï¸" },
      { q: "Onun É™n Ã§ox qÄ±sqandÄ±ÄŸÄ± ÅŸey nÉ™dir?", options: ["KeÃ§miÅŸ sevgililÉ™r", "DostlarÄ±n", "Telefonun", "Ä°ÅŸin"], correct: 0, emoji: "ðŸ˜ ðŸ’”" },
      { q: "Æn sevdiyi Ã¶pÃ¼ÅŸ yeri haradÄ±r (bÉ™dÉ™n)?", options: ["Boyun", "SinÉ™", "Qulaq", "Dodaq"], correct: 0, emoji: "ðŸ’‹ðŸ§£" },
      { q: "Onun É™n pis breakup sÉ™bÉ™bi nÉ™ olub?", options: ["Aldatma", "MÉ™safÉ™", "Para", "AilÉ™"], correct: 0, emoji: "ðŸ’”ðŸ˜¢" },
      { q: "SÉ™ninlÉ™ seksdÉ™ É™n Ã§ox nÉ™yi bÉ™yÉ™nir?", options: ["Oral", "SÃ¼rÉ™tli", "YavaÅŸ-romantik", "SÉ™rt"], correct: 2, emoji: "ðŸŒ¹ðŸ’¦" },
      { q: "Onun É™n utandÄ±rÄ±cÄ± seks xÉ™yali nÉ™dir?", options: ["Public place", "Ex ilÉ™", "MÉ™nim dostumla", "HeÃ§ demÉ™yib"], correct: 0, emoji: "ðŸ˜³ðŸ™ï¸" },
      { q: "Sevgilin sÉ™ni nÉ™ qÉ™dÉ™r tez-tez dÃ¼ÅŸÃ¼nÃ¼r (gÃ¼n É™rzindÉ™)?", options: ["HÉ™r saat", "YalnÄ±z gecÉ™", "YemÉ™k yeyÉ™ndÉ™", "HeÃ§ vaxt"], correct: 0, emoji: "ðŸ§ â¤ï¸" },
      { q: "Æn son nÉ™ vaxt sÉ™nÉ™ 'sÉ™ni sevirÉ™m' deyib?", options: ["Bu gÃ¼n", "DÃ¼nÉ™n", "1 hÉ™ftÉ™ É™vvÉ™l", "Unutub"], correct: 0, emoji: "ðŸ’•ðŸ—“ï¸" }
    ];

    function goFullscreen() {
      const elem = document.documentElement;
      if (elem.requestFullscreen) elem.requestFullscreen();
      else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
      else if (elem.msRequestFullscreen) elem.msRequestFullscreen();
    }

    function getMyName() {
      const name = document.getElementById('nameInput').value.trim();
      if (!name) {
        alert("AdÄ±nÄ± yazmadan davam edÉ™ bilmÉ™zsÉ™n!");
        return null;
      }
      return name;
    }

    function createHost() {
      myName = getMyName();
      if (!myName) return;

      peer = new Peer();
      peer.on('open', id => {
        myId = id;
        myRole = 'host';
        status.innerHTML = `Host ID: <strong>${id}</strong><br>Dostuna gÃ¶ndÉ™r!<br>SÉ™nin adÄ±n: ${myName}`;
        const copyBtn = document.createElement('button');
        copyBtn.id = 'copyBtn';
        copyBtn.textContent = 'Kopyala';
        copyBtn.onclick = () => {
          navigator.clipboard.writeText(myId).then(() => alert('ID kopyalandÄ±!'));
        };
        status.appendChild(copyBtn);
        lobby.querySelector('button[onclick="createHost()"]').disabled = true;
      });

      peer.on('connection', connection => {
        conn = connection;
        conn.on('open', () => {
          conn.send({ type: 'name', name: myName });
          status.innerHTML = `BaÄŸlantÄ± quruldu! RÉ™qibin adÄ±: ${opponentName}<br>Oyun baÅŸlayÄ±r...`;
          goFullscreen();
          currentQuestionIndex = -1;
          nextQuestion();
        });
        conn.on('data', handleData);
      });
    }

    function joinGame() {
      myName = getMyName();
      if (!myName) return;

      const hostId = document.getElementById('peerIdInput').value.trim();
      if (!hostId) return alert('ID yaz!');

      peer = new Peer();
      peer.on('open', () => {
        conn = peer.connect(hostId);
        conn.on('open', () => {
          conn.send({ type: 'name', name: myName });
          status.innerHTML = 'QoÅŸuldun! GÃ¶zlÉ™...';
          lobby.style.display = 'none';
        });
        conn.on('data', handleData);
      });
    }

    function handleData(data) {
      if (data.type === 'name') {
        opponentName = data.name;
        oppNameSpan.textContent = opponentName;
        if (myRole === 'host') {
          status.innerHTML = `BaÄŸlantÄ± quruldu! RÉ™qibin adÄ±: ${opponentName}<br>Oyun baÅŸlayÄ±r...`;
        } else {
          status.innerHTML = `QoÅŸuldun! RÉ™qibin adÄ±: ${opponentName}<br>Oyun baÅŸlayÄ±r...`;
        }
      }
      else if (data.type === 'next') {
        currentQuestionIndex = data.index;
        showQuestion();
      }
      else if (data.type === 'answer') {
        if (data.player !== myRole) {
          opponentScore += data.correct ? 1 : 0;
          updateScores();
        }
      }
      else if (data.type === 'timeoutBoth') {
        if (currentQuestionIndex === data.index) {
          timerEl.textContent = "VAQT BÄ°TDÄ° â€“ HÆR Ä°KÄ°SÄ° UDZUU!";
          setTimeout(nextQuestion, 2200);
        }
      }
      else if (data.type === 'finalMyAnswers') {
        // Guest-dÉ™n gÉ™lÉ™n cavablar (host Ã¼Ã§Ã¼n)
        showEndScreen(data.answers);
      }
    }

    function nextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex >= questions.length) {
        if (myRole === 'host') {
          // Host guest-dÉ™n cavablarÄ± istÉ™yir
          conn.send({ type: 'requestAnswers' });
        } else {
          // Guest host-a cavablarÄ±nÄ± gÃ¶ndÉ™rir
          conn.send({ type: 'finalMyAnswers', answers: myAnswers });
        }
        showEndScreen(myAnswers); // Ã–z cavablarÄ±nÄ± gÃ¶stÉ™r
        return;
      }

      myAnswers[currentQuestionIndex] = -1;

      if (myRole === 'host') {
        conn.send({ type: 'next', index: currentQuestionIndex });
      }
      showQuestion();
    }

    function showQuestion() {
      const q = questions[currentQuestionIndex];
      qEmoji.textContent = q.emoji;
      questionEl.textContent = q.q;
      optionsEl.innerHTML = '';
      q.options.forEach((opt, i) => {
        const div = document.createElement('div');
        div.className = 'option';
        div.textContent = `${String.fromCharCode(65 + i)}) ${opt}`;
        div.onclick = () => selectAnswer(i);
        optionsEl.appendChild(div);
      });
      timeLeft = 15;
      timerEl.textContent = timeLeft;
      clearInterval(timerInterval);
      timerInterval = setInterval(updateTimer, 1000);
    }

    function updateTimer() {
      timeLeft--;
      timerEl.textContent = timeLeft;
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        timerEl.textContent = "VAQT BÄ°TDÄ°!";
        if (myAnswers[currentQuestionIndex] === -1) {
          // Cavab vermÉ™yibsÉ™ 0
        }
        if (myRole === 'host') {
          conn.send({ type: 'timeoutBoth', index: currentQuestionIndex });
        }
        setTimeout(nextQuestion, 2200);
      }
    }

    function selectAnswer(index) {
      if (myAnswers[currentQuestionIndex] !== -1) return;
      myAnswers[currentQuestionIndex] = index;

      const q = questions[currentQuestionIndex];
      const isCorrect = index === q.correct;
      if (isCorrect) myScore++;

      updateScores();
      conn.send({ type: 'answer', player: myRole, correct: isCorrect });
      highlightOptions(index, q.correct);
    }

    function highlightOptions(myIdx, correctIdx) {
      const opts = optionsEl.children;
      for (let i = 0; i < opts.length; i++) {
        if (i === myIdx) opts[i].classList.add('selected');
        if (i === correctIdx) opts[i].classList.add('correct');
      }
    }

    function updateScores() {
      scoresEl.innerHTML = `SÉ™n (<span style="color:#ff99ff">${myName}</span>): \( {myScore}  â€“  <span style="color:#ff99ff"> \){opponentName}</span>: ${opponentScore}`;
    }

    function showEndScreen(answers = myAnswers) {
      clearInterval(timerInterval);
      gameDiv.style.display = 'none';
      endDiv.style.display = 'flex';

      let msg = myScore > opponentScore ? "SÉ™n uddun! ðŸ”¥" :
                myScore < opponentScore ? "O sÉ™ni yedi... ðŸ˜" : "BÉ™rabÉ™r â€“ eyni sÉ™viyyÉ™dÉ™siniz! ðŸ˜‚";
      resultEl.innerHTML = `\( {msg}<br><br>SÉ™n ( \){myName}): ${myScore} / \( {questions.length}<br> \){opponentName}: ${opponentScore} / ${questions.length}`;

      answersList.innerHTML = '<h3 style="text-align:center; color:#ff99ff; margin-bottom:1rem;">SÉ™nin cavablarÄ±n:</h3>';
      questions.forEach((q, i) => {
        const div = document.createElement('div');
        const yourAns = answers[i] === -1 ? "Cavab vermÉ™din" : q.options[answers[i]];
        const isCorrect = answers[i] === q.correct;

        div.innerHTML = `
          <span class="qnum">${i+1}.</span> ${q.q}<br>
          <strong>DÃ¼zgÃ¼n cavab:</strong> <span class="correct">${q.options[q.correct]}</span><br>
          <strong>SÉ™nin cavabÄ±n:</strong> \( {isCorrect ? '<span class="correct">' : '<span class="wrong">'} \){yourAns}</span>
        `;
        answersList.appendChild(div);
      });
    }

    status.innerHTML = 'AdÄ±nÄ± yaz, sonra Host ol vÉ™ ya ID ilÉ™ qoÅŸul!';
  </script>
</body>
</html>