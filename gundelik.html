<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sevgilini N…ô Q…ôd…ôr Tanƒ±yƒ±rsan?</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: system-ui, -apple-system, sans-serif;
  color: #f0e0ff;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
  overflow-x: hidden;
  background: #0b001f;
}
#bg-video {
  position: fixed; top:0; left:0;
  width:100%; height:100%;
  object-fit: cover;
  z-index:-2;
  filter: brightness(0.5) contrast(1.2);
  preload: metadata;
}
#overlay {
  position: fixed; inset:0;
  background: rgba(0,0,0,0.45);
  z-index:-1;
}
h1 { 
  font-size: clamp(2.2rem, 7vw, 3.5rem); 
  margin: 4vh 0 3vh; 
  color: #ff66cc; 
  text-shadow: 0 0 15px #ff66cc80; 
  z-index:1;
}
#status {
  font-size: clamp(1.4rem, 5vw, 2rem);
  margin: 3vh 0 5vh;
  color: #ffcc66;
  text-align:center;
  max-width:90%;
  z-index:1;
}
#lobby, #game, #end { 
  text-align:center; 
  width:100%; 
  max-width:520px; 
  z-index:1; 
}
input, button {
  font-size: 1.4rem;
  padding: 1rem 2rem;
  margin: 1rem 0.5rem;
  border: none;
  border-radius: 14px;
  width: 100%;
  max-width: 400px;
}
button {
  background: #ff33cc;
  color:white;
  cursor:pointer;
  transition: all 0.3s;
}
button:hover { background:#ff1ab3; transform: translateY(-3px); }
#copyBtn { background:#00cc88; }
#copyBtn:hover { background:#00ffaa; }

#game {
  display: none;
  width:100%;
  max-width:1100px;
  flex-direction: column;
  align-items: center;
  padding:3vh 0;
}
#timer {
  font-size: clamp(5rem, 14vw, 7rem);
  font-weight:bold;
  color:#ff3366;
  margin:3vh 0;
  text-shadow: 0 0 20px #ff3366aa;
}
#timer.warning { color:#ffcc00; animation:pulse 1s infinite; }
#timer.danger { color:#ff0033; animation:shake 0.4s infinite; }
@keyframes pulse { 0%{transform:scale(1);}50%{transform:scale(1.08);}100%{transform:scale(1);} }
@keyframes shake { 0%{transform:translateX(0);}25%{transform:translateX(-4px);}50%{transform:translateX(4px);}75%{transform:translateX(-4px);}100%{transform:translateX(0);} }

#qEmoji { font-size: clamp(6rem, 18vw, 9rem); margin:3vh 0; }
#question { font-size: clamp(1.8rem,6vw,2.8rem); margin:4vh 0 6vh; max-width:90%; line-height:1.45; }
#opponentStatus { font-size:1.1rem; opacity:0.7; margin-bottom:2vh; }

.options {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px,1fr));
  gap:2.5vh;
  width:100%;
  max-width:1000px;
}
.option {
  background: rgba(60,0,110,0.8);
  padding: 3vh 5vw;
  border-radius:18px;
  font-size: clamp(1.3rem, 4.5vw,1.8rem);
  cursor:pointer;
  transition: all 0.35s ease;
  border:3px solid transparent;
  text-align:center;
  backdrop-filter: blur(6px);
}
.option:hover { background: rgba(100,0,160,0.95); transform: translateY(-6px); border-color:#ff99ff; }
.option.selected { border-color:#00ffcc; background: rgba(0,80,60,0.75); pointer-events:none; opacity:1; }

#end {
  display:none;
  width:100%;
  max-width:1000px;
  flex-direction:column;
  align-items:center;
  padding:5vh 0;
}
#end h2 { font-size: clamp(3rem,8vw,4.2rem); color:#ffdd44; margin-bottom:4vh; }
#result { font-size: clamp(1.8rem,5.5vw,2.4rem); text-align:center; margin-bottom:5vh; }
#answersList { width:100%; background: rgba(40,0,70,0.75); border-radius:18px; padding:4vh; font-size: clamp(1.2rem,4vw,1.5rem); line-height:1.8; margin-bottom:5vh; }
#answersList div { margin:2.5vh 0; padding:2.5vh; background: rgba(60,0,100,0.65); border-radius:14px; }

button#downloadPdf, button#restartBtn { font-size:1.5rem; padding:1.2rem 3rem; margin:2vh; }
#downloadPdf { background:#3366ff; } #downloadPdf:hover { background:#5588ff; }

#waiting { font-size:1.5rem; color:#ffcc66; margin-top:3vh; text-align:center; }

</style>
</head>
<body>

<video id="bg-video" autoplay muted loop playsinline>
  <source src="videoo.mp4" type="video/mp4">
  Brauzeriniz video d…ôst…ôkl…ômir.
</video>
<div id="overlay"></div>

<h1>Sevgilini N…ô Q…ôd…ôr Tanƒ±yƒ±rsan?</h1>
<div id="status">Host ol v…ô ya dostunun ID-sini yazaraq qo≈üul!</div>

<div id="lobby">
  <button onclick="createHost()">Host ol (ID yarat)</button>
  <input id="peerIdInput" placeholder="Dostunun ID-sini yaz">
  <button onclick="joinGame()">Qo≈üul</button>
</div>

<div id="game">
  <div id="timer">15</div>
  <div id="qEmoji"></div>
  <div id="question"></div>
  <div id="opponentStatus">R…ôqib cavablayƒ±r...</div>
  <div class="options" id="options"></div>
</div>

<div id="end">
  <h2>Oyun Bitdi!</h2>
  <div id="result"></div>
  <div id="answersList"></div>
  <button id="downloadPdf">PDF olaraq y√ºkl…ô</button>
  <button id="restartBtn" onclick="requestRestart()">Yenid…ôn Ba≈ülat</button>
  <div id="waiting"></div>
</div>

<script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
const { jsPDF } = window.jspdf;

const status = document.getElementById('status');
const lobby = document.getElementById('lobby');
const gameDiv = document.getElementById('game');
const qEmoji = document.getElementById('qEmoji');
const questionEl = document.getElementById('question');
const optionsEl = document.getElementById('options');
const timerEl = document.getElementById('timer');
const endDiv = document.getElementById('end');
const resultEl = document.getElementById('result');
const answersList = document.getElementById('answersList');
const waitingEl = document.getElementById('waiting');
const opponentStatus = document.getElementById('opponentStatus');

let peer=null, conn=null, myRole='', myId='';
let currentQuestionIndex=-1, timerInterval=null, timeLeft=15;
let myAnswered=false, opponentAnswered=false;
let myAnswers = new Array(30).fill(-1);
let restartRequested=false, opponentRestartRequested=false;

// ================= QUESTIONS =================
const questions = [
  {q:"Sevgilinin …ôn sevdiyi r…ông hansƒ±dƒ±r?", options:["Qƒ±rmƒ±zƒ±","Mavi","Ya≈üƒ±l","Sarƒ±","B…ôn√∂v≈ü…ôyi","Qara"], emoji:"üé®"},
  {q:"U≈üaqlƒ±qda …ôn √ßox sevdiyi oyuncaq n…ô idi?", options:["Ayƒ± balasƒ±","Ma≈üƒ±n","Kukla","Lego","Top","Robot"], emoji:"üß∏"},
  {q:"∆èn sevdiyi yem…ôk hansƒ±dƒ±r?", options:["Plov","Pizza","Dolma","Lava≈ü","Kabab","Sushi"], emoji:"üç≤"},
  {q:"S…ôh…ôr tezd…ôn ilk n…ô edir?", options:["Telefonuna baxƒ±r","Kofe/√ßay i√ßir","ƒ∞dman edir","Yenid…ôn yatƒ±r","Du≈ü alƒ±r","Kitab oxuyur"], emoji:"‚òï"},
  {q:"∆èn √ßox sevdiyi musiqi janrƒ± hansƒ±dƒ±r?", options:["Pop","Rap","Rock","Klassik","Xalq","Elektronika"], emoji:"üéµ"},
  {q:"U≈üaqlƒ±q l…ôq…ôbi n…ô olub?", options:["Balaca","≈ûirin","T√ºlk√º","≈ûi≈üko","Yaramaz","He√ß l…ôq…ôbi olmayƒ±b"], emoji:"üòÑ"},
  {q:"∆èn b√∂y√ºk qorxusu n…ôdir?", options:["H√ºnd√ºrl√ºk","Qaranlƒ±q","H√∂r√ºm√ß…ôk","T…ôk qalmaq","ƒ∞yn…ô","D…ôniz"], emoji:"üò±"},
  {q:"∆èn sevdiyi film janrƒ± hansƒ±dƒ±r?", options:["Komediya","Romantika","Dram","Aksiya","Fantastika","D…ôh≈ü…ôt"], emoji:"üé¨"},
  {q:"∆èn √ßox sevdiyi m√∂vs√ºm hansƒ±dƒ±r?", options:["Yay","Payƒ±z","Qƒ±≈ü","Yaz"], emoji:"üçÇ"},
  {q:"Telefonunun arxa fonunda n…ô var?", options:["Selfi","M…ônz…ôr…ô","Heyvan","Qara ekran","Musiqi qrupu","S…ôn"], emoji:"üì±"},
  {q:"∆èn sevdiyi heyvan hansƒ±dƒ±r?", options:["Pi≈üik","ƒ∞t","Qu≈ü","At","Panda","Delfin"], emoji:"üê±"},
  {q:"∆èn √ßox sevdiyi i√ßki n…ôdir?", options:["Kola","√áay","Kofe","≈ûir…ô","Su","Limonad"], emoji:"ü•§"},
  {q:"U≈üaqlƒ±qda hansƒ± idman n√∂v√º il…ô m…ô≈üƒüul olub?", options:["Futbol","√úzg√º√ß√ºl√ºk","R…ôqs","Voleybol","G√ºl…ô≈ü","He√ß biri"], emoji:"‚öΩ"},
  {q:"∆èn sevdiyi t…ôtil yeri haradƒ±r?", options:["D…ôniz","Daƒü","≈û…ôh…ôr","K…ônd","Xaricd…ô","Evind…ô"], emoji:"üèñÔ∏è"},
  {q:"∆èn b√∂y√ºk x…ôyalƒ± n…ôdir?", options:["S…ôyah…ôt","Z…ônginlik","Ail…ô qurmaq","≈û√∂hr…ôt","√ñz biznesini qurmaq","Sakit h…ôyat"], emoji:"üåü"},
  {q:"∆èn pis v…ôrdi≈üi n…ôdir?", options:["Gec yatmaq","√áox telefon istifad…ôsi","Unutqanlƒ±q","Dƒ±rnaq yem…ôk","Gecikm…ôk","√áox danƒ±≈ümamaq"], emoji:"üòÖ"},
  {q:"∆èn √ßox sevdiyi emoji hansƒ±dƒ±r?", options:["üòÇ","‚ù§Ô∏è","üî•","üòà","ü•∞","ü§¶‚Äç‚ôÄÔ∏è"], emoji:"üòè"},
  {q:"S…ôh…ôr yuxudan oyananda ilk n…ô d√º≈ü√ºn√ºr?", options:["Kofe","Telefon","Yem…ôk","Yenid…ôn yatmaq","ƒ∞≈ü","S…ôyah…ôt"], emoji:"üõå"},
  {q:"∆èn sevdiyi zarafat n√∂v√º hansƒ±dƒ±r?", options:["Qara yumor","Sarkazm","Klassik","Zarafat sevmir","Dadlƒ± zarafatlar","P…ôd…ôr≈ü…ôkilli"], emoji:"ü§°"},
  {q:"Onun ideal h…ôft…ôsonu nec…ô ke√ßir?", options:["Evde film izl…ôm…ôk","√á√∂l…ô √ßƒ±xmaq","Yuxu √ß…ôkm…ôk","Dostlarla g√∂r√º≈ü","Alƒ±≈ü-veri≈ü","T…ôbi…ôtd…ô g…ôzm…ôk"], emoji:"üõãÔ∏è"},
  {q:"∆èn sevdiyi kitab janrƒ± hansƒ±dƒ±r?", options:["Roman","Detektiv","Fantastika","Psixologiya","He√ß oxumur","≈ûeir"], emoji:"üìö"},
  {q:"U≈üaqlƒ±qda …ôn sevdiyi cizgi filmi hansƒ± idi?", options:["≈ûrek","Aslan Kral","Donanma","Tom v…ô Cerri","SpongeBob","Dig…ôr"], emoji:"üì∫"},
  {q:"∆èn √ßox sevdiyi qoxu hansƒ±dƒ±r?", options:["∆ètir","Yaƒüƒ±≈üdan sonra torpaq","T…ôz…ô √ß√∂r…ôk","D…ôniz","Kofe","G√ºl"], emoji:"üåπ"},
  {q:"∆èn √ßox sevdiyi r…ôqs n√∂v√º hansƒ±dƒ±r?", options:["Latin","Hip-hop","Vals","R…ôqs etmir","Folklor","Tango"], emoji:"üíÉ"},
  {q:"∆èn sevdiyi r…ông kombinasiyasƒ± hansƒ±dƒ±r?", options:["Qara-aƒü","Qƒ±rmƒ±zƒ±-qara","Mavi-aƒü","Ya≈üƒ±l-q…ôhv…ôyi","√á…ôhrayƒ±-boz","Dig…ôr"], emoji:"üåà"},
  {q:"U≈üaqlƒ±qda …ôn √ßox sevdiyi ≈üirniyyat n…ô idi?", options:["≈ûokolad","Konfet","Tort","Dondurma","Pi≈ümi≈ü x…ômir","Qoz-fƒ±ndƒ±q"], emoji:"üç´"},
  {q:"∆èn √ßox sevdiyi idman n√∂v√ºn√º izl…ôm…ôyi sevir?", options:["Futbol","Basketbol","Tennis","Formula 1","Boks","He√ß izl…ômir"], emoji:"üèÄ"},
  {q:"∆èn sevdiyi bayram hansƒ±dƒ±r?", options:["Yeni il","Novruz","Ad g√ºn√º","Sevgilil…ôr g√ºn√º","Qurban bayramƒ±","M√ºst…ôqillik g√ºn√º"], emoji:"üéâ"},
  {q:"∆èn √ßox sevdiyi hava ≈ü…ôraiti nec…ôdir?", options:["G√ºn…ô≈üli","Yaƒüƒ±≈ülƒ±","Qarlƒ±","S…ôrin k√ºl…ôkli","ƒ∞sti yay g√ºn√º","Payƒ±z yarpaqlarƒ±"], emoji:"‚õÖ"},
  {q:"∆èn sevdiyi sosial ≈ü…ôb…ôk…ô hansƒ±dƒ±r?", options:["Instagram","TikTok","Telegram","Facebook","Twitter/X","He√ß istifad…ô etmir"], emoji:"üì±"}
];

// =============== PEER LOGIC ===============
function createHost() {
  peer = new Peer();
  myRole='host';
  peer.on('open', id=>{
    myId=id;
    status.innerHTML=`Host ID: <strong>${id}</strong><br>Dostuna g√∂nd…ôr!`;
    const copyBtn=document.createElement('button');
    copyBtn.id='copyBtn'; copyBtn.textContent='Kopyala';
    copyBtn.onclick=()=>navigator.clipboard.writeText(myId).then(()=>alert('ID kopyalandƒ±!'));
    status.appendChild(copyBtn);
    lobby.querySelector('button[onclick="createHost()"]').disabled=true;
  });

  peer.on('connection', c=>{
    conn=c;
    conn.on('open', ()=>{
      status.innerHTML='Baƒülantƒ± quruldu! Oyun ba≈ülayƒ±r...';
      lobby.style.display='none'; gameDiv.style.display='flex';
      setTimeout(nextQuestion,1000);
    });
    conn.on('data', handleData);
  });

  peer.on('disconnected', ()=>{ status.innerHTML="Baƒülantƒ± k…ôsildi. Yenid…ôn qo≈üul..."; });
  peer.on('error', e=>alert("Baƒülantƒ± x…ôtasƒ±: "+e.type));
}

function joinGame() {
  const hostId=document.getElementById('peerIdInput').value.trim();
  if(!hostId) return alert('ID yaz!');
  peer=new Peer(); myRole='guest';
  peer.on('open',()=>{
    conn=peer.connect(hostId);
    conn.on('open', ()=>{
      status.innerHTML='Qo≈üuldun! Oyun ba≈ülayƒ±r...';
      lobby.style.display='none'; gameDiv.style.display='flex';
    });
    conn.on('data', handleData);
  });
  peer.on('error', e=>alert("Baƒülantƒ± x…ôtasƒ±: "+e.type));
}

function handleData(data) {
  if(data.type==='next'){
    currentQuestionIndex=data.index;
    myAnswered=false; opponentAnswered=false;
    showQuestion();
  } else if(data.type==='answered'){
    if(data.player!==myRole){
      opponentAnswered=true;
      opponentStatus.textContent="R…ôqib cavabladƒ± ‚úîÔ∏è";
      checkBothAnswered();
    }
  } else if(data.type==='restart'){
    opponentRestartRequested=true;
    checkRestart();
  }
}

// =============== GAME LOGIC ===============
function nextQuestion(){
  currentQuestionIndex++;
  if(currentQuestionIndex>=questions.length){ showEndScreen(); return; }
  myAnswered=false; opponentAnswered=false;
  if(myRole==='host') conn.send({type:'next', index:currentQuestionIndex});