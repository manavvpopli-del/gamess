<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sevgilini NÉ™ QÉ™dÉ™r TanÄ±yÄ±rsan?</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #0d001a, #220033);
      color: #f0e0ff;
      min-height: 100vh;
      padding: 3vh 5vw;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 { 
      font-size: clamp(2.2rem, 7vw, 3.5rem); 
      margin: 4vh 0 3vh; 
      color: #ff66cc; 
      text-shadow: 0 0 15px #ff66cc80; 
    }
    #status {
      font-size: clamp(1.4rem, 5vw, 2rem);
      margin: 3vh 0 5vh;
      color: #ffcc66;
      text-align: center;
      max-width: 90%;
    }
    #lobby { text-align: center; width: 100%; max-width: 520px; }
    input, button {
      font-size: 1.4rem;
      padding: 1rem 2rem;
      margin: 1.2rem 0.6rem;
      border: none;
      border-radius: 14px;
      width: 100%;
      max-width: 400px;
    }
    button {
      background: #ff33cc;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
    }
    button:hover { background: #ff1ab3; transform: translateY(-4px); }
    #copyBtn { background: #00cc88; }
    #copyBtn:hover { background: #00ffaa; }

    #game {
      display: none;
      width: 100%;
      max-width: 1100px;
      flex-direction: column;
      align-items: center;
      padding: 3vh 0;
    }
    #timer {
      font-size: clamp(5rem, 14vw, 7rem);
      font-weight: bold;
      color: #ff3366;
      margin: 3vh 0;
    }
    #qEmoji { font-size: clamp(6rem, 18vw, 9rem); margin: 3vh 0; }
    #question {
      font-size: clamp(1.8rem, 6vw, 2.8rem);
      text-align: center;
      line-height: 1.45;
      margin: 4vh 0 6vh;
      max-width: 90%;
    }
    .options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2.5vh;
      width: 100%;
      max-width: 1000px;
    }
    .option {
      background: rgba(60,0,110,0.75);
      padding: 3vh 5vw;
      border-radius: 18px;
      font-size: clamp(1.3rem, 4.5vw, 1.8rem);
      cursor: pointer;
      transition: all 0.35s ease;
      border: 3px solid transparent;
      text-align: center;
      backdrop-filter: blur(5px);
    }
    .option:hover {
      background: rgba(100,0,160,0.9);
      transform: translateY(-8px);
      border-color: #ff99ff;
    }
    .option.selected {
      border-color: #00ffcc;
      background: rgba(0,80,60,0.65);
    }
    #scores {
      font-size: clamp(1.7rem, 5.5vw, 2.3rem);
      margin: 6vh 0 4vh;
      color: #33ffcc;
    }

    #end {
      display: none;
      width: 100%;
      max-width: 1000px;
      flex-direction: column;
      align-items: center;
      padding: 5vh 0;
    }
    #end h2 { font-size: clamp(3rem, 8vw, 4.2rem); color: #ffdd44; margin-bottom: 4vh; }
    #result { font-size: clamp(1.8rem, 5.5vw, 2.4rem); text-align: center; margin-bottom: 5vh; }
    #answersList {
      width: 100%;
      background: rgba(40,0,70,0.65);
      border-radius: 18px;
      padding: 4vh;
      font-size: clamp(1.2rem, 4vw, 1.5rem);
      line-height: 1.8;
      margin-bottom: 5vh;
    }
    #answersList div { margin: 2.5vh 0; padding: 2.5vh; background: rgba(60,0,100,0.55); border-radius: 14px; }
    button#downloadPdf, button#restartBtn {
      font-size: 1.5rem;
      padding: 1.2rem 3rem;
      margin: 2vh;
    }
    #downloadPdf { background: #3366ff; }
    #downloadPdf:hover { background: #5588ff; }
    #waiting { font-size: 1.5rem; color: #ffcc66; margin-top: 3vh; text-align: center; }
  </style>
</head>
<body>

  <h1>Sevgilini NÉ™ QÉ™dÉ™r TanÄ±yÄ±rsan?</h1>
  <div id="status">HazÄ±rlanÄ±r...</div>

  <div id="lobby">
    <button onclick="createHost()">Host ol (ID yarat)</button>
    <input id="peerIdInput" placeholder="Dostunun ID-sini yaz" />
    <button onclick="joinGame()">QoÅŸul</button>
  </div>

  <div id="game">
    <div id="timer">15</div>
    <div id="qEmoji"></div>
    <div id="question"></div>
    <div class="options" id="options"></div>
    <div id="scores">SÉ™n: 0 â€“ O: 0</div>
  </div>

  <div id="end">
    <h2>Oyun Bitdi!</h2>
    <div id="result"></div>
    <div id="answersList"></div>
    <button id="downloadPdf">PDF olaraq yÃ¼klÉ™</button>
    <button id="restartBtn" onclick="requestRestart()">YenidÉ™n BaÅŸlat</button>
    <div id="waiting"></div>
  </div>

  <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    const { jsPDF } = window.jspdf;

    const status = document.getElementById('status');
    const lobby = document.getElementById('lobby');
    const gameDiv = document.getElementById('game');
    const qEmoji = document.getElementById('qEmoji');
    const questionEl = document.getElementById('question');
    const optionsEl = document.getElementById('options');
    const timerEl = document.getElementById('timer');
    const scoresEl = document.getElementById('scores');
    const endDiv = document.getElementById('end');
    const resultEl = document.getElementById('result');
    const answersList = document.getElementById('answersList');
    const waitingEl = document.getElementById('waiting');

    let peer = null;
    let conn = null;
    let myRole = null;
    let myId = '';
    let currentQuestionIndex = -1;
    let timerInterval = null;
    let timeLeft = 15;
    let myScore = 0;
    let opponentScore = 0;
    let myAnswered = false;
    let opponentAnswered = false;
    let myAnswers = [];
    let restartRequested = false;
    let opponentRestartRequested = false;

    const questions = [
      { q: "Sevgilinin É™n sevdiyi rÉ™ng hansÄ±dÄ±r?", options: ["QÄ±rmÄ±zÄ±", "Mavi", "YaÅŸÄ±l", "SarÄ±"], emoji: "ðŸŽ¨" },
      { q: "UÅŸaqlÄ±qda É™n Ã§ox sevdiyi oyuncaq nÉ™ idi?", options: ["AyÄ± balasÄ±", "MaÅŸÄ±n", "Kukla", "Lego"], emoji: "ðŸ§¸" },
      { q: "Æn sevdiyi yemÉ™k hansÄ±dÄ±r?", options: ["Plov", "Pizza", "Dolma", "Åžirniyyat"], emoji: "ðŸ²" },
      { q: "SÉ™hÉ™r tezdÉ™n ilk nÉ™ edir?", options: ["Telefonuna baxÄ±r", "Kofe/Ã§ay iÃ§ir", "Ä°dman edir", "YenidÉ™n yatÄ±r"], emoji: "â˜•" },
      { q: "Æn Ã§ox sevdiyi musiqi janrÄ± hansÄ±dÄ±r?", options: ["Pop", "Rap", "Rock", "Klassik"], emoji: "ðŸŽµ" },
      { q: "UÅŸaqlÄ±q lÉ™qÉ™bi nÉ™ olub?", options: ["Balaca", "Åžirin", "TÃ¼lkÃ¼", "HeÃ§ lÉ™qÉ™bi olmayÄ±b"], emoji: "ðŸ˜„" },
      { q: "Æn bÃ¶yÃ¼k qorxusu nÉ™dir?", options: ["HÃ¼ndÃ¼rlÃ¼k", "QaranlÄ±q", "HÃ¶rÃ¼mÃ§É™k", "TÉ™k qalmaq"], emoji: "ðŸ˜±" },
      { q: "Æn sevdiyi film janrÄ± hansÄ±dÄ±r?", options: ["Komediya", "Romantika", "Dram", "Aksiya"], emoji: "ðŸŽ¬" },
      { q: "Æn Ã§ox sevdiyi mÃ¶vsÃ¼m hansÄ±dÄ±r?", options: ["Yay", "PayÄ±z", "QÄ±ÅŸ", "Yaz"], emoji: "ðŸ‚" },
      { q: "Telefonunun arxa fonunda nÉ™ var?", options: ["Selfi", "MÉ™nzÉ™rÉ™", "Heyvan", "Qara ekran"], emoji: "ðŸ“±" },
      { q: "Æn sevdiyi heyvan hansÄ±dÄ±r?", options: ["PiÅŸik", "Ä°t", "QuÅŸ", "At"], emoji: "ðŸ±" },
      { q: "Æn Ã§ox sevdiyi iÃ§ki nÉ™dir?", options: ["Kola", "Ã‡ay", "Kofe", "ÅžirÉ™"], emoji: "ðŸ¥¤" },
      { q: "UÅŸaqlÄ±qda hansÄ± idman nÃ¶vÃ¼ ilÉ™ mÉ™ÅŸÄŸul olub?", options: ["Futbol", "ÃœzgÃ¼Ã§Ã¼lÃ¼k", "RÉ™qs", "HeÃ§ biri"], emoji: "âš½" },
      { q: "Æn sevdiyi tÉ™til yeri haradÄ±r?", options: ["DÉ™niz", "DaÄŸ", "ÅžÉ™hÉ™r", "KÉ™nd"], emoji: "ðŸ–ï¸" },
      { q: "Æn bÃ¶yÃ¼k xÉ™yalÄ± nÉ™dir?", options: ["SÉ™yahÉ™t", "ZÉ™nginlik", "AilÉ™ qurmaq", "ÅžÃ¶hrÉ™t"], emoji: "ðŸŒŸ" },
      { q: "Æn pis vÉ™rdiÅŸi nÉ™dir?", options: ["Gec yatmaq", "Ã‡ox telefon istifadÉ™si", "UnutqanlÄ±q", "DÄ±rnaq yemÉ™k"], emoji: "ðŸ˜…" },
      { q: "Æn Ã§ox sevdiyi emoji hansÄ±dÄ±r?", options: ["ðŸ˜‚", "â¤ï¸", "ðŸ”¥", "ðŸ˜ˆ"], emoji: "ðŸ˜" },
      { q: "SÉ™hÉ™r yuxudan oyananda ilk nÉ™ dÃ¼ÅŸÃ¼nÃ¼r?", options: ["Kofe", "Telefon", "SÉ™n", "YenidÉ™n yatmaq"], emoji: "ðŸ›Œ" },
      { q: "Æn sevdiyi zarafat nÃ¶vÃ¼ hansÄ±dÄ±r?", options: ["Qara yumor", "Sarkazm", "Klassik", "Zarafat sevmir"], emoji: "ðŸ¤¡" },
      { q: "Onun ideal hÉ™ftÉ™sonu necÉ™ keÃ§ir?", options: ["Evde film izlÉ™mÉ™k", "Ã‡Ã¶lÉ™ Ã§Ä±xmaq", "Yuxu Ã§É™kmÉ™k", "Dostlarla gÃ¶rÃ¼ÅŸ"], emoji: "ðŸ›‹ï¸" }
    ];

    function createHost() {
      peer = new Peer();
      peer.on('open', id => {
        myId = id;
        myRole = 'host';
        status.innerHTML = `Host ID: <strong>${id}</strong><br>Dostuna gÃ¶ndÉ™r!`;
        const copyBtn = document.createElement('button');
        copyBtn.id = 'copyBtn';
        copyBtn.textContent = 'Kopyala';
        copyBtn.onclick = () => navigator.clipboard.writeText(myId).then(() => alert('ID kopyalandÄ±!'));
        status.appendChild(copyBtn);
        lobby.querySelector('button[onclick="createHost()"]').disabled = true;
      });

      peer.on('connection', connection => {
        conn = connection;
        conn.on('open', () => {
          status.innerHTML = 'BaÄŸlantÄ± quruldu! Oyun baÅŸlayÄ±r...';
          lobby.style.display = 'none';
          gameDiv.style.display = 'flex';
          setTimeout(nextQuestion, 1000);
        });
        conn.on('data', handleData);
      });
    }

    function joinGame() {
      const hostId = document.getElementById('peerIdInput').value.trim();
      if (!hostId) return alert('ID yaz!');

      peer = new Peer();
      peer.on('open', () => {
        conn = peer.connect(hostId);
        conn.on('open', () => {
          status.innerHTML = 'QoÅŸuldun! Oyun baÅŸlayÄ±r...';
          lobby.style.display = 'none';
          gameDiv.style.display = 'flex';
        });
        conn.on('data', handleData);
      });
    }

    function handleData(data) {
      if (data.type === 'next') {
        currentQuestionIndex = data.index;
        myAnswered = false;
        opponentAnswered = false;
        myAnswers[currentQuestionIndex] = -1;
        showQuestion();
      } else if (data.type === 'answered') {
        if (data.player !== myRole) {
          opponentAnswered = true;
          opponentScore++;
          updateScores();
          checkBothAnswered();
        }
      } else if (data.type === 'restart') {
        opponentRestartRequested = true;
        checkRestart();
      }
    }

    function nextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex >= questions.length) {
        showEndScreen();
        return;
      }

      if (myRole === 'host') {
        conn.send({ type: 'next', index: currentQuestionIndex });
      }
      showQuestion();
    }

    function showQuestion() {
      const q = questions[currentQuestionIndex];
      qEmoji.textContent = q.emoji;
      questionEl.textContent = q.q;
      optionsEl.innerHTML = '';
      q.options.forEach((opt, i) => {
        const div = document.createElement('div');
        div.className = 'option';
        div.textContent = `${String.fromCharCode(65 + i)}) ${opt}`;
        div.onclick = () => selectAnswer(i);
        optionsEl.appendChild(div);
      });
      timeLeft = 15;
      timerEl.textContent = timeLeft;
      clearInterval(timerInterval);
      timerInterval = setInterval(updateTimer, 1000);
    }

    function updateTimer() {
      if (myAnswered && opponentAnswered) return;
      timeLeft--;
      timerEl.textContent = timeLeft;
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        timerEl.textContent = "VAQT BÄ°TDÄ°!";
        setTimeout(nextQuestion, 1800);
      }
    }

    function selectAnswer(index) {
      if (myAnswered) return;
      myAnswered = true;
      myAnswers[currentQuestionIndex] = index;
      myScore++;
      updateScores();
      conn.send({ type: 'answered', player: myRole });
      optionsEl.children[index].classList.add('selected');
      checkBothAnswered();
    }

    function checkBothAnswered() {
      if (myAnswered && opponentAnswered) {
        clearInterval(timerInterval);
        timerEl.textContent = "HazÄ±r!";
        setTimeout(nextQuestion, 1500);
      }
    }

    function updateScores() {
      scoresEl.textContent = `SÉ™n: ${myScore} â€“ O: ${opponentScore}`;
    }

    function showEndScreen() {
      clearInterval(timerInterval);
      gameDiv.style.display = 'none';
      endDiv.style.display = 'flex';

      let msg = myScore > opponentScore ? "SÉ™n daha Ã§ox tanÄ±yÄ±rsan! ðŸ”¥" :
                myScore < opponentScore ? "O sÉ™ndÉ™n daha Ã§ox bilir... ðŸ˜" : "Eyni sÉ™viyyÉ™dÉ™siniz! ðŸ˜‚";
      resultEl.innerHTML = `${msg}<br><br>SÉ™n: ${myScore} cavab verdin<br>O: ${opponentScore} cavab verdi`;

      answersList.innerHTML = '<h3 style="text-align:center; color:#ff99ff; margin-bottom:2vh;">SÉ™nin cavablarÄ±n:</h3>';
      questions.forEach((q, i) => {
        const ans = myAnswers[i] === -1 ? "Cavab vermÉ™din" : q.options[myAnswers[i]];
        const div = document.createElement('div');
        div.innerHTML = `<strong>${i+1}.</strong> ${q.q}<br><strong>CavabÄ±n:</strong> ${ans}`;
        answersList.appendChild(div);
      });

      document.getElementById('downloadPdf').onclick = downloadPDF;
    }

    function downloadPDF() {
      const doc = new jsPDF();
      doc.setFontSize(18);
      doc.text("Sevgilini NÉ™ QÉ™dÉ™r TanÄ±yÄ±rsan? - SÉ™nin CavablarÄ±n", 20, 20);
      doc.setFontSize(12);
      let y = 40;
      questions.forEach((q, i) => {
        const ans = myAnswers[i] === -1 ? "Cavab vermÉ™din" : q.options[myAnswers[i]];
        doc.text(`${i+1}. ${q.q}`, 20, y);
        y += 8;
        doc.text(`CavabÄ±n: ${ans}`, 30, y);
        y += 12;
        if (y > 270) { doc.addPage(); y = 20; }
      });
      doc.save("sevgili-testi.pdf");
    }

    function requestRestart() {
      restartRequested = true;
      if (myRole === 'host') conn.send({ type: 'restart' });
      checkRestart();
    }

    function checkRestart() {
      if (restartRequested && opponentRestartRequested) {
        myScore = 0; opponentScore = 0; myAnswers = []; currentQuestionIndex = -1;
        endDiv.style.display = 'none';
        gameDiv.style.display = 'flex';
        waitingEl.textContent = '';
        nextQuestion();
      } else {
        waitingEl.textContent = opponentRestartRequested 
          ? "RÉ™qib yenidÉ™n baÅŸlamaÄŸÄ± istÉ™yir... SÉ™n dÉ™ bas!" 
          : "RÉ™qibin dÉ™ basmasÄ±nÄ± gÃ¶zlÉ™yirik...";
      }
    }

    status.innerHTML = 'Host ol vÉ™ ya dostunun ID-sini yazaraq qoÅŸul!';
  </script>
</body>
</html>