<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sevgilini N…ô Q…ôd…ôr Tanƒ±yƒ±rsan?</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      color: #f0e0ff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      overflow-x: hidden;
    }
    #bg-video {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      object-fit: cover;
      z-index: -2;
    }
    #overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      z-index: -1;
    }
    h1 { 
      font-size: clamp(2.2rem, 7vw, 3.5rem); 
      margin: 4vh 0 3vh; 
      color: #ff66cc; 
      text-shadow: 0 0 15px #ff66cc80; 
      z-index: 1;
    }
    #status {
      font-size: clamp(1.4rem, 5vw, 2rem);
      margin: 3vh 0 5vh;
      color: #ffcc66;
      text-align: center;
      max-width: 90%;
      z-index: 1;
    }
    #lobby { 
      text-align: center; 
      width: 100%; 
      max-width: 520px; 
      z-index: 1; 
      display: none;
    }
    input, button {
      font-size: 1.4rem;
      padding: 1rem 2rem;
      margin: 1.2rem 0.6rem;
      border: none;
      border-radius: 14px;
      width: 100%;
      max-width: 400px;
    }
    button {
      background: #ff33cc;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
    }
    button:hover { background: #ff1ab3; transform: translateY(-4px); }
    #copyBtn { background: #00cc88; }
    #copyBtn:hover { background: #00ffaa; }

    #game {
      display: none;
      width: 100%;
      max-width: 1100px;
      flex-direction: column;
      align-items: center;
      padding: 3vh 0;
      z-index: 1;
    }
    #start-btn {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2rem;
      padding: 1rem 3rem;
      background: #00cc88;
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 8px 25px rgba(0,204,136,0.5);
      transition: all 0.3s;
      z-index: 100;
    }
    #start-btn:hover {
      background: #00ffaa;
      transform: translate(-50%, -50%) scale(1.08);
    }
    #timer, #qEmoji, #question, .options {
      display: none;
    }
    #end {
      display: none;
      width: 100%;
      max-width: 1000px;
      flex-direction: column;
      align-items: center;
      padding: 5vh 0;
      z-index: 1;
    }
    #end h2 { font-size: clamp(3rem, 8vw, 4.2rem); color: #ffdd44; margin-bottom: 4vh; }
    #result { font-size: clamp(1.8rem, 5.5vw, 2.4rem); text-align: center; margin-bottom: 5vh; }
    #answersList {
      width: 100%;
      background: rgba(40,0,70,0.75);
      border-radius: 18px;
      padding: 4vh;
      font-size: clamp(1.2rem, 4vw, 1.5rem);
      line-height: 1.8;
      margin-bottom: 5vh;
    }
    #answersList div { margin: 2.5vh 0; padding: 2.5vh; background: rgba(60,0,100,0.65); border-radius: 14px; }
    button#downloadPdf, button#restartBtn {
      font-size: 1.5rem;
      padding: 1.2rem 3rem;
      margin: 2vh;
    }
    #downloadPdf { background: #3366ff; }
    #downloadPdf:hover { background: #5588ff; }
    #waiting { font-size: 1.5rem; color: #ffcc66; margin-top: 3vh; text-align: center; }
  </style>
</head>
<body>

  <video id="bg-video" autoplay loop playsinline muted>
    <source src="videoo.mp4" type="video/mp4">
  </video>
  <div id="overlay"></div>

  <audio id="bg-music" loop>
    <source src="musiic.mp3" type="audio/mpeg">
  </audio>

  <h1>Sevgilini N…ô Q…ôd…ôr Tanƒ±yƒ±rsan?</h1>
  <div id="status">Oyuna ba≈ülamaq √º√ß√ºn "Davam et" d√ºym…ôsin…ô bas</div>

  <button id="start-btn">Davam et</button>

  <div id="lobby">
    <button onclick="createHost()">Host ol (ID yarat)</button>
    <input id="peerIdInput" placeholder="Dostunun ID-sini yaz" />
    <button id="joinBtn" onclick="joinGame()">Qo≈üul</button>
  </div>

  <div id="game">
    <div id="timer">15</div>
    <div id="qEmoji"></div>
    <div id="question"></div>
    <div class="options" id="options"></div>
  </div>

  <div id="end">
    <h2>Oyun Bitdi!</h2>
    <div id="result">30 sual cavablandƒ±!</div>
    <div id="answersList"></div>
    <button id="downloadPdf">PDF olaraq y√ºkl…ô</button>
    <button id="restartBtn" onclick="requestRestart()">Yenid…ôn Ba≈ülat</button>
    <div id="waiting"></div>
  </div>

  <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    const { jsPDF } = window.jspdf;

    const status = document.getElementById('status');
    const lobby = document.getElementById('lobby');
    const gameDiv = document.getElementById('game');
    const startBtn = document.getElementById('start-btn');
    const timerEl = document.getElementById('timer');
    const qEmoji = document.getElementById('qEmoji');
    const questionEl = document.getElementById('question');
    const optionsEl = document.getElementById('options');
    const endDiv = document.getElementById('end');
    const resultEl = document.getElementById('result');
    const answersList = document.getElementById('answersList');
    const waitingEl = document.getElementById('waiting');
    const music = document.getElementById('bg-music');
    const joinBtn = document.getElementById('joinBtn');

    let peer = null;
    let conn = null;
    let myRole = null;
    let myId = '';
    let currentQuestionIndex = -1;
    let timerInterval = null;
    let timeLeft = 15;
    let myAnswered = false;
    let opponentAnswered = false;
    let myAnswers = new Array(30).fill(-1);
    let restartRequested = false;
    let opponentRestartRequested = false;

    const questions = [
      { q: "Sevgilinin …ôn sevdiyi r…ông hansƒ±dƒ±r?", options: ["Qƒ±rmƒ±zƒ±", "Mavi", "Ya≈üƒ±l", "Sarƒ±", "B…ôn√∂v≈ü…ôyi", "Qara"], emoji: "üé®" },
      { q: "U≈üaqlƒ±qda …ôn √ßox sevdiyi oyuncaq n…ô idi?", options: ["Ayƒ± balasƒ±", "Ma≈üƒ±n", "Kukla", "Lego", "Top", "Robot"], emoji: "üß∏" },
      { q: "∆èn sevdiyi yem…ôk hansƒ±dƒ±r?", options: ["Plov", "Pizza", "Dolma", "Lava≈ü", "Kabab", "Sushi"], emoji: "üç≤" },
      { q: "S…ôh…ôr tezd…ôn ilk n…ô edir?", options: ["Telefonuna baxƒ±r", "Kofe/√ßay i√ßir", "ƒ∞dman edir", "Yenid…ôn yatƒ±r", "Du≈ü alƒ±r", "Kitab oxuyur"], emoji: "‚òï" },
      { q: "∆èn √ßox sevdiyi musiqi janrƒ± hansƒ±dƒ±r?", options: ["Pop", "Rap", "Rock", "Klassik", "Xalq", "Elektronika"], emoji: "üéµ" },
      { q: "U≈üaqlƒ±q l…ôq…ôbi n…ô olub?", options: ["Balaca", "≈ûirin", "T√ºlk√º", "≈ûi≈üko", "Yaramaz", "He√ß l…ôq…ôbi olmayƒ±b"], emoji: "üòÑ" },
      { q: "∆èn b√∂y√ºk qorxusu n…ôdir?", options: ["H√ºnd√ºrl√ºk", "Qaranlƒ±q", "H√∂r√ºm√ß…ôk", "T…ôk qalmaq", "ƒ∞yn…ô", "D…ôniz"], emoji: "üò±" },
      { q: "∆èn sevdiyi film janrƒ± hansƒ±dƒ±r?", options: ["Komediya", "Romantika", "Dram", "Aksiya", "Fantastika", "D…ôh≈ü…ôt"], emoji: "üé¨" },
      { q: "∆èn √ßox sevdiyi m√∂vs√ºm hansƒ±dƒ±r?", options: ["Yay", "Payƒ±z", "Qƒ±≈ü", "Yaz"], emoji: "üçÇ" },
      { q: "Telefonunun arxa fonunda n…ô var?", options: ["Selfi", "M…ônz…ôr…ô", "Heyvan", "Qara ekran", "Musiqi qrupu", "S…ôn"], emoji: "üì±" },
      { q: "∆èn sevdiyi heyvan hansƒ±dƒ±r?", options: ["Pi≈üik", "ƒ∞t", "Qu≈ü", "At", "Panda", "Delfin"], emoji: "üê±" },
      { q: "∆èn √ßox sevdiyi i√ßki n…ôdir?", options: ["Kola", "√áay", "Kofe", "≈ûir…ô", "Su", "Limonad"], emoji: "ü•§" },
      { q: "U≈üaqlƒ±qda hansƒ± idman n√∂v√º il…ô m…ô≈üƒüul olub?", options: ["Futbol", "√úzg√º√ß√ºl√ºk", "R…ôqs", "Voleybol", "G√ºl…ô≈ü", "He√ß biri"], emoji: "‚öΩ" },
      { q: "∆èn sevdiyi t…ôtil yeri haradƒ±r?", options: ["D…ôniz", "Daƒü", "≈û…ôh…ôr", "K…ônd", "Xaricd…ô", "Evind…ô"], emoji: "üèñÔ∏è" },
      { q: "∆èn b√∂y√ºk x…ôyalƒ± n…ôdir?", options: ["S…ôyah…ôt", "Z…ônginlik", "Ail…ô qurmaq", "≈û√∂hr…ôt", "√ñz biznesini qurmaq", "Sakit h…ôyat"], emoji: "üåü" },
      { q: "∆èn pis v…ôrdi≈üi n…ôdir?", options: ["Gec yatmaq", "√áox telefon istifad…ôsi", "Unutqanlƒ±q", "Dƒ±rnaq yem…ôk", "Gecikm…ôk", "√áox danƒ±≈ümamaq"], emoji: "üòÖ" },
      { q: "∆èn √ßox sevdiyi emoji hansƒ±dƒ±r?", options: ["üòÇ", "‚ù§Ô∏è", "üî•", "üòà", "ü•∞", "ü§¶‚Äç‚ôÄÔ∏è"], emoji: "üòè" },
      { q: "S…ôh…ôr yuxudan oyananda ilk n…ô d√º≈ü√ºn√ºr?", options: ["Kofe", "Telefon", "Yem…ôk", "Yenid…ôn yatmaq", "ƒ∞≈ü", "S…ôyah…ôt"], emoji: "üõå" },
      { q: "∆èn sevdiyi zarafat n√∂v√º hansƒ±dƒ±r?", options: ["Qara yumor", "Sarkazm", "Klassik", "Zarafat sevmir", "Dadlƒ± zarafatlar", "P…ôd…ôr≈ü…ôkilli"], emoji: "ü§°" },
      { q: "Onun ideal h…ôft…ôsonu nec…ô ke√ßir?", options: ["Evde film izl…ôm…ôk", "√á√∂l…ô √ßƒ±xmaq", "Yuxu √ß…ôkm…ôk", "Dostlarla g√∂r√º≈ü", "Alƒ±≈ü-veri≈ü", "T…ôbi…ôtd…ô g…ôzm…ôk"], emoji: "üõãÔ∏è" },
      { q: "∆èn sevdiyi kitab janrƒ± hansƒ±dƒ±r?", options: ["Roman", "Detektiv", "Fantastika", "Psixologiya", "He√ß oxumur", "≈ûeir"], emoji: "üìö" },
      { q: "U≈üaqlƒ±qda …ôn sevdiyi cizgi filmi hansƒ± idi?", options: ["≈ûrek", "Aslan Kral", "Donanma", "Tom v…ô Cerri", "SpongeBob", "Dig…ôr"], emoji: "üì∫" },
      { q: "∆èn √ßox sevdiyi qoxu hansƒ±dƒ±r?", options: ["∆ètir", "Yaƒüƒ±≈üdan sonra torpaq", "T…ôz…ô √ß√∂r…ôk", "D…ôniz", "Kofe", "G√ºl"], emoji: "üåπ" },
      { q: "∆èn √ßox sevdiyi r…ôqs n√∂v√º hansƒ±dƒ±r?", options: ["Latin", "Hip-hop", "Vals", "R…ôqs etmir", "Folklor", "Tango"], emoji: "üíÉ" },
      { q: "∆èn sevdiyi r…ông kombinasiyasƒ± hansƒ±dƒ±r?", options: ["Qara-aƒü", "Qƒ±rmƒ±zƒ±-qara", "Mavi-aƒü", "Ya≈üƒ±l-q…ôhv…ôyi", "√á…ôhrayƒ±-boz", "Dig…ôr"], emoji: "üåà" },
      { q: "U≈üaqlƒ±qda …ôn √ßox sevdiyi ≈üirniyyat n…ô idi?", options: ["≈ûokolad", "Konfet", "Tort", "Dondurma", "Pi≈ümi≈ü x…ômir", "Qoz-fƒ±ndƒ±q"], emoji: "üç´" },
      { q: "∆èn √ßox sevdiyi idman n√∂v√ºn√º izl…ôm…ôyi sevir?", options: ["Futbol", "Basketbol", "Tennis", "Formula 1", "Boks", "He√ß izl…ômir"], emoji: "üèÄ" },
      { q: "∆èn sevdiyi bayram hansƒ±dƒ±r?", options: ["Yeni il", "Novruz", "Ad g√ºn√º", "Sevgilil…ôr g√ºn√º", "Qurban bayramƒ±", "M√ºst…ôqillik g√ºn√º"], emoji: "üéâ" },
      { q: "∆èn √ßox sevdiyi hava ≈ü…ôraiti nec…ôdir?", options: ["G√ºn…ô≈üli", "Yaƒüƒ±≈ülƒ±", "Qarlƒ±", "S…ôrin k√ºl…ôkli", "ƒ∞sti yay g√ºn√º", "Payƒ±z yarpaqlarƒ±"], emoji: "‚õÖ" },
      { q: "∆èn sevdiyi sosial ≈ü…ôb…ôk…ô hansƒ±dƒ±r?", options: ["Instagram", "TikTok", "Telegram", "Facebook", "Twitter/X", "He√ß istifad…ô etmir"], emoji: "üì±" }
    ];

    // "Davam et" d√ºym…ôsi
    startBtn.addEventListener('click', () => {
      startBtn.style.display = 'none';
      music.play().catch(e => console.log("Mahnƒ± oxumadƒ±:", e));
      lobby.style.display = 'block';
      status.innerHTML = 'Host ol v…ô ya dostunun ID-sini yazaraq qo≈üul!';
    });

    function createHost() {
      peer = new Peer();
      peer.on('open', id => {
        myId = id;
        myRole = 'host';
        status.innerHTML = `Host ID: <strong>${id}</strong><br>Dostuna g√∂nd…ôr!`;
        const copyBtn = document.createElement('button');
        copyBtn.id = 'copyBtn';
        copyBtn.textContent = 'Kopyala';
        copyBtn.onclick = () => {
          navigator.clipboard.writeText(myId).then(() => alert('ID kopyalandƒ±!'));
        };
        status.appendChild(copyBtn);
        lobby.querySelector('button[onclick="createHost()"]').disabled = true;
      });

      peer.on('connection', connection => {
        conn = connection;
        conn.on('open', () => {
          status.innerHTML = 'Baƒülantƒ± quruldu! Oyun ba≈ülayƒ±r...';
          lobby.style.display = 'none';
          gameDiv.style.display = 'flex';
          // H…ôr iki t…ôr…ôfd…ô d…ô oyun ba≈ülasƒ±n
          nextQuestion();
        });
        conn.on('data', handleData);
      });
    }

    function joinGame() {
      const hostId = document.getElementById('peerIdInput').value.trim();
      if (!hostId) return alert('ID yaz!');

      joinBtn.disabled = true;
      joinBtn.textContent = 'Qo≈üulur...';
      status.innerHTML = 'Qo≈üulma gedir...';

      peer = new Peer();
      peer.on('open', () => {
        conn = peer.connect(hostId);
        conn.on('open', () => {
          status.innerHTML = 'Qo≈üuldun! Oyun ba≈ülayƒ±r...';
          lobby.style.display = 'none';
          gameDiv.style.display = 'flex';
          nextQuestion(); // Guest d…ô √∂z√ºnd…ô sualƒ± g√∂st…ôrir
        });
        conn.on('data', handleData);
      });
    }

    function handleData(data) {
      if (data.type === 'next') {
        currentQuestionIndex = data.index;
        myAnswered = false;
        opponentAnswered = false;
        showQuestion();
      } else if (data.type === 'answered') {
        if (data.player !== myRole) {
          opponentAnswered = true;
          checkBothAnswered();
        }
      } else if (data.type === 'restart') {
        opponentRestartRequested = true;
        checkRestart();
      }
    }

    function nextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex >= questions.length) {
        showEndScreen();
        return;
      }

      myAnswered = false;
      opponentAnswered = false;

      if (myRole === 'host') {
        conn.send({ type: 'next', index: currentQuestionIndex });
      }
      showQuestion(); // H…ôr iki t…ôr…ôfd…ô d…ôrhal sualƒ± g√∂st…ôr
    }

    function showQuestion() {
      const q = questions[currentQuestionIndex];
      qEmoji.textContent = q.emoji;
      questionEl.textContent = q.q;
      optionsEl.innerHTML = '';
      q.options.forEach((opt, i) => {
        const div = document.createElement('div');
        div.className = 'option';
        div.textContent = `${String.fromCharCode(65 + i)}) ${opt}`;
        div.onclick = () => selectAnswer(i);
        optionsEl.appendChild(div);
      });
      timeLeft = 15;
      timerEl.textContent = timeLeft;
      timerEl.style.display = 'block';
      qEmoji.style.display = 'block';
      questionEl.style.display = 'block';
      optionsEl.style.display = 'grid';
      clearInterval(timerInterval);
      timerInterval = setInterval(updateTimer, 1000);
    }

    function updateTimer() {
      if (myAnswered && opponentAnswered) return;
      timeLeft--;
      timerEl.textContent = timeLeft;
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        timerEl.textContent = "VAQT Bƒ∞TDƒ∞!";
        setTimeout(nextQuestion, 1800);
      }
    }

    function selectAnswer(index) {
      if (myAnswered) return;
      myAnswered = true;
      myAnswers[currentQuestionIndex] = index;
      conn.send({ type: 'answered', player: myRole });
      optionsEl.children[index].classList.add('selected');
      checkBothAnswered();
    }

    function checkBothAnswered() {
      if (myAnswered && opponentAnswered) {
        clearInterval(timerInterval);
        timerEl.textContent = "Hazƒ±r!";
        setTimeout(nextQuestion, 1500);
      }
    }

    function showEndScreen() {
      clearInterval(timerInterval);
      gameDiv.style.display = 'none';
      endDiv.style.display = 'flex';

      resultEl.innerHTML = "30 sual cavablandƒ±!";

      answersList.innerHTML = '<h3 style="text-align:center; color:#ff99ff; margin-bottom:2vh;">S…ônin cavablarƒ±n:</h3>';
      questions.forEach((q, i) => {
        const ans = myAnswers[i] === -1 ? "Cavab verm…ôdin" : q.options[myAnswers[i]];
        const div = document.createElement('div');
        div.innerHTML = `<strong>${i+1}.</strong> ${q.q}<br><strong>Cavabƒ±n:</strong> ${ans}`;
        answersList.appendChild(div);
      });

      document.getElementById('downloadPdf').onclick = downloadPDF;
    }

    function downloadPDF() {
      const doc = new jsPDF();
      doc.setFontSize(18);
      doc.text("Sevgilini N…ô Q…ôd…ôr Tanƒ±yƒ±rsan? - S…ônin Cavablarƒ±n", 20, 20);
      doc.setFontSize(12);
      let y = 40;
      questions.forEach((q, i) => {
        const ans = myAnswers[i] === -1 ? "Cavab verm…ôdin" : q.options[myAnswers[i]];
        doc.text(`${i+1}. ${q.q}`, 20, y);
        y += 8;
        doc.text(`Cavabƒ±n: ${ans}`, 30, y);
        y += 12;
        if (y > 270) { doc.addPage(); y = 20; }
      });
      doc.save("sevgili-testi.pdf");
    }

    function requestRestart() {
      restartRequested = true;
      if (myRole === 'host') conn.send({ type: 'restart' });
      checkRestart();
    }

    function checkRestart() {
      if (restartRequested && opponentRestartRequested) {
        myAnswers = new Array(questions.length).fill(-1);
        currentQuestionIndex = -1;
        endDiv.style.display = 'none';
        gameDiv.style.display = 'flex';
        waitingEl.textContent = '';
        nextQuestion();
      } else {
        waitingEl.textContent = opponentRestartRequested 
          ? "R…ôqib yenid…ôn ba≈ülamaƒüƒ± ist…ôyir... S…ôn d…ô bas!" 
          : "R…ôqibin d…ô basmasƒ±nƒ± g√∂zl…ôyirik...";
      }
    }

    status.innerHTML = 'Oyuna ba≈ülamaq √º√ß√ºn "Davam et" d√ºym…ôsin…ô bas';
  </script>
</body>
</html>