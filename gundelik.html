<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sevgilini N…ô Q…ôd…ôr Tanƒ±yƒ±rsan?</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0f001a, #1a0033);
      color: #f0e0ff;
      min-height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      user-select: none;
    }
    #status {
      font-size: 2rem;
      margin: 2rem;
      color: #ffcc33;
      text-align: center;
      max-width: 90%;
      text-shadow: 0 0 10px rgba(255,204,51,0.6);
    }
    #lobby { text-align: center; margin: 2rem; }
    input, button {
      font-size: 1.5rem;
      padding: 1rem 2rem;
      margin: 1rem;
      border: none;
      border-radius: 12px;
      min-width: 320px;
    }
    button {
      background: #ff33cc;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    button:hover { background: #ff1ab3; transform: translateY(-4px); box-shadow: 0 8px 20px rgba(255,51,204,0.5); }
    #copyBtn { background: #00cc88; }
    #copyBtn:hover { background: #00ffaa; }
    #game {
      display: none;
      width: 100%;
      height: 100vh;
      flex-direction: column;
      justify-content: space-between;
      padding: 4vh 6vw;
      animation: fadeIn 0.8s ease;
    }
    #timer {
      font-size: 6rem;
      font-weight: bold;
      color: #ff3366;
      text-align: center;
      margin: 2vh 0;
      animation: pulse 1.5s infinite;
    }
    #qEmoji { font-size: 8rem; text-align: center; margin: 2vh 0; }
    #question {
      font-size: 2.6rem;
      text-align: center;
      line-height: 1.4;
      margin: 3vh 0 5vh;
      max-width: 90%;
    }
    .options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2.5vh;
      max-width: 1100px;
      width: 100%;
      margin: 0 auto;
    }
    .option {
      background: rgba(40,0,90,0.7);
      padding: 2.5vh 3vw;
      border-radius: 16px;
      font-size: 1.8rem;
      cursor: pointer;
      transition: all 0.35s ease;
      border: 3px solid transparent;
      text-align: center;
      backdrop-filter: blur(6px);
    }
    .option:hover {
      background: rgba(80,0,140,0.9);
      transform: translateY(-8px);
      border-color: #ff99ff;
      box-shadow: 0 12px 30px rgba(255,51,204,0.4);
    }
    .option.selected {
      border-color: #00ffcc;
      background: rgba(0,80,60,0.5);
      transform: scale(1.04);
    }
    #scores {
      font-size: 2.2rem;
      text-align: center;
      margin: 4vh 0;
      color: #33ffcc;
    }
    #end {
      display: none;
      width: 100%;
      height: 100vh;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 4vh;
      overflow-y: auto;
      animation: fadeIn 1s ease;
    }
    #end h2 { font-size: 4rem; color: #ffdd44; margin-bottom: 3vh; }
    #result { font-size: 2.5rem; text-align: center; margin-bottom: 4vh; }
    #answersList {
      width: 90%;
      max-width: 1000px;
      background: rgba(30,0,60,0.7);
      border-radius: 16px;
      padding: 3vh;
      font-size: 1.5rem;
      line-height: 1.7;
      margin-bottom: 4vh;
      backdrop-filter: blur(8px);
    }
    #answersList div { margin: 2vh 0; padding: 2vh; background: rgba(50,0,90,0.5); border-radius: 12px; }
    #downloadPdf { 
      background: #3366ff; 
      font-size: 1.8rem; 
      padding: 1.2rem 3rem; 
      margin-top: 2vh;
    }
    #downloadPdf:hover { background: #5588ff; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
  </style>
</head>
<body>

  <div id="status">Hazƒ±rlanƒ±r...</div>

  <div id="lobby">
    <button onclick="createHost()">Host ol (ID yarat)</button><br><br>
    <input id="peerIdInput" placeholder="Dostunun ID-sini yaz" /><br><br>
    <button onclick="joinGame()">Qo≈üul</button>
  </div>

  <div id="game">
    <div id="timer">15</div>
    <div id="qEmoji"></div>
    <div id="question"></div>
    <div class="options" id="options"></div>
    <div id="scores">S…ôn: 0  ‚Äì  O: 0</div>
  </div>

  <div id="end">
    <h2>Oyun Bitdi!</h2>
    <div id="result"></div>
    <div id="answersList"></div>
    <button id="downloadPdf">PDF olaraq y√ºkl…ô</button>
    <button id="restartBtn" onclick="requestRestart()" style="margin-top:3vh;">Yenid…ôn Ba≈ülat</button>
    <div id="waiting" style="margin-top:2vh; font-size:1.6rem;"></div>
  </div>

  <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    const { jsPDF } = window.jspdf;

    const status = document.getElementById('status');
    const lobby = document.getElementById('lobby');
    const gameDiv = document.getElementById('game');
    const qEmoji = document.getElementById('qEmoji');
    const questionEl = document.getElementById('question');
    const optionsEl = document.getElementById('options');
    const timerEl = document.getElementById('timer');
    const scoresEl = document.getElementById('scores');
    const endDiv = document.getElementById('end');
    const resultEl = document.getElementById('result');
    const answersList = document.getElementById('answersList');
    const waitingEl = document.getElementById('waiting');

    let peer = null;
    let conn = null;
    let myRole = null;
    let myId = '';
    let currentQuestionIndex = -1;
    let timerInterval = null;
    let timeLeft = 15;
    let myScore = 0;
    let opponentScore = 0;
    let myAnswered = false;
    let opponentAnswered = false;
    let myAnswers = [];           // hansƒ± variantƒ± se√ßdim (0,1,2,3)
    let restartRequested = false;
    let opponentRestartRequested = false;

    const questions = [
      { q: "Sevgilinin …ôn sevdiyi 'seks' m√∂vqeyi hansƒ±dƒ±r?", options: ["Missionary", "Doggy", "Cowgirl", "69"], emoji: "üî•üòà" },
      { q: "Onun telefon kilid ≈üifr…ôsi n…ôdir?", options: ["S…ônin adƒ±n", "1111", "Doƒüum tarixi", "Bilmir…ôm"], emoji: "üîí‚ù§Ô∏è" },
      { q: "∆èn √ßox hansƒ± yerd…ô seks etm…ôk ist…ôyir?", options: ["Ma≈üƒ±nda", "M…ôtb…ôxd…ô", "Kinoda", "Me≈ü…ôd…ô"], emoji: "üç≥üöó" },
      { q: "Onun …ôn sevdiyi porno janrƒ± hansƒ±dƒ±r?", options: ["Amateur", "Lesbian", "MILF", "BDSM"], emoji: "üçÜüé•" },
      { q: "S…ônin haqqƒ±nda …ôn √ßox n…ôyi b…ôy…ônir (b…ôd…ôn)?", options: ["Dodaqlar", "Popo", "Sin…ô", "∆èll…ôr"], emoji: "üçëüòè" },
      { q: "Onun u≈üaqlƒ±qda …ôn utandƒ±rƒ±cƒ± l…ôq…ôbi n…ô idi?", options: ["≈ûi≈üko", "Aƒülamaq", "T…ônb…ôl", "Qorxaq"], emoji: "üò≥üë∂" },
      { q: "∆èn √ßox hansƒ± fantaziyanƒ± gizl…ôdir?", options: ["√ú√ßl√ºk", "Rol oyunu", "A√ßƒ±q havada", "Baƒülanma"], emoji: "üå≥üîó" },
      { q: "Onun …ôn pis v…ôrdi≈üi n…ôdir (seksd…ô)?", options: ["√áox tez bitirm…ôk", "Danƒ±≈ümamaq", "√áox s…ôs √ßƒ±xarmaq", "Yorƒüunluq"], emoji: "üòÖüí¶" },
      { q: "Sevgilin s…ôni ilk d…ôf…ô n…ô vaxt √∂pm…ôk ist…ôyib?", options: ["ƒ∞lk g√∂r√º≈üd…ô", "2-ci g√∂r√º≈üd…ô", "Mesajdan sonra", "He√ß vaxt dem…ôyib"], emoji: "üíãüì±" },
      { q: "Onun …ôn sevdiyi orgazm s…ôsi hansƒ±dƒ±r?", options: ["S…ônin adƒ±nƒ± √ß…ôkm…ôk", "Uƒüultu", "Qƒ±≈üqƒ±rƒ±q", "Susmaq"], emoji: "üò©üîä" },
      { q: "∆èn √ßox hansƒ± alt paltarƒ±nƒ± sevir s…ôn…ô?", options: ["String", "Lace", "He√ß n…ô geyinm…ôm…ôk", "Boxer"], emoji: "ü©≤üòç" },
      { q: "Onun gizli sevdiyi seks oyuncaƒüƒ± varmƒ±?", options: ["Vibrator", "Plugs", "Handcuffs", "Yoxdur"], emoji: "ü™¢üî•" },
      { q: "S…ôninl…ô ilk d…ôf…ô n…ô vaxt seks etm…ôk ist…ôyib?", options: ["ƒ∞lk g√∂r√º≈üd…ô", "1 h…ôft…ô sonra", "1 ay sonra", "Evli olanda"], emoji: "‚è≥‚ù§Ô∏è" },
      { q: "Onun …ôn √ßox qƒ±sqandƒ±ƒüƒ± ≈üey n…ôdir?", options: ["Ke√ßmi≈ü sevgilil…ôr", "Dostlarƒ±n", "Telefonun", "ƒ∞≈üin"], emoji: "üò†üíî" },
      { q: "∆èn sevdiyi √∂p√º≈ü yeri haradƒ±r (b…ôd…ôn)?", options: ["Boyun", "Sin…ô", "Qulaq", "Dodaq"], emoji: "üíãüß£" },
      { q: "Onun …ôn pis breakup s…ôb…ôbi n…ô olub?", options: ["Aldatma", "M…ôsaf…ô", "Para", "Ail…ô"], emoji: "üíîüò¢" },
      { q: "S…ôninl…ô seksd…ô …ôn √ßox n…ôyi b…ôy…ônir?", options: ["Oral", "S√ºr…ôtli", "Yava≈ü-romantik", "S…ôrt"], emoji: "üåπüí¶" },
      { q: "Onun …ôn utandƒ±rƒ±cƒ± seks x…ôyali n…ôdir?", options: ["Public place", "Ex il…ô", "M…ônim dostumla", "He√ß dem…ôyib"], emoji: "üò≥üèôÔ∏è" },
      { q: "Sevgilin s…ôni n…ô q…ôd…ôr tez-tez d√º≈ü√ºn√ºr (g√ºn …ôrzind…ô)?", options: ["H…ôr saat", "Yalnƒ±z gec…ô", "Yem…ôk yey…ônd…ô", "He√ß vaxt"], emoji: "üß†‚ù§Ô∏è" },
      { q: "∆èn son n…ô vaxt s…ôn…ô 's…ôni sevir…ôm' deyib?", options: ["Bu g√ºn", "D√ºn…ôn", "1 h…ôft…ô …ôvv…ôl", "Unutub"], emoji: "üíïüóìÔ∏è" }
    ];

    function goFullscreen() {
      const elem = document.documentElement;
      if (elem.requestFullscreen) elem.requestFullscreen().catch(()=>{});
      else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
      else if (elem.msRequestFullscreen) elem.msRequestFullscreen();
    }

    function createHost() {
      peer = new Peer();
      peer.on('open', id => {
        myId = id;
        myRole = 'host';
        status.innerHTML = `Host ID: <strong>${id}</strong><br>Dostuna g√∂nd…ôr!`;
        const copyBtn = document.createElement('button');
        copyBtn.id = 'copyBtn';
        copyBtn.textContent = 'Kopyala';
        copyBtn.onclick = () => navigator.clipboard.writeText(myId).then(() => alert('ID kopyalandƒ±!'));
        status.appendChild(copyBtn);
        lobby.querySelector('button[onclick="createHost()"]').disabled = true;
      });

      peer.on('connection', connection => {
        conn = connection;
        conn.on('open', () => {
          status.innerHTML = 'Baƒülantƒ± quruldu! Oyun ba≈ülayƒ±r...';
          lobby.style.display = 'none';
          gameDiv.style.display = 'flex';
          goFullscreen();
          setTimeout(nextQuestion, 1000);
        });
        conn.on('data', handleData);
      });
    }

    function joinGame() {
      const hostId = document.getElementById('peerIdInput').value.trim();
      if (!hostId) return alert('ID yaz!');

      peer = new Peer();
      peer.on('open', () => {
        conn = peer.connect(hostId);
        conn.on('open', () => {
          status.innerHTML = 'Qo≈üuldun! Oyun ba≈ülayƒ±r...';
          lobby.style.display = 'none';
          gameDiv.style.display = 'flex';
          goFullscreen();
        });
        conn.on('data', handleData);
      });
    }

    function handleData(data) {
      if (data.type === 'next') {
        currentQuestionIndex = data.index;
        myAnswered = false;
        opponentAnswered = false;
        myAnswers[currentQuestionIndex] = -1;
        showQuestion();
      } else if (data.type === 'answered') {
        if (data.player !== myRole) {
          opponentAnswered = true;
          opponentScore++;
          updateScores();
          checkBothAnswered();
        }
      } else if (data.type === 'timeout') {
        if (currentQuestionIndex === data.index) {
          timerEl.textContent = "VAQT Bƒ∞TDƒ∞!";
          setTimeout(nextQuestion, 1800);
        }
      } else if (data.type === 'restart') {
        opponentRestartRequested = true;
        checkRestart();
      }
    }

    function nextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex >= questions.length) {
        showEndScreen();
        return;
      }

      if (myRole === 'host') {
        conn.send({ type: 'next', index: currentQuestionIndex });
      }
      showQuestion();
    }

    function showQuestion() {
      const q = questions[currentQuestionIndex];
      qEmoji.textContent = q.emoji;
      questionEl.textContent = q.q;
      optionsEl.innerHTML = '';
      q.options.forEach((opt, i) => {
        const div = document.createElement('div');
        div.className = 'option';
        div.textContent = `${String.fromCharCode(65 + i)}) ${opt}`;
        div.onclick = () => selectAnswer(i);
        optionsEl.appendChild(div);
      });
      timeLeft = 15;
      timerEl.textContent = timeLeft;
      clearInterval(timerInterval);
      timerInterval = setInterval(updateTimer, 1000);
    }

    function updateTimer() {
      if (myAnswered && opponentAnswered) return; // h…ôr ikisi cavab veribs…ô timer getmir
      timeLeft--;
      timerEl.textContent = timeLeft;
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        timerEl.textContent = "VAQT Bƒ∞TDƒ∞!";
        if (myRole === 'host') conn.send({ type: 'timeout', index: currentQuestionIndex });
        setTimeout(nextQuestion, 1800);
      }
    }

    function selectAnswer(index) {
      if (myAnswered) return;
      myAnswered = true;
      myAnswers[currentQuestionIndex] = index;
      myScore++;
      updateScores();
      conn.send({ type: 'answered', player: myRole });
      const opts = optionsEl.children;
      opts[index].classList.add('selected');
      checkBothAnswered();
    }

    function checkBothAnswered() {
      if (myAnswered && opponentAnswered) {
        clearInterval(timerInterval);
        setTimeout(nextQuestion, 1800);
      }
    }

    function updateScores() {
      scoresEl.textContent = `S…ôn: ${myScore}  ‚Äì  O: ${opponentScore}`;
    }

    function showEndScreen() {
      clearInterval(timerInterval);
      gameDiv.style.display = 'none';
      endDiv.style.display = 'flex';

      let msg = myScore > opponentScore ? "S…ôn daha √ßox tanƒ±yƒ±rsan! üî•" :
                myScore < opponentScore ? "O s…ônd…ôn daha √ßox bilir... üòè" : "Eyni s…ôviyy…ôd…ôsiniz! üòÇ";
      resultEl.innerHTML = `${msg}<br><br>S…ôn: ${myScore} cavab verdin<br>O: ${opponentScore} cavab verdi`;

      answersList.innerHTML = '<h3 style="text-align:center; color:#ff99ff; margin-bottom:2vh;">S…ônin cavablarƒ±n:</h3>';
      questions.forEach((q, i) => {
        const div = document.createElement('div');
        const ans = myAnswers[i] === -1 ? "Cavab verm…ôdin" : q.options[myAnswers[i]];
        div.innerHTML = `
          <strong>${i+1}.</strong> ${q.q}<br>
          <strong>Cavabƒ±n:</strong> ${ans}
        `;
        answersList.appendChild(div);
      });

      document.getElementById('downloadPdf').onclick = () => downloadPDF();
    }

    function downloadPDF() {
      const doc = new jsPDF();
      doc.setFontSize(18);
      doc.text("Sevgilini N…ô Q…ôd…ôr Tanƒ±yƒ±rsan? - S…ônin Cavablarƒ±n", 20, 20);
      doc.setFontSize(12);
      let y = 40;
      questions.forEach((q, i) => {
        const ans = myAnswers[i] === -1 ? "Cavab verm…ôdin" : q.options[myAnswers[i]];
        doc.text(`${i+1}. ${q.q}`, 20, y);
        y += 8;
        doc.text(`Cavabƒ±n: ${ans}`, 30, y);
        y += 12;
        if (y > 270) { doc.addPage(); y = 20; }
      });
      doc.save("sevgili-testi.pdf");
    }

    function requestRestart() {
      restartRequested = true;
      if (myRole === 'host') conn.send({ type: 'restart' });
      checkRestart();
    }

    function checkRestart() {
      if (restartRequested && opponentRestartRequested) {
        myScore = 0;
        opponentScore = 0;
        myAnswers = [];
        currentQuestionIndex = -1;
        endDiv.style.display = 'none';
        gameDiv.style.display = 'flex';
        waitingEl.textContent = '';
        nextQuestion();
      } else {
        waitingEl.textContent = opponentRestartRequested 
          ? "R…ôqib yenid…ôn ba≈ülamaƒüƒ± ist…ôyir... S…ôn d…ô bas!" 
          : "R…ôqibin d…ô basmasƒ±nƒ± g√∂zl…ôyirik...";
      }
    }

    status.innerHTML = 'Host ol v…ô ya dostunun ID-sini yazaraq qo≈üul!';
  </script>
</body>
</html>