<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinguaPro - API Powered Learning</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #58cc02;
            --primary-dark: #58a700;
            --secondary: #1cb0f6;
            --accent: #ffc800;
            --danger: #ff4b4b;
            --purple: #ce82ff;
            --bg: #f7f7f7;
            --card: #ffffff;
            --text: #3c3c3c;
            --border: #e5e5e5;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        /* Login Screen */
        .login-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5000;
            transition: opacity 0.5s;
        }

        .login-container {
            background: white;
            padding: 3rem;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 450px;
            text-align: center;
        }

        .login-logo {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .login-container h1 {
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-size: 2rem;
        }

        .login-container p {
            color: #666;
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text);
        }

        .form-group input {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(88, 204, 2, 0.1);
        }

        .btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 0 var(--primary-dark);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 var(--primary-dark);
        }

        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 2px 0 var(--primary-dark);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Header */
        .header {
            background: white;
            border-bottom: 2px solid var(--border);
            padding: 1rem 2rem;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        .header-content {
            max-width: 1300px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .stats {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: bold;
            font-size: 0.95rem;
            padding: 0.5rem 1rem;
            background: #f5f5f5;
            border-radius: 20px;
            border: 2px solid var(--border);
        }

        .fire { color: var(--accent); }
        .gem { color: var(--secondary); }
        .heart { color: var(--danger); }

        /* Layout */
        .container {
            max-width: 1300px;
            margin: 90px auto 2rem;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
            padding: 0 2rem;
        }

        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .profile-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            border: 2px solid var(--border);
            box-shadow: var(--shadow);
        }

        .avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
            border: 4px solid white;
            box-shadow: 0 4px 15px rgba(88, 204, 2, 0.3);
            cursor: pointer;
            transition: transform 0.3s;
        }

        .avatar:hover {
            transform: scale(1.05);
        }

        .username {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--text);
        }

        .user-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 2px solid var(--border);
        }

        .user-stat {
            text-align: center;
        }

        .user-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .user-stat-label {
            font-size: 0.8rem;
            color: #666;
            margin-top: 0.25rem;
        }

        .nav-menu {
            background: white;
            border-radius: 16px;
            padding: 1rem;
            border: 2px solid var(--border);
            box-shadow: var(--shadow);
        }

        .nav-item {
            padding: 1rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            border: 2px solid transparent;
        }

        .nav-item:hover {
            background: #f5f5f5;
            transform: translateX(5px);
        }

        .nav-item.active {
            background: #e8f5e9;
            border-color: var(--primary);
            color: var(--primary-dark);
        }

        .nav-item:last-child {
            margin-bottom: 0;
        }

        /* Main Content */
        .main-content {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            border: 2px solid var(--border);
            box-shadow: var(--shadow);
            min-height: 600px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        .section-title {
            font-size: 1.8rem;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        /* Learning Path */
        .path-container {
            position: relative;
            padding: 2rem 0;
        }

        .path-line {
            position: absolute;
            left: 40px;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
            border-radius: 2px;
            z-index: 0;
        }

        .lesson-node {
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: white;
            border-radius: 16px;
            border: 3px solid #ddd;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .lesson-node:hover:not(.locked) {
            transform: translateX(10px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-color: var(--secondary);
        }

        .lesson-node.completed {
            border-color: var(--primary);
            background: linear-gradient(to right, #f1f8e9, white);
        }

        .lesson-node.active {
            border-color: var(--secondary);
            background: linear-gradient(to right, #e3f2fd, white);
            animation: pulse-border 2s infinite;
        }

        .lesson-node.locked {
            opacity: 0.6;
            cursor: not-allowed;
            background: #fafafa;
        }

        @keyframes pulse-border {
            0%, 100% { box-shadow: 0 0 0 0 rgba(28, 176, 246, 0.4); }
            50% { box-shadow: 0 0 0 15px rgba(28, 176, 246, 0); }
        }

        .node-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            background: #f5f5f5;
            border: 4px solid #ddd;
            flex-shrink: 0;
            transition: all 0.3s;
        }

        .completed .node-circle {
            background: var(--primary);
            border-color: var(--primary-dark);
            color: white;
            transform: scale(1.1);
        }

        .active .node-circle {
            background: var(--secondary);
            border-color: #0d8ecf;
            color: white;
            animation: bounce 2s infinite;
        }

        .locked .node-circle {
            background: #eee;
            color: #999;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .node-content h3 {
            font-size: 1.2rem;
            margin-bottom: 0.25rem;
            color: var(--text);
        }

        .node-content p {
            color: #666;
            font-size: 0.9rem;
        }

        .node-meta {
            margin-left: auto;
            text-align: center;
        }

        .level-badge {
            background: var(--accent);
            color: #856404;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            display: inline-block;
        }

        .stars {
            display: flex;
            gap: 0.25rem;
            font-size: 1.2rem;
        }

        .star.filled { color: var(--accent); }
        .star.empty { color: #e0e0e0; }

        /* Exercise Modal */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 1rem;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active { display: flex; }

        .exercise-container {
            background: white;
            border-radius: 24px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.4s ease;
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
        }

        @keyframes slideUp {
            from { transform: translateY(50px) scale(0.95); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }

        .exercise-header {
            padding: 1.5rem 2rem;
            border-bottom: 2px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fafafa;
        }

        .progress-container {
            flex: 1;
            margin: 0 2rem;
            height: 16px;
            background: #e0e0e0;
            border-radius: 20px;
            overflow: hidden;
            border: 2px solid #d0d0d0;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 20px;
            transition: width 0.4s ease;
            width: 0%;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .close-btn {
            background: white;
            border: 2px solid var(--border);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: #ffebee;
            border-color: var(--danger);
            color: var(--danger);
            transform: rotate(90deg);
        }

        .exercise-body {
            padding: 3rem;
            overflow-y: auto;
            flex: 1;
        }

        .question-type-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: #e3f2fd;
            color: #1565c0;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            border: 2px solid #bbdefb;
        }

        .question-text {
            font-size: 1.5rem;
            margin-bottom: 2.5rem;
            line-height: 1.5;
            color: var(--text);
            font-weight: 600;
        }

        .audio-player {
            background: linear-gradient(135deg, #f5f5f5, #ffffff);
            border: 3px dashed var(--border);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .audio-player:hover {
            background: #e3f2fd;
            border-color: var(--secondary);
            transform: translateY(-2px);
        }

        .audio-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .option-card {
            padding: 1.5rem;
            border: 3px solid #e0e0e0;
            border-radius: 16px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .option-card:hover:not(.disabled) {
            border-color: var(--secondary);
            background: #f5f5f5;
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .option-card.selected {
            border-color: var(--secondary);
            background: #e3f2fd;
            color: #1565c0;
            box-shadow: 0 0 0 4px rgba(28, 176, 246, 0.2);
        }

        .option-card.correct {
            border-color: var(--primary);
            background: #e8f5e9;
            color: #2e7d32;
            animation: correct-pulse 0.6s ease;
        }

        .option-card.wrong {
            border-color: var(--danger);
            background: #ffebee;
            color: #c62828;
            animation: shake 0.5s ease;
        }

        @keyframes correct-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-10px); }
            40%, 80% { transform: translateX(10px); }
        }

        .text-input {
            width: 100%;
            padding: 1.2rem;
            font-size: 1.2rem;
            border: 3px solid #e0e0e0;
            border-radius: 16px;
            margin-bottom: 2rem;
            transition: all 0.3s;
            font-family: inherit;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 4px rgba(28, 176, 246, 0.15);
        }

        .text-input.correct {
            border-color: var(--primary);
            background: #e8f5e9;
        }

        .text-input.wrong {
            border-color: var(--danger);
            background: #ffebee;
        }

        .word-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 2rem;
            min-height: 60px;
            padding: 1rem;
            background: #f9f9f9;
            border-radius: 12px;
            border: 2px dashed #ddd;
        }

        .word-chip {
            background: white;
            border: 2px solid #ddd;
            padding: 0.6rem 1.2rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            user-select: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .word-chip:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-color: var(--secondary);
        }

        .word-chip.used {
            opacity: 0.4;
            pointer-events: none;
            background: #eee;
        }

        .answer-area {
            min-height: 80px;
            padding: 1.5rem;
            background: white;
            border: 3px solid #e0e0e0;
            border-radius: 16px;
            margin-bottom: 2rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            align-items: center;
        }

        .answer-word {
            background: var(--secondary);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            animation: popIn 0.3s ease;
        }

        @keyframes popIn {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .answer-word:hover {
            background: var(--danger);
            transform: scale(1.1);
        }

        .speak-container {
            text-align: center;
            padding: 3rem;
        }

        .mic-button {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            border: 4px solid var(--secondary);
            background: white;
            font-size: 4rem;
            cursor: pointer;
            transition: all 0.3s;
            margin: 2rem auto;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 30px rgba(28, 176, 246, 0.3);
            position: relative;
        }

        .mic-button:hover {
            transform: scale(1.1);
            background: #e3f2fd;
        }

        .mic-button.recording {
            background: var(--danger);
            border-color: #d32f2f;
            color: white;
            animation: recording-pulse 1.5s infinite;
        }

        @keyframes recording-pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 75, 75, 0.7); }
            70% { box-shadow: 0 0 0 40px rgba(255, 75, 75, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 75, 75, 0); }
        }

        .recognized-text {
            font-size: 1.5rem;
            color: var(--text);
            min-height: 3rem;
            font-weight: 600;
            margin-top: 1rem;
        }

        .hint-box {
            background: #fff3cd;
            border-left: 5px solid var(--accent);
            padding: 1rem 1.5rem;
            margin-bottom: 2rem;
            border-radius: 0 12px 12px 0;
            color: #856404;
        }

        .exercise-footer {
            padding: 1.5rem 2rem;
            border-top: 2px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fafafa;
        }

        .skip-btn {
            background: transparent;
            border: 2px solid #ddd;
            color: #666;
            padding: 0.8rem 2rem;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .skip-btn:hover {
            background: #f5f5f5;
            border-color: #999;
        }

        .check-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.8rem 3rem;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 4px 0 var(--primary-dark);
            transition: all 0.2s;
            text-transform: uppercase;
        }

        .check-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 var(--primary-dark);
        }

        .check-btn:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 0 2px 0 var(--primary-dark);
        }

        .check-btn:disabled {
            background: #ccc;
            box-shadow: none;
            cursor: not-allowed;
        }

        /* Results Screen */
        .results-container {
            text-align: center;
            padding: 3rem;
        }

        .trophy {
            font-size: 6rem;
            margin-bottom: 1rem;
            animation: trophy-bounce 1s ease infinite;
            display: inline-block;
        }

        @keyframes trophy-bounce {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-20px) rotate(-5deg); }
            75% { transform: translateY(-20px) rotate(5deg); }
        }

        .xp-earned {
            font-size: 3rem;
            color: var(--accent);
            font-weight: bold;
            margin: 1rem 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin: 3rem 0;
        }

        .stat-card {
            background: #f5f5f5;
            padding: 1.5rem;
            border-radius: 16px;
            border: 3px solid var(--border);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--secondary);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            color: #666;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }

        /* Vocabulary Section */
        .vocab-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .vocab-card {
            background: white;
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .vocab-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-color: var(--secondary);
        }

        .vocab-word {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--text);
            margin-bottom: 0.5rem;
        }

        .vocab-translation {
            color: #666;
            font-size: 0.95rem;
        }

        .vocab-meta {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
            font-size: 0.85rem;
            color: #999;
        }

        .strength-bar {
            width: 100%;
            height: 6px;
            background: #eee;
            border-radius: 3px;
            margin-top: 0.5rem;
            overflow: hidden;
        }

        .strength-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 3px;
            transition: width 0.3s;
        }

        /* Profile Section */
        .profile-header {
            text-align: center;
            padding: 3rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 16px;
            margin-bottom: 2rem;
        }

        .profile-avatar-large {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: white;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            border: 6px solid rgba(255,255,255,0.3);
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .achievement-card {
            background: white;
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s;
        }

        .achievement-card:hover {
            transform: translateY(-3px);
            border-color: var(--accent);
        }

        .achievement-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .achievement-name {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .achievement-desc {
            font-size: 0.85rem;
            color: #666;
        }

        /* Course Selector */
        .course-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .course-chip {
            padding: 0.75rem 1.5rem;
            border: 2px solid var(--border);
            border-radius: 50px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .course-chip:hover {
            border-color: var(--secondary);
            background: #f0f8ff;
        }

        .course-chip.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Confetti */
        .confetti {
            position: fixed;
            width: 12px;
            height: 12px;
            position: absolute;
            z-index: 3000;
            pointer-events: none;
        }

        @keyframes confetti-fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        /* Responsive */
        @media (max-width: 900px) {
            .container {
                grid-template-columns: 1fr;
                padding: 0 1rem;
            }
            
            .sidebar {
                display: none;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .exercise-body {
                padding: 1.5rem;
            }
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Error message */
        .error-toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--danger);
            color: white;
            padding: 1rem 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            display: none;
            z-index: 4000;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from { transform: translateX(400px); }
            to { transform: translateX(0); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #999;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
    </style>
</head>
<body>

    <!-- Login Screen -->
    <div class="login-overlay" id="login-screen">
        <div class="login-container">
            <div class="login-logo">ü¶â</div>
            <h1>LinguaPro</h1>
            <p>ƒ∞ngilis dilini professional s…ôviyy…ôd…ô √∂yr…ônin</p>
            
            <div class="form-group">
                <label>ƒ∞stifad…ô√ßi adƒ± (API Simulation)</label>
                <input type="text" id="login-username" placeholder="username" value="demo_user">
            </div>
            
            <div class="form-group">
                <label>≈ûifr…ô</label>
                <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value="password">
            </div>
            
            <button class="btn btn-primary" onclick="login()">
                Daxil ol ‚Üí
            </button>
            
            <p style="margin-top: 1rem; font-size: 0.85rem; color: #666;">
                Demo: ist…ônil…ôn m…ôlumat daxil edin
            </p>
        </div>
    </div>

    <!-- Error Toast -->
    <div class="error-toast" id="error-toast"></div>

    <!-- Header -->
    <header class="header" id="main-header" style="display: none;">
        <div class="header-content">
            <div class="logo" onclick="showSection('learn')">
                <span>ü¶â</span>
                <span>LinguaPro</span>
            </div>
            
            <div class="stats">
                <div class="stat-item fire">
                    <span>üî•</span>
                    <span id="header-streak">0</span>
                </div>
                <div class="stat-item gem">
                    <span>üíé</span>
                    <span id="header-xp">0</span>
                </div>
                <div class="stat-item heart">
                    <span>‚ù§Ô∏è</span>
                    <span id="header-hearts">5</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container" id="main-container" style="display: none;">
        
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="profile-card">
                <div class="avatar" id="user-avatar">üë§</div>
                <div class="username" id="sidebar-username">ƒ∞stifad…ô√ßi</div>
                <div style="color: #666; font-size: 0.9rem; margin-top: 0.25rem;" id="sidebar-email">user@example.com</div>
                
                <div class="user-stats">
                    <div class="user-stat">
                        <div class="user-stat-value" id="sidebar-total-xp">0</div>
                        <div class="user-stat-label">√úmumi XP</div>
                    </div>
                    <div class="user-stat">
                        <div class="user-stat-value" id="sidebar-level">1</div>
                        <div class="user-stat-label">S…ôviyy…ô</div>
                    </div>
                </div>
            </div>

            <nav class="nav-menu">
                <div class="nav-item active" onclick="showSection('learn')" id="nav-learn">
                    <span>üìö</span>
                    <span>√ñyr…ôn</span>
                </div>
                <div class="nav-item" onclick="showSection('vocabulary')" id="nav-vocab">
                    <span>üìñ</span>
                    <span>L√ºƒü…ôt</span>
                </div>
                <div class="nav-item" onclick="showSection('profile')" id="nav-profile">
                    <span>üë§</span>
                    <span>Profil</span>
                </div>
                <div class="nav-item" onclick="logout()" style="color: var(--danger);">
                    <span>üö™</span>
                    <span>√áƒ±xƒ±≈ü</span>
                </div>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content" id="content-area">
            <!-- Dynamic content loaded here -->
        </main>
    </div>

    <!-- Exercise Modal -->
    <div class="modal-overlay" id="exercise-modal">
        <div class="exercise-container">
            <div class="exercise-header">
                <button class="close-btn" onclick="closeExercise()">‚úï</button>
                <div class="progress-container">
                    <div class="progress-bar" id="exercise-progress"></div>
                </div>
                <div style="width: 40px;"></div>
            </div>
            
            <div class="exercise-body" id="exercise-body">
                <!-- Exercise content -->
            </div>
            
            <div class="exercise-footer" id="exercise-footer">
                <button class="skip-btn" onclick="skipExercise()">Ke√ß</button>
                <button class="check-btn" id="check-answer-btn" onclick="checkAnswer()" disabled>Yoxla</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== API SIMULATION LAYER ====================
        // Real Duolingo API structure simulation with localStorage persistence
        
        const API_BASE = 'https://www.duolingo.com';
        
        class DuolingoAPI {
            constructor() {
                this.token = localStorage.getItem('duo_token') || null;
                this.user = null;
                this.currentCourse = null;
            }

            async login(username, password) {
                // Simulate: POST /2017-06-30/login
                await this.simulateNetworkDelay();
                
                const mockUser = {
                    id: Math.floor(Math.random() * 10000000),
                    username: username,
                    email: `${username}@example.com`,
                    name: username,
                    totalXp: parseInt(localStorage.getItem('user_total_xp')) || 0,
                    streak: parseInt(localStorage.getItem('user_streak')) || 0,
                    gems: parseInt(localStorage.getItem('user_gems')) || 500,
                    hearts: parseInt(localStorage.getItem('user_hearts')) || 5,
                    level: parseInt(localStorage.getItem('user_level')) || 1,
                    courses: [
                        { id: 'DUOLINGO_EN_AZ', fromLanguage: 'az', learningLanguage: 'en', title: 'ƒ∞ngilis dili', xp: 0 }
                    ],
                    currentCourseId: 'DUOLINGO_EN_AZ'
                };
                
                this.token = 'mock_jwt_token_' + Date.now();
                this.user = mockUser;
                this.currentCourse = mockUser.courses[0];
                
                localStorage.setItem('duo_token', this.token);
                localStorage.setItem('duo_user', JSON.stringify(mockUser));
                
                return { token: this.token, user: mockUser };
            }

            async getUser() {
                // Simulate: GET /2017-06-30/users/{userID}
                await this.simulateNetworkDelay(300);
                const saved = localStorage.getItem('duo_user');
                if (saved) {
                    this.user = JSON.parse(saved);
                    // Sync with latest localStorage values
                    this.user.totalXp = parseInt(localStorage.getItem('user_total_xp')) || 0;
                    this.user.streak = parseInt(localStorage.getItem('user_streak')) || 0;
                    this.user.hearts = parseInt(localStorage.getItem('user_hearts')) || 5;
                }
                return this.user;
            }

            async getVocabulary() {
                // Simulate: GET /vocabulary/overview
                await this.simulateNetworkDelay(500);
                return this.getMockVocabulary();
            }

            async getXpSummaries() {
                // Simulate: GET /2017-06-30/users/{userID}/xp_summaries
                await this.simulateNetworkDelay(400);
                return this.generateMockXpData();
            }

            async getMistakesCount() {
                // Simulate: GET /v2/mistakes/users/{userID}/courses/{courseID}/count
                return { numberMistakes: parseInt(localStorage.getItem('user_mistakes')) || 0 };
            }

            simulateNetworkDelay(ms = 600) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            getMockVocabulary() {
                return [
                    { word: "hello", translation: "salam", strength: 1.0, pos: "Noun", last_practiced: new Date().toISOString() },
                    { word: "goodbye", translation: "salamla≈üma", strength: 0.8, pos: "Noun", last_practiced: new Date().toISOString() },
                    { word: "apple", translation: "alma", strength: 0.9, pos: "Noun", last_practiced: new Date().toISOString() },
                    { word: "water", translation: "su", strength: 0.7, pos: "Noun", last_practiced: new Date().toISOString() },
                    { word: "eat", translation: "yem…ôk", strength: 0.6, pos: "Verb", last_practiced: new Date().toISOString() },
                    { word: "drink", translation: "i√ßm…ôk", strength: 0.5, pos: "Verb", last_practiced: new Date().toISOString() },
                    { word: "red", translation: "qƒ±rmƒ±zƒ±", strength: 0.9, pos: "Adjective", last_practiced: new Date().toISOString() },
                    { word: "blue", translation: "g√∂y", strength: 0.4, pos: "Adjective", last_practiced: new Date().toISOString() },
                    { word: "big", translation: "b√∂y√ºk", strength: 0.3, pos: "Adjective", last_practiced: new Date().toISOString() },
                    { word: "small", translation: "ki√ßik", strength: 0.8, pos: "Adjective", last_practiced: new Date().toISOString() }
                ];
            }

            generateMockXpData() {
                const data = [];
                const today = new Date();
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    data.push({
                        date: date.toISOString().split('T')[0],
                        xp: Math.floor(Math.random() * 100) + 20,
                        gainedXp: Math.floor(Math.random() * 50)
                    });
                }
                return { summaries: data };
            }

            updateUserStats(xpEarned, heartsDelta = 0) {
                let currentXP = parseInt(localStorage.getItem('user_total_xp')) || 0;
                let currentHearts = parseInt(localStorage.getItem('user_hearts')) || 5;
                let currentStreak = parseInt(localStorage.getItem('user_streak')) || 0;
                
                currentXP += xpEarned;
                currentHearts = Math.max(0, Math.min(5, currentHearts + heartsDelta));
                
                // Check if streak continues (simplified)
                const lastPractice = localStorage.getItem('last_practice_date');
                const today = new Date().toDateString();
                if (lastPractice !== today) {
                    currentStreak++;
                    localStorage.setItem('last_practice_date', today);
                }
                
                localStorage.setItem('user_total_xp', currentXP);
                localStorage.setItem('user_hearts', currentHearts);
                localStorage.setItem('user_streak', currentStreak);
                
                // Calculate level
                const level = Math.floor(currentXP / 100) + 1;
                localStorage.setItem('user_level', level);
                
                return { xp: currentXP, hearts: currentHearts, streak: currentStreak, level };
            }
        }

        const api = new DuolingoAPI();

        // ==================== APP STATE ====================
        
        const courses = [
            {
                id: 1,
                title: "T…ôm…ôll…ôr",
                subtitle: "Salamla≈üma v…ô ∆èsas ƒ∞fad…ôl…ôr",
                description: "ƒ∞ngilis dilinin …ôsaslarƒ±nƒ± √∂yr…ônin",
                icon: "üëã",
                totalLevels: 3,
                currentLevel: 1,
                completed: false,
                locked: false,
                color: "#58cc02",
                exercises: [
                    {
                        type: 'vocabulary',
                        question: '"Salam" s√∂z√ºn√ºn ingilis dilind…ô qar≈üƒ±lƒ±ƒüƒ± n…ôdir?',
                        options: ['Goodbye', 'Hello', 'Thank you', 'Please'],
                        correct: 1,
                        audio: 'hello'
                    },
                    {
                        type: 'translate',
                        question: '"M…ônim adƒ±m..." c√ºml…ôsini ingilis dilind…ô yazƒ±n',
                        answer: 'My name is',
                        acceptable: ['my name is', 'my names', 'i am'],
                        audio: 'my name is'
                    },
                    {
                        type: 'speaking',
                        question: 'Bu c√ºml…ôni deyin: "Hello, my name is..."',
                        target: 'hello my name is',
                        hint: 'Hello, my name is...'
                    }
                ]
            },
            {
                id: 2,
                title: "R…ôngl…ôr",
                subtitle: "∆èsas R…ôngl…ôri √ñyr…ôn",
                description: "G√ºnd…ôlik r…ôngl…ôr v…ô ifad…ôl…ôr",
                icon: "üé®",
                totalLevels: 4,
                currentLevel: 1,
                completed: false,
                locked: true,
                color: "#ce82ff",
                dependsOn: 1,
                exercises: [
                    {
                        type: 'vocabulary',
                        question: 'G√∂y r…ông ingilis dilind…ô nec…ôdir?',
                        options: ['Red', 'Green', 'Blue', 'Yellow'],
                        correct: 2,
                        audio: 'blue'
                    },
                    {
                        type: 'sentence',
                        question: 'D√ºzg√ºn c√ºml…ô qurun: "M…ônim sevdiyim r…ông g√∂yd√ºr"',
                        words: ['My', 'color', 'is', 'blue', 'favorite'],
                        correct: ['My', 'favorite', 'color', 'is', 'blue']
                    },
                    {
                        type: 'listening',
                        audioText: 'The sky is blue',
                        question: 'Dinl…ôdiyinizi yazƒ±n'
                    },
                    {
                        type: 'vocabulary',
                        question: '"Qƒ±rmƒ±zƒ±" s√∂z√ºn√ºn ingilis dilind…ô qar≈üƒ±lƒ±ƒüƒ±?',
                        options: ['Blue', 'Green', 'Red', 'Black'],
                        correct: 2,
                        audio: 'red'
                    }
                ]
            },
            {
                id: 3,
                title: "Heyvanlar",
                subtitle: "V…ôh≈üi v…ô Ev Heyvanlarƒ±",
                description: "Heyvan adlarƒ±nƒ± v…ô sif…ôtl…ôri √∂yr…ônin",
                icon: "ü¶Å",
                totalLevels: 5,
                currentLevel: 1,
                completed: false,
                locked: true,
                color: "#ffc800",
                dependsOn: 2,
                exercises: [
                    { type: 'vocabulary', question: '"ƒ∞t" nec…ô deyilir?', options: ['Cat', 'Dog', 'Bird', 'Fish'], correct: 1, audio: 'dog' },
                    { type: 'translate', question: '"B√∂y√ºk pi≈üik" t…ôrc√ºm…ôsi', answer: 'big cat', acceptable: ['the big cat', 'a big cat'] },
                    { type: 'speaking', question: '"I like dogs" deyin', target: 'i like dogs', hint: 'I like dogs' }
                ]
            },
            {
                id: 4,
                title: "Ail…ô",
                subtitle: "Ail…ô √úzvl…ôri",
                description: "Ail…ô haqqƒ±nda danƒ±≈ümaq",
                icon: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶",
                totalLevels: 4,
                currentLevel: 1,
                completed: false,
                locked: true,
                color: "#1cb0f6",
                dependsOn: 3,
                exercises: [
                    { type: 'vocabulary', question: '"Ana" ingilis dilind…ô?', options: ['Father', 'Mother', 'Sister', 'Brother'], correct: 1, audio: 'mother' },
                    { type: 'sentence', question: 'C√ºml…ô qurun: "M…ônim anam xo≈üb…ôxtdir"', words: ['My', 'is', 'mother', 'happy'], correct: ['My', 'mother', 'is', 'happy'] }
                ]
            },
            {
                id: 5,
                title: "Qida",
                subtitle: "Yem…ôkl…ôr v…ô ƒ∞√ßkil…ôr",
                description: "Restoranda sifari≈ü verm…ôk",
                icon: "üçé",
                totalLevels: 6,
                currentLevel: 1,
                completed: false,
                locked: true,
                color: "#ff4b4b",
                dependsOn: 4,
                exercises: [
                    { type: 'vocabulary', question: '"Su" nec…ô deyilir?', options: ['Bread', 'Water', 'Milk', 'Tea'], correct: 1, audio: 'water' },
                    { type: 'translate', question: '"M…ôn √ßay ist…ôyir…ôm"', answer: 'I want tea', acceptable: ['i want tea', 'i would like tea'] }
                ]
            }
        ];

        let currentState = {
            user: null,
            currentLesson: null,
            currentExerciseIndex: 0,
            selectedAnswer: null,
            constructedSentence: [],
            recognition: null,
            isRecording: false
        };

        // ==================== INITIALIZATION ====================

        async function init() {
            // Check for existing session
            const token = localStorage.getItem('duo_token');
            if (token) {
                await loadUserData();
                showMainApp();
            }
        }

        async function login() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            if (!username || !password) {
                showError('Z…ôhm…ôt olmazsa, m…ôlumatlarƒ± daxil edin');
                return;
            }
            
            try {
                const result = await api.login(username, password);
                await loadUserData();
                showMainApp();
            } catch (err) {
                showError('Giri≈ü x…ôtasƒ±: ' + err.message);
            }
        }

        async function loadUserData() {
            currentState.user = await api.getUser();
            updateHeaderStats();
        }

        function showMainApp() {
            document.getElementById('login-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-header').style.display = 'block';
                document.getElementById('main-container').style.display = 'grid';
                showSection('learn');
            }, 500);
        }

        function logout() {
            localStorage.removeItem('duo_token');
            localStorage.removeItem('duo_user');
            location.reload();
        }

        // ==================== NAVIGATION & VIEWS ====================

        function showSection(section) {
            // Update nav active state
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            
            const content = document.getElementById('content-area');
            
            switch(section) {
                case 'learn':
                    document.getElementById('nav-learn').classList.add('active');
                    renderLearningPath(content);
                    break;
                case 'vocabulary':
                    document.getElementById('nav-vocab').classList.add('active');
                    renderVocabulary(content);
                    break;
                case 'profile':
                    document.getElementById('nav-profile').classList.add('active');
                    renderProfile(content);
                    break;
            }
        }

        function renderLearningPath(container) {
            // Update lesson lock states based on completed status
            updateLessonLocks();
            
            let html = `
                <div class="section-header">
                    <h2 class="section-title">
                        <span>üéØ</span>
                        <span>√ñyr…ônm…ô Yolu</span>
                    </h2>
                    <div class="course-selector">
                        <div class="course-chip active">
                            <span>üá¨üáß</span>
                            <span>ƒ∞ngilis dili</span>
                        </div>
                    </div>
                </div>
                <div class="path-container">
                    <div class="path-line"></div>
            `;
            
            courses.forEach(course => {
                const statusClass = course.completed ? 'completed' : (course.locked ? 'locked' : 'active');
                const stars = course.completed ? 3 : (course.locked ? 0 : (course.currentLevel > 1 ? 2 : 0));
                
                html += `
                    <div class="lesson-node ${statusClass}" onclick="${course.locked ? '' : `startLesson(${course.id})`}">
                        <div class="node-circle">${course.locked ? 'üîí' : course.icon}</div>
                        <div class="node-content">
                            <h3>${course.title}</h3>
                            <p>${course.subtitle}</p>
                            <small style="color: #999; display: block; margin-top: 0.5rem;">
                                ${course.exercises.length} tap≈üƒ±rƒ±q ‚Ä¢ S…ôviyy…ô ${course.currentLevel}/${course.totalLevels}
                            </small>
                        </div>
                        <div class="node-meta">
                            ${!course.locked ? `
                                <div class="level-badge">${course.currentLevel}-ci s…ôviyy…ô</div>
                                <div class="stars">
                                    ${[1,2,3].map(i => `<span class="star ${i <= stars ? 'filled' : 'empty'}">‚òÖ</span>`).join('')}
                                </div>
                            ` : '<span style="color: #999; font-size: 0.85rem;">Kilitli</span>'}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function updateLessonLocks() {
            // First course always unlocked
            if (courses.length > 0) courses[0].locked = false;
            
            // Check dependencies
            for (let i = 1; i < courses.length; i++) {
                const prevCourse = courses.find(c => c.id === courses[i].dependsOn);
                if (prevCourse && prevCourse.completed) {
                    courses[i].locked = false;
                }
            }
            
            // Update active status (first unlocked incomplete course)
            let foundActive = false;
            courses.forEach(course => {
                if (!course.completed && !course.locked && !foundActive) {
                    course.active = true;
                    foundActive = true;
                } else {
                    course.active = false;
                }
            });
        }

        async function renderVocabulary(container) {
            container.innerHTML = `
                <div class="section-header">
                    <h2 class="section-title">
                        <span>üìñ</span>
                        <span>M…ônim L√ºƒü…ôtim</span>
                    </h2>
                </div>
                <div class="spinner"></div>
            `;
            
            const vocab = await api.getVocabulary();
            
            let html = `
                <div class="section-header">
                    <h2 class="section-title">
                        <span>üìñ</span>
                        <span>M…ônim L√ºƒü…ôtim (${vocab.length} s√∂z)</span>
                    </h2>
                </div>
                <div class="vocab-grid">
            `;
            
            vocab.forEach(item => {
                const strengthPercent = Math.round(item.strength * 100);
                html += `
                    <div class="vocab-card" onclick="speak('${item.word}')">
                        <div class="vocab-word">${item.word}</div>
                        <div class="vocab-translation">${item.translation}</div>
                        <div class="vocab-meta">
                            <span>${item.pos}</span>
                            <span>G√ºc: ${strengthPercent}%</span>
                        </div>
                        <div class="strength-bar">
                            <div class="strength-fill" style="width: ${strengthPercent}%"></div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        async function renderProfile(container) {
            const xpData = await api.getXpSummaries();
            const mistakes = await api.getMistakesCount();
            
            container.innerHTML = `
                <div class="profile-header">
                    <div class="profile-avatar-large">üë®‚Äçüéì</div>
                    <h2>${currentState.user.name}</h2>
                    <p>${currentState.user.email}</p>
                    <div style="margin-top: 1rem; opacity: 0.9;">
                        ${currentState.user.streak} g√ºn seriya ‚Ä¢ S…ôviyy…ô ${currentState.user.level}
                    </div>
                </div>
                
                <h3 style="margin-bottom: 1rem;">üìä Statistika</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">${currentState.user.totalXp}</div>
                        <div class="stat-label">√úmumi XP</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${currentState.user.streak}</div>
                        <div class="stat-label">G√ºnl√ºk Seriya</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${mistakes.numberMistakes}</div>
                        <div class="stat-label">D√ºz…ôldil…ôn X…ôtalar</div>
                    </div>
                </div>
                
                <h3 style="margin: 2rem 0 1rem;">üèÜ Nailiyy…ôtl…ôr</h3>
                <div class="achievements-grid">
                    <div class="achievement-card">
                        <div class="achievement-icon">üî•</div>
                        <div class="achievement-name">Seriya Ustasƒ±</div>
                        <div class="achievement-desc">7 g√ºn ardƒ±cƒ±l √∂yr…ôn</div>
                    </div>
                    <div class="achievement-card">
                        <div class="achievement-icon">üíé</div>
                        <div class="achievement-name">XP Toplayƒ±cƒ±</div>
                        <div class="achievement-desc">1000 XP qazan</div>
                    </div>
                    <div class="achievement-card">
                        <div class="achievement-icon">üéØ</div>
                        <div class="achievement-name">D…ôqiq Z…ôrb…ô</div>
                        <div class="achievement-desc">10 d…ôrs s…ôvsiz tamamla</div>
                    </div>
                </div>
            `;
        }

        // ==================== EXERCISE ENGINE ====================

        function startLesson(lessonId) {
            const lesson = courses.find(c => c.id === lessonId);
            if (!lesson || lesson.locked) return;
            
            currentState.currentLesson = lesson;
            currentState.currentExerciseIndex = 0;
            
            document.getElementById('exercise-modal').classList.add('active');
            renderExercise();
        }

        function renderExercise() {
            const lesson = currentState.currentLesson;
            const exercise = lesson.exercises[currentState.currentExerciseIndex];
            const progress = ((currentState.currentExerciseIndex) / lesson.exercises.length) * 100;
            
            document.getElementById('exercise-progress').style.width = progress + '%';
            
            const body = document.getElementById('exercise-body');
            const checkBtn = document.getElementById('check-answer-btn');
            
            checkBtn.disabled = true;
            checkBtn.textContent = 'Yoxla';
            checkBtn.onclick = checkAnswer;
            
            currentState.selectedAnswer = null;
            currentState.constructedSentence = [];
            
            if (exercise.type === 'vocabulary') {
                renderVocabExercise(body, exercise);
            } else if (exercise.type === 'translate') {
                renderTranslateExercise(body, exercise);
            } else if (exercise.type === 'sentence') {
                renderSentenceExercise(body, exercise);
            } else if (exercise.type === 'speaking') {
                renderSpeakingExercise(body, exercise);
            } else if (exercise.type === 'listening') {
                renderListeningExercise(body, exercise);
            }
        }

        function renderVocabExercise(container, exercise) {
            container.innerHTML = `
                <div class="question-type-badge">üìù S√∂z Bilgisi</div>
                <h3 class="question-text">${exercise.question}</h3>
                <button class="audio-player" onclick="speak('${exercise.audio}')">
                    <div class="audio-icon">üîä</div>
                    <div>Dinl…ôm…ôk √º√ß√ºn klikl…ôyin</div>
                </button>
                <div class="options-grid">
                    ${exercise.options.map((opt, idx) => `
                        <div class="option-card" onclick="selectOption(${idx}, this)">${opt}</div>
                    `).join('')}
                </div>
            `;
        }

        function renderTranslateExercise(container, exercise) {
            container.innerHTML = `
                <div class="question-type-badge">üîÑ T…ôrc√ºm…ô</div>
                <h3 class="question-text">${exercise.question}</h3>
                ${exercise.hint ? `
                    <div class="hint-box">
                        üí° ƒ∞pucu: ${exercise.hint}
                    </div>
                ` : ''}
                <button class="audio-player" onclick="speak('${exercise.audio || exercise.answer}')">
                    <div class="audio-icon">üéß</div>
                    <div>S…ôsl…ôndir</div>
                </button>
                <input type="text" class="text-input" placeholder="Cavabƒ±nƒ±zƒ± yazƒ±n..." 
                       oninput="updateTextAnswer(this.value)" spellcheck="false">
            `;
            document.getElementById('check-answer-btn').disabled = false;
        }

        function renderSentenceExercise(container, exercise) {
            container.innerHTML = `
                <div class="question-type-badge">üß© C√ºml…ô Qurma</div>
                <h3 class="question-text">${exercise.question}</h3>
                <div class="answer-area" id="answer-area">
                    <span style="color: #ccc; font-style: italic;">S√∂zl…ôri bura yerl…ô≈üdirin...</span>
                </div>
                <div class="word-bank" id="word-bank">
                    ${exercise.words.map(word => `
                        <span class="word-chip" onclick="addWordToSentence('${word}', this)">${word}</span>
                    `).join('')}
                </div>
            `;
        }

        function renderSpeakingExercise(container, exercise) {
            container.innerHTML = `
                <div class="question-type-badge">üé§ Danƒ±≈üƒ±q</div>
                <h3 class="question-text">${exercise.question}</h3>
                <div class="hint-box">üí° ${exercise.hint}</div>
                <div class="speak-container">
                    <button class="mic-button" id="mic-btn" onclick="toggleSpeech()">üé§</button>
                    <div class="recognized-text" id="recognized-text">...</div>
                    <div style="color: #999; margin-top: 1rem; font-size: 0.9rem;">
                        Mikrofona klikl…ôyin v…ô danƒ±≈üƒ±n
                    </div>
                </div>
            `;
            initSpeechRecognition();
            document.getElementById('check-answer-btn').disabled = false;
        }

        function renderListeningExercise(container, exercise) {
            container.innerHTML = `
                <div class="question-type-badge">üëÇ Dinl…ôm…ô</div>
                <h3 class="question-text">${exercise.question}</h3>
                <button class="audio-player" onclick="speak('${exercise.audioText}')" style="margin-bottom: 2rem;">
                    <div class="audio-icon">üîä</div>
                    <div>Dinl…ô (bird…ôn √ßox e≈üitm…ôk √º√ß√ºn klikl…ôyin)</div>
                </button>
                <input type="text" class="text-input" placeholder="E≈üitdikl…ôrinizi yazƒ±n..." 
                       oninput="updateTextAnswer(this.value)" spellcheck="false">
            `;
            setTimeout(() => speak(exercise.audioText), 500);
            document.getElementById('check-answer-btn').disabled = false;
        }

        // ==================== INTERACTION HANDLERS ====================

        function selectOption(index, element) {
            document.querySelectorAll('.option-card').forEach(card => {
                card.classList.remove('selected');
            });
            element.classList.add('selected');
            currentState.selectedAnswer = index;
            document.getElementById('check-answer-btn').disabled = false;
        }

        function updateTextAnswer(value) {
            currentState.selectedAnswer = value.trim();
            document.getElementById('check-answer-btn').disabled = value.trim().length === 0;
        }

        function addWordToSentence(word, chip) {
            const answerArea = document.getElementById('answer-area');
            const placeholder = answerArea.querySelector('span');
            if (placeholder) placeholder.remove();
            
            chip.classList.add('used');
            
            const wordSpan = document.createElement('span');
            wordSpan.className = 'answer-word';
            wordSpan.textContent = word;
            wordSpan.onclick = () => {
                wordSpan.remove();
                chip.classList.remove('used');
                if (answerArea.children.length === 0) {
                    answerArea.innerHTML = '<span style="color: #ccc; font-style: italic;">S√∂zl…ôri bura yerl…ô≈üdirin...</span>';
                }
                updateConstructedSentence();
            };
            
            answerArea.appendChild(wordSpan);
            updateConstructedSentence();
            document.getElementById('check-answer-btn').disabled = false;
        }

        function updateConstructedSentence() {
            const words = Array.from(document.querySelectorAll('.answer-word')).map(w => w.textContent);
            currentState.constructedSentence = words;
        }

        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                currentState.recognition = new SpeechRecognition();
                currentState.recognition.continuous = false;
                currentState.recognition.interimResults = false;
                currentState.recognition.lang = 'en-US';
                
                currentState.recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('recognized-text').textContent = transcript;
                    currentState.selectedAnswer = transcript.toLowerCase();
                    document.getElementById('check-answer-btn').disabled = false;
                };
                
                currentState.recognition.onerror = (event) => {
                    document.getElementById('recognized-text').textContent = 'X…ôta ba≈ü verdi, yenid…ôn c…ôhd edin';
                };
            }
        }

        function toggleSpeech() {
            if (!currentState.recognition) {
                alert('Brauzeriniz s…ôs tanƒ±manƒ± d…ôst…ôkl…ômir');
                return;
            }
            
            const btn = document.getElementById('mic-btn');
            
            if (currentState.isRecording) {
                currentState.recognition.stop();
                btn.classList.remove('recording');
                currentState.isRecording = false;
            } else {
                currentState.recognition.start();
                btn.classList.add('recording');
                currentState.isRecording = true;
                document.getElementById('recognized-text').textContent = 'Dinl…ônir...';
            }
        }

        // ==================== ANSWER CHECKING ====================

        function checkAnswer() {
            const lesson = currentState.currentLesson;
            const exercise = lesson.exercises[currentState.currentExerciseIndex];
            const checkBtn = document.getElementById('check-answer-btn');
            
            let isCorrect = false;
            let userAnswer = '';
            
            if (exercise.type === 'vocabulary') {
                isCorrect = currentState.selectedAnswer === exercise.correct;
                userAnswer = exercise.options[currentState.selectedAnswer];
                
                // Visual feedback
                const options = document.querySelectorAll('.option-card');
                options[exercise.correct].classList.add('correct');
                if (!isCorrect && currentState.selectedAnswer !== null) {
                    options[currentState.selectedAnswer].classList.add('wrong');
                }
            } 
            else if (exercise.type === 'translate' || exercise.type === 'listening') {
                userAnswer = currentState.selectedAnswer.toLowerCase().trim();
                const correct = exercise.answer.toLowerCase();
                const acceptable = exercise.acceptable ? exercise.acceptable.map(a => a.toLowerCase()) : [];
                
                isCorrect = userAnswer === correct || acceptable.includes(userAnswer) || 
                           (exercise.type === 'listening' && userAnswer.includes(correct));
                
                const input = document.querySelector('.text-input');
                if (isCorrect) {
                    input.classList.add('correct');
                } else {
                    input.classList.add('wrong');
                }
            }
            else if (exercise.type === 'sentence') {
                const userSentence = currentState.constructedSentence.join(' ').toLowerCase();
                const correctSentence = exercise.correct.join(' ').toLowerCase();
                isCorrect = userSentence === correctSentence;
                userAnswer = userSentence;
                
                const answerArea = document.getElementById('answer-area');
                if (isCorrect) {
                    answerArea.style.borderColor = 'var(--primary)';
                    answerArea.style.background = '#e8f5e9';
                } else {
                    answerArea.style.borderColor = 'var(--danger)';
                    answerArea.style.background = '#ffebee';
                }
            }
            else if (exercise.type === 'speaking') {
                const spoken = currentState.selectedAnswer || '';
                isCorrect = exercise.target.split(' ').every(word => spoken.includes(word));
                userAnswer = spoken;
            }
            
            // Handle result
            if (isCorrect) {
                playSound('success');
                createConfetti();
                checkBtn.textContent = 'Davam et ‚Üí';
                checkBtn.onclick = nextExercise;
                checkBtn.disabled = false;
                
                // Update XP
                api.updateUserStats(10, 0);
            } else {
                playSound('error');
                checkBtn.textContent = 'Davam et';
                checkBtn.onclick = nextExercise;
                checkBtn.disabled = false;
                
                // Reduce hearts
                const newStats = api.updateUserStats(0, -1);
                if (newStats.hearts === 0) {
                    setTimeout(() => {
                        alert('‚ù§Ô∏è Canƒ±nƒ±z qurtardƒ±! 4 saat sonra yenil…ôn…ôc…ôk.');
                        closeExercise();
                    }, 500);
                }
                
                // Track mistake
                let mistakes = parseInt(localStorage.getItem('user_mistakes')) || 0;
                localStorage.setItem('user_mistakes', mistakes + 1);
            }
            
            updateHeaderStats();
        }

        function nextExercise() {
            currentState.currentExerciseIndex++;
            const lesson = currentState.currentLesson;
            
            if (currentState.currentExerciseIndex >= lesson.exercises.length) {
                completeLesson();
            } else {
                renderExercise();
            }
        }

        function completeLesson() {
            const lesson = currentState.currentLesson;
            
            // Mark as completed
            lesson.completed = true;
            lesson.currentLevel++;
            
            // Unlock next lesson
            const nextLesson = courses.find(c => c.id === lesson.id + 1);
            if (nextLesson) {
                nextLesson.locked = false;
            }
            
            // Award bonus XP
            api.updateUserStats(50, 0);
            
            // Show results
            const body = document.getElementById('exercise-body');
            body.innerHTML = `
                <div class="results-container">
                    <div class="trophy">üèÜ</div>
                    <h2>D…ôrs Tamamlandƒ±!</h2>
                    <div class="xp-earned">+60 XP</div>
                    <p style="color: #666; margin-bottom: 2rem;">
                        ${lesson.title} d…ôrsini uƒüurla bitirdiniz!
                    </p>
                    <div class="stats-grid" style="max-width: 400px; margin: 0 auto;">
                        <div class="stat-card">
                            <div class="stat-number">3/3</div>
                            <div class="stat-label">Ulduz</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${lesson.exercises.length}</div>
                            <div class="stat-label">Tap≈üƒ±rƒ±q</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">100%</div>
                            <div class="stat-label">D…ôqiqlik</div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('exercise-footer').innerHTML = `
                <button class="check-btn" onclick="closeExercise(); showSection('learn');" style="width: 100%;">
                    Baƒüla
                </button>
            `;
            
            createConfetti();
            updateHeaderStats();
        }

        function skipExercise() {
            nextExercise();
        }

        function closeExercise() {
            document.getElementById('exercise-modal').classList.remove('active');
            document.getElementById('exercise-footer').innerHTML = `
                <button class="skip-btn" onclick="skipExercise()">Ke√ß</button>
                <button class="check-btn" id="check-answer-btn" onclick="checkAnswer()" disabled>Yoxla</button>
            `;
            
            if (currentState.recognition) {
                currentState.recognition.stop();
            }
        }

        // ==================== UTILITIES ====================

        function updateHeaderStats() {
            const user = currentState.user;
            if (!user) return;
            
            // Re-fetch from localStorage to get updates
            const xp = localStorage.getItem('user_total_xp') || 0;
            const streak = localStorage.getItem('user_streak') || 0;
            const hearts = localStorage.getItem('user_hearts') || 5;
            const level = localStorage.getItem('user_level') || 1;
            
            document.getElementById('header-xp').textContent = xp;
            document.getElementById('header-streak').textContent = streak;
            document.getElementById('header-hearts').textContent = hearts;
            
            // Sidebar updates
            document.getElementById('sidebar-username').textContent = user.username;
            document.getElementById('sidebar-total-xp').textContent = xp;
            document.getElementById('sidebar-level').textContent = level;
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                // Cancel previous speech
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 0.9;
                utterance.pitch = 1;
                window.speechSynthesis.speak(utterance);
            }
        }

        function playSound(type) {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            
            osc.connect(gain);
            gain.connect(ctx.destination);
            
            if (type === 'success') {
                // Major chord arpeggio
                const now = ctx.currentTime;
                [523.25, 659.25, 783.99, 1046.50].forEach((freq, i) => {
                    const o = ctx.createOscillator();
                    const g = ctx.createGain();
                    o.connect(g);
                    g.connect(ctx.destination);
                    o.frequency.value = freq;
                    g.gain.setValueAtTime(0.1, now + i * 0.05);
                    g.gain.exponentialRampToValueAtTime(0.01, now + i * 0.05 + 0.3);
                    o.start(now + i * 0.05);
                    o.stop(now + i * 0.05 + 0.3);
                });
            } else {
                // Low buzz for error
                osc.frequency.setValueAtTime(150, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 0.3);
                gain.gain.setValueAtTime(0.3, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                osc.start(ctx.currentTime);
                osc.stop(ctx.currentTime + 0.3);
            }
        }

        function createConfetti() {
            const colors = ['#58cc02', '#1cb0f6', '#ffc800', '#ff4b4b', '#ce82ff'];
            for (let i = 0; i < 60; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animation = `confetti-fall ${Math.random() * 3 + 2}s linear forwards`;
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 5000);
                }, i * 30);
            }
        }

        function showError(msg) {
            const toast = document.getElementById('error-toast');
            toast.textContent = msg;
            toast.style.display = 'block';
            setTimeout(() => toast.style.display = 'none', 3000);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && document.getElementById('exercise-modal').classList.contains('active')) {
                closeExercise();
            }
        });

        // Initialize
        init();
    </script>
</body>
</html>
