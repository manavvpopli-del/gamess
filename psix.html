<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psixoloji Test - Multiplayer</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            padding: 20px; 
        }
        .container { 
            background: white; 
            border-radius: 20px; 
            padding: 25px; 
            max-width: 500px; 
            width: 100%; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.3); 
        }
        h1 { text-align: center; color: #333; margin-bottom: 15px; font-size: 22px; }
        input { 
            width: 100%; 
            padding: 15px; 
            border: 2px solid #ddd; 
            border-radius: 10px; 
            font-size: 16px; 
            margin: 10px 0; 
            text-align: center;
        }
        button { 
            width: 100%; 
            padding: 15px; 
            background: #667eea; 
            color: white; 
            border: none; 
            border-radius: 10px; 
            font-size: 16px; 
            cursor: pointer; 
            margin: 5px 0;
            transition: 0.3s;
        }
        button:disabled { background: #ccc; cursor: not-allowed; }
        button:hover:not(:disabled) { background: #5568d3; transform: translateY(-2px); }
        
        .code-box { 
            background: #f0f0f0; 
            padding: 20px; 
            text-align: center; 
            font-size: 32px; 
            font-weight: bold; 
            color: #667eea; 
            border-radius: 10px; 
            margin: 15px 0;
            border: 3px dashed #667eea;
            letter-spacing: 5px;
        }
        
        .progress-bar { 
            width: 100%; 
            height: 8px; 
            background: #eee; 
            border-radius: 4px; 
            margin: 15px 0; 
            overflow: hidden; 
        }
        .progress { 
            height: 100%; 
            background: #667eea; 
            transition: width 0.3s; 
        }
        
        .question { 
            font-size: 17px; 
            font-weight: 600; 
            color: #333; 
            margin: 15px 0; 
            line-height: 1.5; 
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }
        
        .answer-btn { 
            background: #f8f9fa; 
            border: 2px solid #e9ecef; 
            color: #333; 
            text-align: left; 
            margin: 5px 0;
            padding: 12px;
        }
        .answer-btn:hover:not(:disabled) { background: #e9ecef; border-color: #667eea; }
        .answer-btn.selected { background: #667eea; color: white; border-color: #667eea; }
        .answer-btn:disabled { opacity: 0.6; }
        
        .status { 
            text-align: center; 
            padding: 10px; 
            background: #e3f2fd; 
            color: #1976d2; 
            border-radius: 8px; 
            margin-top: 10px;
            display: none;
        }
        .status.show { display: block; }
        
        .hidden { display: none; }
        
        .result-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
            line-height: 1.8;
        }
        
        .copy-hint {
            font-size: 12px;
            color: #666;
            text-align: center;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§  Psixoloji Analiz</h1>
        
        <!-- Menyu -->
        <div id="menu">
            <p style="text-align: center; color: #666; margin-bottom: 15px;">
                Dostunuzla 30 suallÄ±q test. Her iki tÉ™rÉ™f cavab verdikdÉ™n sonra sual dÉ™yiÅŸir.
            </p>
            <button onclick="createRoom()">Yeni Oyun Yarat</button>
            <input type="text" id="roomInput" placeholder="Dostunuzun kodunu daxil edin" maxlength="4">
            <button onclick="joinRoom()">Oyuna QoÅŸul</button>
            <div id="error" style="color: red; text-align: center; margin-top: 10px;"></div>
        </div>

        <!-- OyunÃ§u gÃ¶zlÉ™nilir -->
        <div id="waiting" class="hidden">
            <p style="text-align: center;">Otaq kodunuz:</p>
            <div class="code-box" id="roomCodeDisplay">----</div>
            <p class="copy-hint">Bu kodu dostunza gÃ¶ndÉ™rin!</p>
            <p style="text-align: center; color: #856404; margin-top: 15px;">
                â³ RÉ™qib gÃ¶zlÉ™nilir...
            </p>
            <div style="text-align: center; margin-top: 10px;">
                <span id="playerCount" style="background: #ffd700; padding: 5px 10px; border-radius: 15px; font-size: 14px;">
                    1/2 oyunÃ§u
                </span>
            </div>
        </div>

        <!-- Oyun sahÉ™si -->
        <div id="game" class="hidden">
            <div class="progress-bar">
                <div class="progress" id="progress" style="width: 0%"></div>
            </div>
            <div class="question" id="questionText"></div>
            <div id="answers"></div>
            <div class="status" id="status">RÉ™qibin cavabÄ±nÄ± gÃ¶zlÉ™yir...</div>
        </div>

        <!-- NÉ™ticÉ™ -->
        <div id="result" class="hidden">
            <h2 style="text-align: center; color: #667eea;">ğŸ¯ Sizin Profiliniz</h2>
            <div id="resultContent" class="result-box"></div>
            <button onclick="location.reload()" style="margin-top: 15px;">Yeni Oyun</button>
        </div>
    </div>

    <script>
        // âš ï¸ BURAYA Ã–Z FIREBASE MÆLUMATLARINI YAZ (aÅŸaÄŸÄ±dakÄ± nÃ¼munÉ™ni silib Ã¶zÃ¼nÃ¼ yaz)
        const firebaseConfig = {
  apiKey: "AIzaSyCM5WdZNSj9oFipNI-J3csHpOIvK8PjoLU",
  authDomain: "sevgili-testi.firebaseapp.com",
  databaseURL: "https://sevgili-testi-default-rtdb.firebaseio.com",
  projectId: "sevgili-testi",
  storageBucket: "sevgili-testi.firebasestorage.app",
  messagingSenderId: "399260477557",
  appId: "1:399260477557:web:584204a698d7bf145bb03c",
  measurementId: "G-44P21XCZ7G"
};

        // Firebase baÅŸlat
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let roomId = null;
        let playerId = Math.random().toString(36).substr(2, 9);
        let currentQ = 0;
        let totalPlayers = 0;

        const questions = [
            { q: "Yeni tanÄ±ÅŸlÄ±qlarda Ã¶zÃ¼nÃ¼zÃ¼ necÉ™ hiss edirsiniz?", a: ["Rahat", "Bir az narahat", "Ã‡ox stresli", "QAÃ‡ARIAM"] },
            { q: "Plan dÉ™yiÅŸdikdÉ™:", a: ["AsanlÄ±qla uyÄŸunlaÅŸÄ±ram", "Bir az vaxt lazÄ±mdÄ±r", "StreslÉ™nirÉ™m", "Ã‡Ã¶kÉ™rÉ™m"] },
            { q: "BoÅŸ vaxtda:", a: ["Dostlarla", "YalnÄ±z", "Film/kitab", "DÃ¼ÅŸÃ¼nÉ™rÉ™m"] },
            { q: "TÉ™nqidÉ™:", a: ["Konstruktiv qÉ™bul", "Ä°nciyirÉ™m", "AÄŸrÄ±yÄ±r", "DÉ™hÅŸÉ™t"] },
            { q: "QÉ™rarda:", a: ["MÉ™ntiq", "Ä°ntuisiya", "BaÅŸqalarÄ±", "Tale"] },
            { q: "Stress anÄ±nda:", a: ["MÉ™ÅŸq", "YemÉ™k", "DÃ¼ÅŸÃ¼nmÉ™k", "AÄŸlamaq"] },
            { q: "BaÅŸqalarÄ±nÄ±n hissi:", a: ["DÉ™rhal hiss", "Sonra anlayÄ±ram", "Ã‡É™tin", "MaraqsÄ±z"] },
            { q: "HÉ™dÉ™f Ã¼Ã§Ã¼n:", a: ["Risk", "Plan", "KÃ¶mÉ™k", "Tale"] },
            { q: "KeÃ§miÅŸ:", a: ["DÉ™rslÉ™r aldÄ±m", "XatÄ±rlayÄ±ram", "Ã‡ox dÃ¼ÅŸÃ¼nÃ¼rÉ™m", "Orada yaÅŸayÄ±ram"] },
            { q: "GÉ™lÉ™cÉ™k:", a: ["Optimist", "Realist", "Pessimist", "DÉ™hÅŸÉ™t"] },
            { q: "Problem hÉ™llindÉ™:", a: ["Praktik", "Kreativ", "BaÅŸqasÄ±na", "Yox sayÄ±ram"] },
            { q: "Ã–zÃ¼nÃ¼ qiymÉ™t:", a: ["GÃ¼clÃ¼", "Normal", "ZÉ™if", "BilmirÉ™m"] },
            { q: "Ä°deya bÃ¶lÃ¼ÅŸmÉ™:", a: ["AÃ§Ä±q", "SeÃ§ici", "Ã‡É™tin", "HeÃ§"] },
            { q: "SÉ™bir:", a: ["HÉ™ddindÉ™n artÄ±q", "Normal", "Az", "Yoxdur"] },
            { q: "MÃ¼naqiÅŸÉ™:", a: ["SakitlÉ™ÅŸdirÉ™rÉ™m", "MÃ¼dafiÉ™", "HÃ¼cum", "KaÃ§aram"] },
            { q: "DÉ™yiÅŸiklik:", a: ["XoÅŸum gÉ™lir", "Adaptasiya", "MÃ¼qavimÉ™t", "Qorxuram"] },
            { q: "Sosial media:", a: ["HÉ™r gÃ¼n", "BÉ™zÉ™n", "Nadir", "HeÃ§"] },
            { q: "YalnÄ±zlÄ±q:", a: ["LazÄ±mlÄ±", "Normal", "Ã‡É™tin", "DÉ™hÅŸÉ™tli"] },
            { q: "Sevdiyin rÉ™ng:", a: ["QÄ±rmÄ±zÄ±", "Mavi", "YaÅŸÄ±l", "Qara"] },
            { q: "HÉ™yat ritmi:", a: ["SÃ¼rÉ™tli", "DengÉ™li", "YavaÅŸ", "DayanmÄ±ÅŸ"] },
            { q: "Pul:", a: ["XÉ™rclÉ™yirÉ™m", "PlanlÄ±", "XÉ™sis", "Fikir vermirÉ™m"] },
            { q: "SÉ™hÉ™r:", a: ["ErkÉ™n", "Normal", "Gec", "YorÄŸun"] },
            { q: "Ä°dman:", a: ["HÉ™r gÃ¼n", "BÉ™zÉ™n", "Nadir", "HeÃ§"] },
            { q: "YemÉ™k:", a: ["SaÄŸlam", "Normal", "Fast food", "DÉ™yiÅŸkÉ™n"] },
            { q: "Yuxu:", a: ["DÉ™rin", "Normal", "Pis", "DÉ™rmanla"] },
            { q: "BaÅŸ aÄŸrÄ±sÄ±:", a: ["HeÃ§", "Nadir", "Tez-tez", "Daimi"] },
            { q: "Enerji:", a: ["YÃ¼ksÉ™k", "Normal", "AlÃ§aq", "TÃ¼kÉ™nmiÅŸ"] },
            { q: "YaradÄ±cÄ±lÄ±q:", a: ["HÉ™r gÃ¼n", "BÉ™zÉ™n", "Nadir", "Yox"] },
            { q: "MÃ¼kÉ™mmÉ™llik:", a: ["SaÄŸlam", "HÉ™ddindÉ™n Ã§ox", "Yox", "BilmirÉ™m"] },
            { q: "HÉ™yat:", a: ["Æla", "YaxÅŸÄ±", "Orta", "Pis"] }
        ];

        function createRoom() {
            roomId = Math.floor(1000 + Math.random() * 9000).toString();
            
            // Otaq yarat
            db.ref('rooms/' + roomId).set({
                created: Date.now(),
                currentQuestion: 0,
                players: {
                    [playerId]: { joined: Date.now(), answers: {}, ready: false }
                }
            }).then(() => {
                document.getElementById('menu').classList.add('hidden');
                document.getElementById('waiting').classList.remove('hidden');
                document.getElementById('roomCodeDisplay').textContent = roomId;
                
                // DinlÉ™mÉ™yÉ™ baÅŸla
                listenRoom();
            });
        }

        function joinRoom() {
            roomId = document.getElementById('roomInput').value.trim();
            if (!roomId || roomId.length !== 4) {
                document.getElementById('error').textContent = "4 rÉ™qÉ™mli kod daxil edin!";
                return;
            }

            // Otaq varmÄ± yoxla
            db.ref('rooms/' + roomId).once('value').then((snapshot) => {
                if (!snapshot.exists()) {
                    document.getElementById('error').textContent = "Otaq tapÄ±lmadÄ±!";
                    return;
                }
                
                // OyunÃ§u É™lavÉ™ et
                db.ref('rooms/' + roomId + '/players/' + playerId).set({
                    joined: Date.now(),
                    answers: {},
                    ready: false
                });
                
                document.getElementById('menu').classList.add('hidden');
                document.getElementById('waiting').classList.remove('hidden');
                document.getElementById('roomCodeDisplay').textContent = roomId;
                document.querySelector('#waiting p').textContent = "QoÅŸuldunuz!";
                
                listenRoom();
            });
        }

        function listenRoom() {
            db.ref('rooms/' + roomId).on('value', (snapshot) => {
                const data = snapshot.val();
                if (!data) return;
                
                const players = data.players || {};
                const playerCount = Object.keys(players).length;
                totalPlayers = playerCount;
                
                document.getElementById('playerCount').textContent = playerCount + "/2 oyunÃ§u";
                
                // 2 nÉ™fÉ™r oldusa oyunu baÅŸlat
                if (playerCount === 2 && data.currentQuestion === 0 && !data.started) {
                    db.ref('rooms/' + roomId + '/started').set(true);
                    startGame();
                }
                
                // Oyun gedirsÉ™ vÉ™ sual dÉ™yiÅŸibsÉ™
                if (data.started && data.currentQuestion > currentQ) {
                    currentQ = data.currentQuestion;
                    if (currentQ < questions.length) {
                        showQuestion(currentQ);
                    } else {
                        showResult();
                    }
                }
                
                // CavablarÄ± yoxla (hÉ™r iki tÉ™rÉ™f veribsÉ™ nÃ¶vbÉ™ti suala keÃ§)
                if (data.started && currentQ < questions.length) {
                    checkAllAnswered(players);
                }
            });
        }

        function startGame() {
            document.getElementById('waiting').classList.add('hidden');
            document.getElementById('game').classList.remove('hidden');
            showQuestion(0);
        }

        function showQuestion(index) {
            currentQ = index;
            const q = questions[index];
            
            document.getElementById('progress').style.width = ((index + 1) / questions.length * 100) + '%';
            document.getElementById('questionText').textContent = (index + 1) + ". " + q.q;
            document.getElementById('status').classList.remove('show');
            
            const answersDiv = document.getElementById('answers');
            answersDiv.innerHTML = '';
            
            q.a.forEach((ans, idx) => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = ans;
                btn.onclick = () => submitAnswer(idx, btn);
                answersDiv.appendChild(btn);
            });
        }

        function submitAnswer(answerIndex, btn) {
            // UI yenilÉ™
            document.querySelectorAll('.answer-btn').forEach(b => {
                b.disabled = true;
                b.classList.remove('selected');
            });
            btn.classList.add('selected');
            btn.disabled = false;
            
            // Firebase yaz
            db.ref('rooms/' + roomId + '/players/' + playerId + '/answers/' + currentQ).set(answerIndex);
            db.ref('rooms/' + roomId + '/players/' + playerId + '/ready').set(true);
            
            document.getElementById('status').textContent = "RÉ™qibin cavabÄ±nÄ± gÃ¶zlÉ™yir...";
            document.getElementById('status').classList.add('show');
        }

        function checkAllAnswered(players) {
            const playerList = Object.values(players);
            if (playerList.length < 2) return;
            
            // HÉ™r iki oyunÃ§u bu suala cavab veribmi?
            const allAnswered = playerList.every(p => 
                p.answers && p.answers[currentQ] !== undefined && p.ready
            );
            
            if (allAnswered) {
                // HamÄ± veribsÉ™, nÃ¶vbÉ™ti suala keÃ§ (yalnÄ±z bir dÉ™fÉ™ yazsÄ±n deyÉ™, sonuncu cavab verÉ™n yazsÄ±n)
                const lastAnsweredPlayer = Object.keys(players).find(key => 
                    players[key].answers && players[key].answers[currentQ] !== undefined
                );
                
                if (lastAnsweredPlayer === playerId) {
                    // 3 saniyÉ™ gÃ¶zlÉ™ sonra nÃ¶vbÉ™ti sual
                    setTimeout(() => {
                        // HazÄ±r statusunu sÄ±fÄ±rla
                        playerList.forEach((p, idx) => {
                            const pid = Object.keys(players)[idx];
                            db.ref('rooms/' + roomId + '/players/' + pid + '/ready').set(false);
                        });
                        
                        // SonrakÄ± suala keÃ§
                        const nextQ = currentQ + 1;
                        if (nextQ < questions.length) {
                            db.ref('rooms/' + roomId + '/currentQuestion').set(nextQ);
                        } else {
                            db.ref('rooms/' + roomId + '/finished').set(true);
                        }
                    }, 1500); // 1.5 saniyÉ™ gÃ¶zlÉ™ ki, hÉ™r iki tÉ™rÉ™f gÃ¶rsÃ¼n
                }
            }
        }

        function showResult() {
            document.getElementById('game').classList.add('hidden');
            document.getElementById('result').classList.remove('hidden');
            
            // Ã–z cavablarÄ±nÄ± al vÉ™ analiz et
            db.ref('rooms/' + roomId + '/players/' + playerId + '/answers').once('value').then((snapshot) => {
                const answers = snapshot.val() || {};
                const result = analyzePsychology(Object.values(answers));
                document.getElementById('resultContent').innerHTML = result;
            });
        }

        function analyzePsychology(answers) {
            let extrovert = 0, anxiety = 0, stability = 0, creativity = 0;
            
            answers.forEach((ans) => {
                if (ans == 0) extrovert++;
                else if (ans == 1) stability++;
                else if (ans == 2) anxiety++;
                else if (ans == 3) creativity++;
            });
            
            let type = "stability";
            let max = Math.max(extrovert, anxiety, stability, creativity);
            if (extrovert === max) type = "extrovert";
            else if (anxiety === max) type = "anxiety";
            else if (creativity === max) type = "creativity";
            
            const profiles = {
                extrovert: {
                    title: "ğŸŒŸ Sosial Lider",
                    text: "Siz É™traf mÃ¼hitÉ™ asanlÄ±qla uyÄŸunlaÅŸÄ±rsÄ±nÄ±z. Yeni insanlarla tanÄ±ÅŸlÄ±q sizÉ™ enerji verir. Liderlik keyfiyyÉ™tlÉ™riniz gÃ¼clÃ¼dÃ¼r. Ã‡ox vaxt pozitiv vÉ™ enerjik olursunuz.",
                    advice: "BÉ™zÉ™n yalnÄ±z qalmaÄŸÄ± da Ã¶yrÉ™nin, daxili dÃ¼nyanÄ±zÄ± kÉ™ÅŸf edin."
                },
                anxiety: {
                    title: "ğŸŒ§ï¸ HÉ™ssas Analitik",
                    text: "Siz hÉ™r ÅŸeyi dÉ™rindÉ™n hiss edirsiniz. Detallara diqqÉ™tiniz yÃ¼ksÉ™kdir. Empatiya qabiliyyÉ™tiniz gÃ¼clÃ¼dÃ¼r. Ancaq bÉ™zÉ™n qÉ™rar vermÉ™kdÉ™ Ã§É™tinlik Ã§É™kirsiniz.",
                    advice: "HÉ™r ÅŸeyi tÉ™hlil etmÉ™yin, bÉ™zÉ™n sadÉ™cÉ™ yaÅŸayÄ±n."
                },
                stability: {
                    title: "âš–ï¸ Denge UstasÄ±",
                    text: "Siz emosional cÉ™hÉ™tdÉ™n stabil vÉ™ praktik insansÄ±nÄ±z. ProblemlÉ™ri soyuqqanlÄ±qla hÉ™ll edirsiniz. EtibarlÄ± vÉ™ mÉ™suliyyÉ™tli birisinsiniz.",
                    advice: "HÉ™yatda bÉ™zÉ™n risk almaq da lazÄ±mdÄ±r."
                },
                creativity: {
                    title: "ğŸ¨ YaradÄ±cÄ± Ruh",
                    text: "Siz standartlardan uzaq, orijinal dÃ¼ÅŸÃ¼nÃ¼rsÃ¼nÃ¼z. TÉ™sÉ™vvÃ¼rÃ¼nÃ¼z gÃ¼clÃ¼dÃ¼r. Adi ÅŸeylÉ™rdÉ™ fÉ™rqli mÃ¶vqelÉ™r gÃ¶rÃ¼rsÃ¼nÃ¼z.",
                    advice: "IdeyalarÄ±nÄ±zÄ± reallaÅŸdÄ±rmaq Ã¼Ã§Ã¼n addÄ±mlar atÄ±n."
                }
            };
            
            const p = profiles[type];
            return `
                <h3 style="color: #667eea; text-align: center; margin-bottom: 10px;">${p.title}</h3>
                <p><strong>XÃ¼susiyyÉ™t:</strong> ${p.text}</p>
                <p style="margin-top: 10px; color: #856404;"><strong>MÉ™slÉ™hÉ™t:</strong> ${p.advice}</p>
                <hr style="margin: 15px 0; border: none; border-top: 1px solid #ddd;">
                <p style="font-size: 14px; color: #666; text-align: center;">
                    Ekstraversiya: ${extrovert} | Stabilite: ${stability} | HÉ™ssaslÄ±q: ${anxiety} | YaradÄ±cÄ±lÄ±q: ${creativity}
                </p>
            `;
        }
        
        // Cleanup - sÉ™hifÉ™ baÄŸlananda otaÄŸÄ± silmÉ™mÉ™k (baÅŸqasÄ± oynaya bilÉ™r), amma Ã¶z mÉ™lumatlarÄ±nÄ± sil
        window.onbeforeunload = function() {
            if (roomId) {
                // Sadece oyun bitmedise sil
                db.ref('rooms/' + roomId + '/players/' + playerId).remove();
            }
        };
    </script>
</body>
</html>
