<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sevgilini NÉ™ QÉ™dÉ™r TanÄ±yÄ±rsan?</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      color: #f0e0ff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      overflow-x: hidden;
    }
    #bg-video {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      object-fit: cover;
      z-index: -2;
    }
    #overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      z-index: -1;
    }
    h1 { 
      font-size: clamp(2.8rem, 8vw, 4.5rem); 
      margin: 10vh 0 4vh; 
      color: #ff66cc; 
      text-shadow: 0 0 20px #ff66ccaa; 
      z-index: 1;
      text-align: center;
    }
    #start-screen {
      position: fixed;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
      background: rgba(0,0,0,0.3);
    }
    #start-btn {
      font-size: 2.2rem;
      padding: 1rem 4rem;
      background: linear-gradient(135deg, #ff3366, #ff66cc, #cc33ff);
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(255, 51, 102, 0.5);
      transition: all 0.3s ease;
      animation: pulse 3s infinite;
      text-transform: uppercase;
      letter-spacing: 2px;
      font-weight: bold;
    }
    #start-btn:hover {
      transform: translateY(-4px);
      box-shadow: 0 15px 40px rgba(255, 51, 102, 0.6);
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(255, 51, 102, 0.4); }
      70% { box-shadow: 0 0 0 15px rgba(255, 51, 102, 0); }
      100% { box-shadow: 0 0 0 0 rgba(255, 51, 102, 0); }
    }
    #status {
      font-size: clamp(1.4rem, 5vw, 2rem);
      margin: 3vh 0 5vh;
      color: #ffcc66;
      text-align: center;
      max-width: 90%;
      z-index: 1;
    }
    #lobby { 
      text-align: center; 
      width: 100%; 
      max-width: 520px; 
      z-index: 1; 
      display: none;
    }
    input, button {
      font-size: 1.4rem;
      padding: 1rem 2rem;
      margin: 1.2rem 0.6rem;
      border: none;
      border-radius: 14px;
      width: 100%;
      max-width: 400px;
    }
    button {
      background: #ff33cc;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
    }
    button:hover { background: #ff1ab3; transform: translateY(-4px); }
    #copyBtn { background: #00cc88; }
    #copyBtn:hover { background: #00ffaa; }

    #game {
      display: none;
      width: 100%;
      max-width: 1100px;
      flex-direction: column;
      align-items: center;
      padding: 3vh 0;
      z-index: 1;
    }
    #timer {
      font-size: clamp(5rem, 14vw, 7rem);
      font-weight: bold;
      color: #ff3366;
      margin: 3vh 0;
      text-shadow: 0 0 20px #ff3366aa;
    }
    #qEmoji { font-size: clamp(6rem, 18vw, 9rem); margin: 3vh 0; }
    #question {
      font-size: clamp(1.8rem, 6vw, 2.8rem);
      text-align: center;
      line-height: 1.45;
      margin: 4vh 0 6vh;
      max-width: 90%;
    }
    .options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2.5vh;
      width: 100%;
      max-width: 1000px;
    }
    .option {
      background: rgba(60,0,110,0.8);
      padding: 3vh 5vw;
      border-radius: 18px;
      font-size: clamp(1.3rem, 4.5vw, 1.8rem);
      cursor: pointer;
      transition: all 0.35s ease;
      border: 3px solid transparent;
      text-align: center;
      backdrop-filter: blur(6px);
    }
    .option:hover {
      background: rgba(100,0,160,0.95);
      transform: translateY(-8px);
      border-color: #ff99ff;
    }
    .option.selected {
      border-color: #00ffcc;
      background: rgba(0,80,60,0.75);
    }
    #end {
      display: none;
      width: 100%;
      max-width: 1000px;
      flex-direction: column;
      align-items: center;
      padding: 5vh 0;
      z-index: 1;
    }
    #end h2 { font-size: clamp(3rem, 8vw, 4.2rem); color: #ffdd44; margin-bottom: 4vh; }
    #result { font-size: clamp(1.8rem, 5.5vw, 2.4rem); text-align: center; margin-bottom: 5vh; }
    #answersList {
      width: 100%;
      background: rgba(40,0,70,0.75);
      border-radius: 18px;
      padding: 4vh;
      font-size: clamp(1.2rem, 4vw, 1.5rem);
      line-height: 1.8;
      margin-bottom: 5vh;
    }
    #answersList div { margin: 2.5vh 0; padding: 2.5vh; background: rgba(60,0,100,0.65); border-radius: 14px; }
    button#copyAllAnswers, button#restartBtn {
      font-size: 1.5rem;
      padding: 1.2rem 3rem;
      margin: 2vh;
    }
    #copyAllAnswers { background: #00cc88; }
    #copyAllAnswers:hover { background: #00ffaa; }
    #restartBtn { background: #3366ff; }
    #restartBtn:hover { background: #5588ff; }
    #waiting { font-size: 1.5rem; color: #ffcc66; margin-top: 3vh; text-align: center; }
  </style>
</head>
<body>

  <video id="bg-video" autoplay loop playsinline muted>
    <source src="videoo.mp4" type="video/mp4">
  </video>
  <div id="overlay"></div>

  <audio id="bg-music" loop>
    <source src="musiic.mp3" type="audio/mpeg">
  </audio>

  <div id="start-screen">
    <h1>Sevgilini NÉ™ QÉ™dÉ™r TanÄ±yÄ±rsan?</h1>
    <button id="start-btn">Davam et</button>
  </div>

  <div id="status" style="display:none;">HazÄ±rlanÄ±r...</div>

  <div id="lobby">
    <button onclick="createRoom()">Otaq Yarat (KOD al)</button>
    <input id="roomIdInput" placeholder="QarÅŸÄ± TÉ™rÉ™fin Kodunu Yaz" />
    <button onclick="joinRoom()">QoÅŸul</button>
  </div>

  <div id="game">
    <div id="timer">15</div>
    <div id="qEmoji"></div>
    <div id="question"></div>
    <div class="options" id="options"></div>
  </div>

  <div id="end">
    <h2>Oyun Bitdi!</h2>
    <div id="result">30 sual cavablandÄ±!</div>
    <div id="answersList"></div>
    <button id="copyAllAnswers">HamÄ±sÄ±nÄ± Kopyala</button>
    <button id="restartBtn" onclick="requestRestart()">YenidÉ™n BaÅŸlat</button>
    <div id="waiting"></div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCM5WdZNSj9oFipNI-J3csHpOIvK8PjoLU",
      authDomain: "sevgili-testi.firebaseapp.com",
      databaseURL: "https://sevgili-testi-default-rtdb.firebaseio.com",
      projectId: "sevgili-testi",
      storageBucket: "sevgili-testi.firebasestorage.app",
      messagingSenderId: "399260477557",
      appId: "1:399260477557:web:584204a698d7bf145bb03c"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const status = document.getElementById('status');
    const startScreen = document.getElementById('start-screen');
    const lobby = document.getElementById('lobby');
    const gameDiv = document.getElementById('game');
    const startBtn = document.getElementById('start-btn');
    const timerEl = document.getElementById('timer');
    const qEmoji = document.getElementById('qEmoji');
    const questionEl = document.getElementById('question');
    const optionsEl = document.getElementById('options');
    const endDiv = document.getElementById('end');
    const resultEl = document.getElementById('result');
    const answersList = document.getElementById('answersList');
    const waitingEl = document.getElementById('waiting');
    const music = document.getElementById('bg-music');

    let roomId = null;
    let myRole = null; // 'host' vÉ™ ya 'guest'
    let currentQuestionIndex = -1;
    let timerInterval = null;
    let timeLeft = 15;
    let myAnswered = false;
    let opponentAnswered = false;
    let myAnswers = new Array(30).fill(-1);
    let restartRequested = false;
    let opponentRestartRequested = false;

    const questions = [
      { q: "Sevgilinin É™n sevdiyi rÉ™ng hansÄ±dÄ±r?", options: ["A) QÄ±rmÄ±zÄ± â€“ ehtiraslÄ± vÉ™ cÉ™sarÉ™tli", "B) Mavi â€“ sakit vÉ™ dÉ™rin", "C) YaÅŸÄ±l â€“ tÉ™biÉ™t vÉ™ harmoniya", "D) SarÄ± â€“ gÃ¼nÉ™ÅŸ kimi parlaq vÉ™ enerjili", "E) BÉ™nÃ¶vÅŸÉ™yi â€“ sirli vÉ™ kraliÃ§a kimi", "F) Qara â€“ gizemli vÉ™ seksiy"], emoji: "ðŸŽ¨" },
      { q: "UÅŸaqlÄ±qda É™n Ã§ox sevdiyi oyuncaq nÉ™ idi?", options: ["A) AyÄ± balasÄ± â€“ qucaqlayÄ±b yatardÄ±", "B) MaÅŸÄ±n â€“ bÃ¼tÃ¼n evi yarÄ±ÅŸ meydanÄ± edirdi", "C) Kukla â€“ ona saÃ§ dÃ¼zÉ™ldirdi", "D) Lego â€“ saatlarla tikib sÃ¶kÃ¼rdÃ¼", "E) Top â€“ hÉ™r yerdÉ™ oynayÄ±rdÄ±", "F) Robot â€“ onu idarÉ™ etmÉ™yi sevirdi"], emoji: "ðŸ§¸" },
      { q: "Æn sevdiyi yemÉ™k hansÄ±dÄ±r?", options: ["A) Plov â€“ anasÄ±nÄ±n plovu É™vÉ™zedilmÉ™z", "B) Pizza â€“ gecÉ™lÉ™r É™n yaxÅŸÄ± dostu", "C) Dolma â€“ ailÉ™ yemÉ™yi, emosional", "D) LavaÅŸ â€“ hÉ™r ÅŸeyÉ™ yaraÅŸÄ±r", "E) Kabab â€“ odun qoxusu ilÉ™", "F) Sushi â€“ zÃ¶vqlÃ¼ vÉ™ ekzotik"], emoji: "ðŸ²" },
      { q: "SÉ™hÉ™r tezdÉ™n ilk nÉ™ edir?", options: ["A) Telefonuna baxÄ±r â€“ ilk iÅŸ sosial media", "B) Kofe/Ã§ay iÃ§ir â€“ gÃ¼nÉ™ onsuz baÅŸlamaz", "C) Ä°dman edir â€“ enerjini boÅŸaldÄ±r", "D) YenidÉ™n yatÄ±r â€“ sÉ™hÉ™r onun dÃ¼ÅŸmÉ™nidir", "E) DuÅŸ alÄ±r â€“ tÉ™zÉ™lik vacibdir", "F) Kitab oxuyur â€“ gÃ¼nÉ™ intellektlÉ™ baÅŸlayÄ±r"], emoji: "â˜•" },
      { q: "Æn Ã§ox sevdiyi musiqi janrÄ± hansÄ±dÄ±r?", options: ["A) Pop â€“ hÉ™r yerdÉ™ oxuyur", "B) Rap â€“ sÃ¶zlÉ™rÉ™ vurulub", "C) Rock â€“ emosiyanÄ± boÅŸaldÄ±r", "D) Klassik â€“ ruhu sakitlÉ™ÅŸdirir", "E) Xalq musiqisi â€“ kÃ¶klÉ™rÉ™ baÄŸlÄ±dÄ±r", "F) Elektronika â€“ gecÉ™lÉ™rÉ™ uyÄŸundur"], emoji: "ðŸŽµ" },
      { q: "UÅŸaqlÄ±q lÉ™qÉ™bi nÉ™ olub?", options: ["A) Balaca â€“ hÉ™miÅŸÉ™ kiÃ§ik qalÄ±rdÄ±", "B) Åžirin â€“ hamÄ± qucaqlayÄ±rdÄ±", "C) TÃ¼lkÃ¼ â€“ hiylÉ™gÉ™r idi", "D) Ã–zÃ¼nÉ™mÉ™xsus lÉ™qÉ™bi olub", "E) Yaramaz â€“ evdÉ™ baÅŸÄ±-baÅŸÄ±na qalÄ±rdÄ±", "F) HeÃ§ lÉ™qÉ™bi olmayÄ±b â€“ ciddi uÅŸaq idi"], emoji: "ðŸ˜„" },
      { q: "Æn bÃ¶yÃ¼k qorxusu nÉ™dir?", options: ["A) HÃ¼ndÃ¼rlÃ¼k â€“ damdan aÅŸaÄŸÄ± baxa bilmir", "B) QaranlÄ±q â€“ iÅŸÄ±q sÃ¶nÉ™ndÉ™ panika olur", "C) HÃ¶rÃ¼mÃ§É™k â€“ gÃ¶rÉ™ndÉ™ qÄ±ÅŸqÄ±rÄ±r", "D) TÉ™k qalmaq â€“ yalnÄ±lÄ±qdan qorxur", "E) Ä°ynÉ™ â€“ hÉ™kimÉ™ getmÉ™kdÉ™n yayÄ±nÄ±r", "F) DÉ™niz â€“ dÉ™rin sudan qorxur"], emoji: "ðŸ˜±" },
      { q: "Æn sevdiyi film janrÄ± hansÄ±dÄ±r?", options: ["A) Komediya â€“ gÃ¼lÃ¼ÅŸ vacibdir", "B) Romantika â€“ sevgi hekayÉ™lÉ™rinÉ™ inanÄ±r", "C) Dram â€“ emosional filmlÉ™ri sevir", "D) Aksiya â€“ adrenalin vurur", "E) Fantastika â€“ xÉ™yallara qaÃ§Ä±r", "F) DÉ™hÅŸÉ™t â€“ qorxunu sevir"], emoji: "ðŸŽ¬" },
      { q: "Æn Ã§ox sevdiyi mÃ¶vsÃ¼m hansÄ±dÄ±r?", options: ["A) Yay â€“ dÉ™niz, gÃ¼nÉ™ÅŸ, istirahÉ™t", "B) PayÄ±z â€“ yarpaqlar vÉ™ romantika", "C) QÄ±ÅŸ â€“ qar vÉ™ isti yorÄŸan", "D) Yaz â€“ tÉ™zÉ™lik vÉ™ Ã§iÃ§É™klÉ™r"], emoji: "ðŸ‚" },
      { q: "Telefonunun arxa fonunda nÉ™ var?", options: ["A) Ã–z selfisi â€“ Ã¶zÃ¼nÃ¼ sevir", "B) MÉ™nzÉ™rÉ™ â€“ gÃ¶zÉ™lliyÉ™ vurulub", "C) Heyvan â€“ heyvansevÉ™rdir", "D) Qara ekran â€“ sadÉ™liyi sevir", "E) Musiqi qrupu â€“ fanatdÄ±r", "F) SÉ™nin ÅŸÉ™klin â€“ sÉ™ni Ã¶n plana Ã§Ä±xarÄ±r"], emoji: "ðŸ“±" },
      { q: "Æn sevdiyi heyvan hansÄ±dÄ±r?", options: ["A) PiÅŸik â€“ evdÉ™ki É™n yaxÅŸÄ± dost", "B) Ä°t â€“ sadiq vÉ™ enerjili", "C) QuÅŸ â€“ azadlÄ±q simvolu", "D) At â€“ gÃ¼c vÉ™ zÉ™riflik", "E) Panda â€“ ÅŸirin vÉ™ tÉ™nbÉ™l", "F) Delfin â€“ aÄŸÄ±llÄ± vÉ™ oynaq"], emoji: "ðŸ±" },
      { q: "Æn Ã§ox sevdiyi iÃ§ki nÉ™dir?", options: ["A) Kola â€“ klassik vÉ™ enerji verÉ™n", "B) Ã‡ay â€“ sakitlÉ™ÅŸdirici vÉ™ É™nÉ™nÉ™vi", "C) Kofe â€“ gÃ¼nÃ¼n baÅŸlanÄŸÄ±cÄ±", "D) ÅžirÉ™ â€“ tÉ™bii vÉ™ saÄŸlam", "E) Su â€“ sadÉ™ vÉ™ tÉ™miz", "F) Limonad â€“ sÉ™rin vÉ™ turÅŸ"], emoji: "ðŸ¥¤" },
      { q: "UÅŸaqlÄ±qda hansÄ± idman nÃ¶vÃ¼ ilÉ™ mÉ™ÅŸÄŸul olub?", options: ["A) Futbol â€“ komanda ruhu", "B) ÃœzgÃ¼Ã§Ã¼lÃ¼k â€“ azadlÄ±q hissi", "C) RÉ™qs â€“ ritm vÉ™ emosiya", "D) Voleybol â€“ Ã§eviklik", "E) GÃ¼lÉ™ÅŸ â€“ gÃ¼c vÉ™ mÃ¼barizÉ™", "F) HeÃ§ biri â€“ idmanla arasÄ± yox idi"], emoji: "âš½" },
      { q: "Æn sevdiyi tÉ™til yeri haradÄ±r?", options: ["A) DÉ™niz sahili â€“ qum vÉ™ gÃ¼nÉ™ÅŸ", "B) DaÄŸlar â€“ sÉ™rin hava vÉ™ mÉ™nzÉ™rÉ™", "C) ÅžÉ™hÉ™r â€“ hÉ™yat vÉ™ gecÉ™ hÉ™yatÄ±", "D) KÉ™nd â€“ sakitlik vÉ™ tÉ™biÉ™t", "E) XaricdÉ™ â€“ yeni mÉ™dÉ™niyyÉ™tlÉ™r", "F) EvindÉ™ â€“ É™n rahat yer"], emoji: "ðŸ–ï¸" },
      { q: "Æn bÃ¶yÃ¼k xÉ™yalÄ± nÉ™dir?", options: ["A) DÃ¼nyanÄ± gÉ™zmÉ™k â€“ hÉ™r Ã¶lkÉ™ni gÃ¶rmÉ™k", "B) Ã‡ox pul qazanmaq â€“ lÃ¼ks hÉ™yat", "C) AilÉ™ qurmaq â€“ sevgi vÉ™ uÅŸaqlar", "D) MÉ™ÅŸhur olmaq â€“ hamÄ±nÄ±n tanÄ±masÄ±", "E) Ã–z biznesini qurmaq â€“ mÃ¼stÉ™qillik", "F) Sakit hÉ™yat sÃ¼rmÉ™k â€“ stresssiz gÃ¼nlÉ™r"], emoji: "ðŸŒŸ" },
      { q: "Æn pis vÉ™rdiÅŸi nÉ™dir?", options: ["A) Gec yatmaq â€“ gecÉ™ quÅŸudur", "B) Ã‡ox telefon istifadÉ™si â€“ sosial media asÄ±lÄ±lÄ±ÄŸÄ±", "C) UnutqanlÄ±q â€“ hÉ™r ÅŸeyi itirir", "D) DÄ±rnaq yemÉ™k â€“ stress anÄ±nda", "E) GecikmÉ™k â€“ hÉ™miÅŸÉ™ 5 dÉ™qiqÉ™ gecikir", "F) Ã‡ox danÄ±ÅŸmamaq â€“ iÃ§indÉ™ saxlayÄ±r"], emoji: "ðŸ˜…" },
      { q: "Æn Ã§ox sevdiyi emoji hansÄ±dÄ±r?", options: ["A) ðŸ˜‚ â€“ hÉ™r ÅŸeyÉ™ gÃ¼lÃ¼r", "B) â¤ï¸ â€“ sevgini gÃ¶stÉ™rir", "C) ðŸ”¥ â€“ hÉ™r ÅŸey 'yanÄ±r'", "D) ðŸ˜ˆ â€“ yaramazlÄ±q anlarÄ±", "E) ðŸ¥° â€“ ÅŸirinlik", "F) ðŸ¤¦â€â™€ï¸ â€“ 'bu nÉ™ idi indi?'"], emoji: "ðŸ˜" },
      { q: "SÉ™hÉ™r yuxudan oyananda ilk nÉ™ dÃ¼ÅŸÃ¼nÃ¼r?", options: ["A) Kofe/Ã§ay â€“ gÃ¼nÉ™ onsuz baÅŸlamaz", "B) Telefon â€“ ilk iÅŸ mesajlara baxmaq", "C) SÉ™n â€“ sÉ™ni xatÄ±rlayÄ±r", "D) YenidÉ™n yatmaq â€“ yuxu onun sevgilisidir", "E) Ä°ÅŸ â€“ plan qurur", "F) YemÉ™k â€“ ac qalÄ±r"], emoji: "ðŸ›Œ" },
      { q: "Æn sevdiyi zarafat nÃ¶vÃ¼ hansÄ±dÄ±r?", options: ["A) Qara yumor â€“ qaranlÄ±qdan qorxmur", "B) Sarkazm â€“ ironiyanÄ± sevir", "C) Klassik zarafatlar â€“ sadÉ™ vÉ™ tÉ™miz", "D) Zarafat sevmir â€“ ciddi insan", "E) DadlÄ± zarafatlar â€“ axmaq gÃ¼lÃ¼ÅŸlÉ™r", "F) PÉ™dÉ™rÅŸÉ™killi â€“ yaramazlÄ±q"], emoji: "ðŸ¤¡" },
      { q: "Onun ideal hÉ™ftÉ™sonu necÉ™ keÃ§ir?", options: ["A) EvdÉ™ film izlÉ™mÉ™k â€“ rahat vÉ™ isti", "B) Ã‡Ã¶lÉ™ Ã§Ä±xmaq â€“ macÉ™ra axtarÄ±r", "C) Yuxu Ã§É™kmÉ™k â€“ yuxu onun sevdiyi ÅŸeydir", "D) Dostlarla gÃ¶rÃ¼ÅŸ â€“ sÃ¶hbÉ™t vÉ™ gÃ¼lÃ¼ÅŸ", "E) AlÄ±ÅŸ-veriÅŸ â€“ Ã¶zÃ¼nÉ™ baxmaq", "F) TÉ™biÉ™tdÉ™ gÉ™zmÉ™k â€“ tÉ™mizlik vÉ™ sÃ¼kut"], emoji: "ðŸ›‹ï¸" },
      { q: "Æn sevdiyi kitab janrÄ± hansÄ±dÄ±r?", options: ["A) Roman â€“ sevgi vÉ™ hÉ™yat hekayÉ™lÉ™ri", "B) Detektiv â€“ sirri aÃ§maÄŸÄ± sevir", "C) Fantastika â€“ xÉ™yallara qaÃ§Ä±r", "D) Psixologiya â€“ Ã¶zÃ¼nÃ¼ anlamaq", "E) HeÃ§ oxumur â€“ kitab onun dÃ¼ÅŸmÉ™nidir", "F) Åžeir â€“ ruhu oxÅŸayÄ±r"], emoji: "ðŸ“š" },
      { q: "UÅŸaqlÄ±qda É™n sevdiyi cizgi filmi hansÄ± idi?", options: ["A) Åžrek â€“ ironiya vÉ™ yumor", "B) Aslan Kral â€“ emosional vÉ™ epik", "C) Donanma â€“ macÉ™ra vÉ™ dostluq", "D) Tom vÉ™ Cerri â€“ klassik gÃ¼lÃ¼ÅŸ", "E) SpongeBob â€“ axmaq vÉ™ É™ylÉ™ncÉ™li", "F) DigÉ™r â€“ Ã¶zÃ¼nÃ¼nkÃ¼ de"], emoji: "ðŸ“º" },
      { q: "Æn Ã§ox sevdiyi qoxu hansÄ±dÄ±r?", options: ["A) Ætir â€“ Ã¶zÃ¼nÉ™ baxÄ±mlÄ±dÄ±r", "B) YaÄŸÄ±ÅŸdan sonra torpaq â€“ tÉ™biÉ™t qoxusu", "C) TÉ™zÉ™ Ã§Ã¶rÉ™k â€“ ev qoxusu", "D) DÉ™niz â€“ azadlÄ±q hissi", "E) Kofe â€“ sÉ™hÉ™r ritualÄ±", "F) GÃ¼l â€“ romantika"], emoji: "ðŸŒ¹" },
      { q: "Æn Ã§ox sevdiyi rÉ™qs nÃ¶vÃ¼ hansÄ±dÄ±r?", options: ["A) Latin â€“ ehtiraslÄ± vÉ™ isti", "B) Hip-hop â€“ enerjili vÉ™ gÉ™nc", "C) Vals â€“ klassik vÉ™ romantik", "D) RÉ™qs etmir â€“ utancaqdÄ±r", "E) Folklor â€“ kÃ¶klÉ™rÉ™ baÄŸlÄ±dÄ±r", "F) Tango â€“ intim vÉ™ gÃ¼clÃ¼"], emoji: "ðŸ’ƒ" },
      { q: "Æn sevdiyi rÉ™ng kombinasiyasÄ± hansÄ±dÄ±r?", options: ["A) Qara-aÄŸ â€“ minimalist vÉ™ ÅŸÄ±k", "B) QÄ±rmÄ±zÄ±-qara â€“ ehtiras vÉ™ gÃ¼c", "C) Mavi-aÄŸ â€“ sakit vÉ™ tÉ™miz", "D) YaÅŸÄ±l-qÉ™hvÉ™yi â€“ tÉ™biÉ™t tonlarÄ±", "E) Ã‡É™hrayÄ±-boz â€“ yumÅŸaq vÉ™ ÅŸirin", "F) DigÉ™r â€“ Ã¶zÃ¼nÃ¼nkÃ¼ de"], emoji: "ðŸŒˆ" },
      { q: "UÅŸaqlÄ±qda É™n Ã§ox sevdiyi ÅŸirniyyat nÉ™ idi?", options: ["A) Åžokolad â€“ hÉ™miÅŸÉ™ É™lindÉ™", "B) Konfet â€“ rÉ™ngli vÉ™ ÅŸirin", "C) Tort â€“ ad gÃ¼nÃ¼ sevinci", "D) Dondurma â€“ yay gÃ¼nlÉ™rinin xoÅŸbÉ™xtliyi", "E) PiÅŸmiÅŸ xÉ™mir â€“ ev qoxusu", "F) Qoz-fÄ±ndÄ±q â€“ saÄŸlam vÉ™ dadlÄ±"], emoji: "ðŸ«" },
      { q: "Æn Ã§ox sevdiyi idman nÃ¶vÃ¼nÃ¼ izlÉ™mÉ™yi sevir?", options: ["A) Futbol â€“ hÉ™yÉ™can vÉ™ komanda", "B) Basketbol â€“ sÃ¼rÉ™t vÉ™ bacarÄ±q", "C) Tennis â€“ fÉ™rdi mÃ¼barizÉ™", "D) Formula 1 â€“ adrenalin vÉ™ sÃ¼rÉ™t", "E) Boks â€“ gÃ¼c vÉ™ iradÉ™", "F) HeÃ§ izlÉ™mir â€“ idman onun iÅŸi deyil"], emoji: "ðŸ€" },
      { q: "Æn sevdiyi bayram hansÄ±dÄ±r?", options: ["A) Yeni il â€“ yeni baÅŸlanÄŸÄ±clar", "B) Novruz â€“ tÉ™zÉ™lik vÉ™ bahar", "C) Ad gÃ¼nÃ¼ â€“ Ã¶zÃ¼ mÉ™rkÉ™zdÉ™", "D) SevgililÉ™r gÃ¼nÃ¼ â€“ romantika", "E) Qurban bayramÄ± â€“ ailÉ™ vÉ™ paylaÅŸma", "F) MÃ¼stÉ™qillik gÃ¼nÃ¼ â€“ vÉ™tÉ™npÉ™rvÉ™rlik"], emoji: "ðŸŽ‰" },
      { q: "Æn Ã§ox sevdiyi hava ÅŸÉ™raiti necÉ™dir?", options: ["A) GÃ¼nÉ™ÅŸli â€“ enerji verir", "B) YaÄŸÄ±ÅŸlÄ± â€“ romantik vÉ™ sakit", "C) QarlÄ± â€“ sehrli vÉ™ tÉ™miz", "D) SÉ™rin kÃ¼lÉ™kli â€“ rahat", "E) Ä°sti yay gÃ¼nÃ¼ â€“ dÉ™niz vÉ™ istirahÉ™t", "F) PayÄ±z yarpaqlarÄ± â€“ gÃ¶zÉ™l mÉ™nzÉ™rÉ™"], emoji: "â›…" },
      { q: "Æn sevdiyi sosial ÅŸÉ™bÉ™kÉ™ hansÄ±dÄ±r?", options: ["A) Instagram â€“ ÅŸÉ™killÉ™r vÉ™ estetika", "B) TikTok â€“ qÄ±sa vÉ™ É™ylÉ™ncÉ™li videolar", "C) Telegram â€“ sÃ¼rÉ™tli vÉ™ gizli", "D) Facebook â€“ kÃ¶hnÉ™ dostlar", "E) Twitter/X â€“ fikir mÃ¼badilÉ™si", "F) HeÃ§ istifadÉ™ etmir â€“ real hÉ™yatÄ± sevir"], emoji: "ðŸ“±" }
    ];

    startBtn.addEventListener('click', () => {
      startScreen.style.display = 'none';
      music.play().catch(e => console.log("MahnÄ± oxumadÄ±:", e));
      lobby.style.display = 'block';
      status.style.display = 'block';
      status.innerHTML = 'Otaq yarat vÉ™ ya qarÅŸÄ± tÉ™rÉ™fin kodunu yazaraq qoÅŸul!';
    });

    function createRoom() {
      roomId = Math.random().toString(36).substring(2, 10).toUpperCase();
      myRole = 'host';
      status.innerHTML = `Otaq KODU: <strong>${roomId}</strong><br>QarÅŸÄ± tÉ™rÉ™fÉ™ gÃ¶ndÉ™r!`;
      const copyBtn = document.createElement('button');
      copyBtn.textContent = 'Kopyala';
      copyBtn.onclick = () => {
        navigator.clipboard.writeText(roomId).then(() => alert('KOD kopyalandÄ±!'));
      };
      status.appendChild(copyBtn);

      db.ref('rooms/' + roomId).set({
        hostConnected: true,
        guestConnected: false,
        currentQuestion: -1,
        answers: {},
        restartRequested: false
      }).then(() => {
        listenRoom();
      }).catch(err => alert('Otaq yaradÄ±larkÉ™n xÉ™ta: ' + err.message));
    }

    function joinRoom() {
      roomId = document.getElementById('roomIdInput').value.trim().toUpperCase();
      if (!roomId) return alert('KOD yaz!');

      myRole = 'guest';
      db.ref('rooms/' + roomId).once('value').then(snapshot => {
        if (!snapshot.exists()) return alert('BelÉ™ otaq yoxdur!');
        db.ref('rooms/' + roomId).update({ guestConnected: true });
        status.innerHTML = 'QoÅŸuldun! Oyun baÅŸlayÄ±r...';
        lobby.style.display = 'none';
        gameDiv.style.display = 'flex';
        listenRoom();
      }).catch(err => alert('QoÅŸulma xÉ™tasÄ±: ' + err.message));
    }

    function listenRoom() {
      const roomRef = db.ref('rooms/' + roomId);

      roomRef.on('value', snapshot => {
        const data = snapshot.val();
        if (!data) return;

        // Host Ã¼Ã§Ã¼n qoÅŸulan gÉ™lÉ™ndÉ™ dÉ™rhal baÅŸla
        if (myRole === 'host' && data.guestConnected === true && currentQuestionIndex === -1) {
          console.log('Guest qoÅŸuldu, host tÉ™rÉ™fdÉ™ oyun baÅŸlasÄ±n');
          status.innerHTML = 'QarÅŸÄ± tÉ™rÉ™f qoÅŸuldu! Oyun baÅŸlayÄ±r...';
          currentQuestionIndex = -1;
          nextQuestion();
        }

        // Sual sinxronizasiyasÄ±
        if (data.currentQuestion !== undefined && data.currentQuestion !== currentQuestionIndex) {
          currentQuestionIndex = data.currentQuestion;
          myAnswered = false;
          opponentAnswered = false;
          showQuestion();
          console.log('Yeni sual: ' + currentQuestionIndex);
        }

        // Cavab sinxronizasiyasÄ±
        if (data.answers) {
          const opponentKey = myRole === 'host' ? 'guest' : 'host';
          if (data.answers[opponentKey] !== undefined && !opponentAnswered) {
            opponentAnswered = true;
            checkBothAnswered();
          }
        }

        // Restart sinxronizasiyasÄ±
        if (data.restartRequested && !opponentRestartRequested) {
          opponentRestartRequested = true;
          checkRestart();
        }
      });
    }

    function nextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex >= questions.length) {
        showEndScreen();
        db.ref('rooms/' + roomId).update({ currentQuestion: -2 });
        return;
      }

      db.ref('rooms/' + roomId).update({
        currentQuestion: currentQuestionIndex
      });
    }

    function showQuestion() {
      const q = questions[currentQuestionIndex];
      qEmoji.textContent = q.emoji;
      questionEl.textContent = q.q;
      optionsEl.innerHTML = '';
      q.options.forEach((opt, i) => {
        const div = document.createElement('div');
        div.className = 'option';
        div.textContent = opt;
        div.onclick = () => selectAnswer(i);
        optionsEl.appendChild(div);
      });
      timeLeft = 15;
      timerEl.textContent = timeLeft;
      clearInterval(timerInterval);
      timerInterval = setInterval(updateTimer, 1000);
    }

    function updateTimer() {
      if (myAnswered && opponentAnswered) return;
      timeLeft--;
      timerEl.textContent = timeLeft;
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        timerEl.textContent = "VAQT BÄ°TDÄ°!";
        setTimeout(nextQuestion, 1800);
      }
    }

    function selectAnswer(index) {
      if (myAnswered) return;
      myAnswered = true;
      myAnswers[currentQuestionIndex] = index;

      const playerKey = myRole === 'host' ? 'host' : 'guest';
      db.ref('rooms/' + roomId + '/answers/' + playerKey).set(index);

      checkBothAnswered();
    }

    function checkBothAnswered() {
      db.ref('rooms/' + roomId + '/answers').once('value').then(snapshot => {
        const answers = snapshot.val() || {};
        if (Object.keys(answers).length === 2) {
          setTimeout(nextQuestion, 1500);
        }
      });
    }

    function showEndScreen() {
      clearInterval(timerInterval);
      gameDiv.style.display = 'none';
      endDiv.style.display = 'flex';

      resultEl.innerHTML = "30 sual cavablandÄ±!";

      answersList.innerHTML = '<h3 style="text-align:center; color:#ff99ff; margin-bottom:2vh;">SÉ™nin cavablarÄ±n:</h3>';
      questions.forEach((q, i) => {
        const ans = myAnswers[i] === -1 ? "Cavab vermÉ™din" : q.options[myAnswers[i]];
        const div = document.createElement('div');
        div.innerHTML = `<strong>${i+1}.</strong> ${q.q}<br><strong>CavabÄ±n:</strong> ${ans}`;
        answersList.appendChild(div);
      });

      document.getElementById('copyAllAnswers').onclick = () => {
        let textToCopy = "SÉ™nin cavablarÄ±n:\n\n";
        questions.forEach((q, i) => {
          const ans = myAnswers[i] === -1 ? "Cavab vermÉ™din" : q.options[myAnswers[i]];
          textToCopy += `${i+1}. ${q.q}\nCavabÄ±n: ${ans}\n\n`;
        });
        navigator.clipboard.writeText(textToCopy).then(() => {
          alert("BÃ¼tÃ¼n suallar vÉ™ cavablar kopyalandÄ±!");
        });
      };
    }

    function requestRestart() {
      restartRequested = true;
      db.ref('rooms/' + roomId).update({ restartRequested: true });
      checkRestart();
    }

    function checkRestart() {
      if (restartRequested && opponentRestartRequested) {
        myAnswers = new Array(questions.length).fill(-1);
        currentQuestionIndex = -1;
        endDiv.style.display = 'none';
        gameDiv.style.display = 'flex';
        waitingEl.textContent = '';
        db.ref('rooms/' + roomId).update({
          currentQuestion: -1,
          answers: {},
          restartRequested: false
        });
        nextQuestion();
      } else {
        waitingEl.textContent = opponentRestartRequested 
          ? "RÉ™qib yenidÉ™n baÅŸlamaÄŸÄ± istÉ™yir... SÉ™n dÉ™ bas!" 
          : "RÉ™qibin dÉ™ basmasÄ±nÄ± gÃ¶zlÉ™yirik...";
      }
    }
  </script>
</body>
</html>