<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<title>Puzzle Game</title>
<style>
  html, body {
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    overflow:hidden;
    background:#111;
    display:flex;
    justify-content:center;
    align-items:center;
  }

  #puzzle-container {
    position: relative;
    width: 90vmin;
    height: 90vmin;
    max-width: 90vmin;
    max-height: 90vmin;
    border: 2px solid #fff;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 1fr);
    gap:2px;
    touch-action: none;
    background: #222;
  }

  .piece {
    background-image: url("image.jpg");
    background-size: 300% 300%;
    cursor: grab;
    transition: all 0.2s;
    position: relative;
  }

  .piece.correct {
    pointer-events: none;
    cursor: default;
  }

  .piece.dragging {
    z-index: 100;
    opacity: 0.9;
  }
</style>
</head>
<body>

<div id="puzzle-container"></div>

<script>
const container = document.getElementById("puzzle-container");
const rows = 3;
const cols = 3;
let pieces = [];

// Create pieces
for(let r=0;r<rows;r++){
  for(let c=0;c<cols;c++){
    const piece = document.createElement("div");
    piece.classList.add("piece");
    piece.dataset.correctRow = r;
    piece.dataset.correctCol = c;
    piece.style.backgroundPosition = `${(-c*100/ (cols-1))}% ${(-r*100/ (rows-1))}%`;
    container.appendChild(piece);
    pieces.push(piece);
  }
}

// Shuffle pieces in container
pieces = pieces.sort(()=>Math.random()-0.5);
pieces.forEach(p=>container.appendChild(p));

// Drag & Drop
let dragged = null;
pieces.forEach(piece=>{
  piece.addEventListener("pointerdown", e=>{
    if(piece.classList.contains("correct")) return;
    dragged = piece;
    piece.classList.add("dragging");
    piece.setPointerCapture(e.pointerId);
  });

  piece.addEventListener("pointermove", e=>{
    if(dragged !== piece) return;
    piece.style.position = "absolute";
    piece.style.left = (e.clientX - container.getBoundingClientRect().left - piece.offsetWidth/2)+"px";
    piece.style.top = (e.clientY - container.getBoundingClientRect().top - piece.offsetHeight/2)+"px";
  });

  piece.addEventListener("pointerup", e=>{
    if(dragged !== piece) return;
    piece.classList.remove("dragging");
    piece.style.position = "relative";
    piece.style.left = "";
    piece.style.top = "";

    // Determine which cell it's closest to
    const containerRect = container.getBoundingClientRect();
    const cellWidth = containerRect.width / cols;
    const cellHeight = containerRect.height / rows;
    const pieceRect = piece.getBoundingClientRect();
    const centerX = pieceRect.left - containerRect.left + pieceRect.width/2;
    const centerY = pieceRect.top - containerRect.top + pieceRect.height/2;
    const col = Math.floor(centerX / cellWidth);
    const row = Math.floor(centerY / cellHeight);

    if(row == piece.dataset.correctRow && col == piece.dataset.correctCol){
      piece.style.gridRowStart = parseInt(row)+1;
      piece.style.gridColumnStart = parseInt(col)+1;
      piece.classList.add("correct");
    }
    dragged = null;
  });
});
</script>
</body>
</html>